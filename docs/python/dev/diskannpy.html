<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>diskannpy API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#documentation-overview">Documentation Overview</a>
  <ul>
    <li><a href="#index-builders">Index Builders</a></li>
    <li><a href="#search-classes">Search Classes</a></li>
    <li><a href="#parameter-defaults">Parameter Defaults</a></li>
    <li><a href="#parameter-and-response-type-aliases">Parameter and Response Type Aliases</a></li>
    <li><a href="#utilities">Utilities</a></li>
  </ul></li>
</ul>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="diskannpy/defaults.html">defaults</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#build_disk_index">build_disk_index</a>
            </li>
            <li>
                    <a class="function" href="#build_memory_index">build_memory_index</a>
            </li>
            <li>
                    <a class="class" href="#StaticDiskIndex">StaticDiskIndex</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StaticDiskIndex.__init__">StaticDiskIndex</a>
                        </li>
                        <li>
                                <a class="function" href="#StaticDiskIndex.search">search</a>
                        </li>
                        <li>
                                <a class="function" href="#StaticDiskIndex.batch_search">batch_search</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#StaticMemoryIndex">StaticMemoryIndex</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StaticMemoryIndex.__init__">StaticMemoryIndex</a>
                        </li>
                        <li>
                                <a class="function" href="#StaticMemoryIndex.search">search</a>
                        </li>
                        <li>
                                <a class="function" href="#StaticMemoryIndex.batch_search">batch_search</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DynamicMemoryIndex">DynamicMemoryIndex</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DynamicMemoryIndex.__init__">DynamicMemoryIndex</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamicMemoryIndex.from_file">from_file</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamicMemoryIndex.search">search</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamicMemoryIndex.batch_search">batch_search</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamicMemoryIndex.save">save</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamicMemoryIndex.insert">insert</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamicMemoryIndex.batch_insert">batch_insert</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamicMemoryIndex.mark_deleted">mark_deleted</a>
                        </li>
                        <li>
                                <a class="function" href="#DynamicMemoryIndex.consolidate_delete">consolidate_delete</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#DistanceMetric">DistanceMetric</a>
            </li>
            <li>
                    <a class="variable" href="#VectorDType">VectorDType</a>
            </li>
            <li>
                    <a class="class" href="#QueryResponse">QueryResponse</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#QueryResponse.__init__">QueryResponse</a>
                        </li>
                        <li>
                                <a class="variable" href="#QueryResponse.identifiers">identifiers</a>
                        </li>
                        <li>
                                <a class="variable" href="#QueryResponse.distances">distances</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#QueryResponseBatch">QueryResponseBatch</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#QueryResponseBatch.__init__">QueryResponseBatch</a>
                        </li>
                        <li>
                                <a class="variable" href="#QueryResponseBatch.identifiers">identifiers</a>
                        </li>
                        <li>
                                <a class="variable" href="#QueryResponseBatch.distances">distances</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#VectorIdentifier">VectorIdentifier</a>
            </li>
            <li>
                    <a class="variable" href="#VectorIdentifierBatch">VectorIdentifierBatch</a>
            </li>
            <li>
                    <a class="variable" href="#VectorLike">VectorLike</a>
            </li>
            <li>
                    <a class="variable" href="#VectorLikeBatch">VectorLikeBatch</a>
            </li>
            <li>
                    <a class="class" href="#Metadata">Metadata</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Metadata.__init__">Metadata</a>
                        </li>
                        <li>
                                <a class="variable" href="#Metadata.num_vectors">num_vectors</a>
                        </li>
                        <li>
                                <a class="variable" href="#Metadata.dimensions">dimensions</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#vectors_metadata_from_file">vectors_metadata_from_file</a>
            </li>
            <li>
                    <a class="function" href="#vectors_to_file">vectors_to_file</a>
            </li>
            <li>
                    <a class="function" href="#vectors_from_file">vectors_from_file</a>
            </li>
            <li>
                    <a class="function" href="#tags_to_file">tags_to_file</a>
            </li>
            <li>
                    <a class="function" href="#tags_from_file">tags_from_file</a>
            </li>
            <li>
                    <a class="function" href="#valid_dtype">valid_dtype</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
diskannpy    </h1>

                        <div class="docstring"><h1 id="documentation-overview">Documentation Overview</h1>

<p><code><a href="">diskannpy</a></code> is mostly structured around 2 distinct processes: <a href="#index-builders">Index Builder Functions</a> and <a href="#search-classes">Search Classes</a></p>

<p>It also includes a few nascent <a href="#utilities">utilities</a>.</p>

<p>And lastly, it makes substantial use of type hints, with various shorthand <a href="#parameter-and-response-type-aliases">type aliases</a> documented. 
When reading the <code><a href="">diskannpy</a></code> code we refer to the type aliases, though <code>pdoc</code> helpfully expands them.</p>

<h2 id="index-builders">Index Builders</h2>

<ul>
<li><code><a href="#build_disk_index">build_disk_index</a></code> - To build an index that cannot fully fit into memory when searching</li>
<li><code><a href="#build_memory_index">build_memory_index</a></code> - To build an index that can fully fit into memory when searching</li>
</ul>

<h2 id="search-classes">Search Classes</h2>

<ul>
<li><code><a href="#StaticMemoryIndex">StaticMemoryIndex</a></code> - for indices that can fully fit in memory and won't be changed during the search operations</li>
<li><code><a href="#StaticDiskIndex">StaticDiskIndex</a></code> - for indices that cannot fully fit in memory, thus relying on disk IO to search, and also won't be changed during search operations</li>
<li><code><a href="#DynamicMemoryIndex">DynamicMemoryIndex</a></code> - for indices that can fully fit in memory and will be mutated via insert/deletion operations as well as search operations</li>
</ul>

<h2 id="parameter-defaults">Parameter Defaults</h2>

<ul>
<li><code><a href="diskannpy/defaults.html">diskannpy.defaults</a></code> - Default values exported from the C++ extension for Python users</li>
</ul>

<h2 id="parameter-and-response-type-aliases">Parameter and Response Type Aliases</h2>

<ul>
<li><code><a href="#DistanceMetric">DistanceMetric</a></code> - What distance metrics does <code><a href="">diskannpy</a></code> support?</li>
<li><code><a href="#VectorDType">VectorDType</a></code> - What vector datatypes does <code><a href="">diskannpy</a></code> support?</li>
<li><code><a href="#QueryResponse">QueryResponse</a></code> - What can I expect as a response to my search?</li>
<li><code><a href="#QueryResponseBatch">QueryResponseBatch</a></code> - What can I expect as a response to my batch search?</li>
<li><code><a href="#VectorIdentifier">VectorIdentifier</a></code> - What types do <code><a href="">diskannpy</a></code> support as vector identifiers?</li>
<li><code><a href="#VectorIdentifierBatch">VectorIdentifierBatch</a></code> - A batch of identifiers of the exact same type. The type can change, but they must <strong>all</strong> change.</li>
<li><code><a href="#VectorLike">VectorLike</a></code> - How does a vector look to <code><a href="">diskannpy</a></code>, to be inserted or searched with.</li>
<li><code><a href="#VectorLikeBatch">VectorLikeBatch</a></code> - A batch of those vectors, to be inserted or searched with.</li>
<li><code><a href="#Metadata">Metadata</a></code> - DiskANN vector binary file metadata (num_points, vector_dim)</li>
</ul>

<h2 id="utilities">Utilities</h2>

<ul>
<li><code><a href="#vectors_to_file">vectors_to_file</a></code> - Turns a 2 dimensional <code>numpy.typing.NDArray[VectorDType]</code> with shape <code>(number_of_points, vector_dim)</code> into a DiskANN vector bin file.</li>
<li><code><a href="#vectors_from_file">vectors_from_file</a></code> - Reads a DiskANN vector bin file representing stored vectors into a numpy ndarray.</li>
<li><code><a href="#vectors_metadata_from_file">vectors_metadata_from_file</a></code> - Reads metadata stored in a DiskANN vector bin file without reading the entire file</li>
<li><code><a href="#tags_to_file">tags_to_file</a></code> - Turns a 1 dimensional <code>numpy.typing.NDArray[VectorIdentifier]</code> into a DiskANN tags bin file.</li>
<li><code><a href="#tags_from_file">tags_from_file</a></code> - Reads a DiskANN tags bin file representing stored tags into a numpy ndarray.</li>
<li><code><a href="#valid_dtype">valid_dtype</a></code> - Checks if a given vector dtype is supported by <code><a href="">diskannpy</a></code></li>
</ul>
</div>

                        <input id="mod-diskannpy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-diskannpy-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># Copyright (c) Microsoft Corporation. All rights reserved.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1"># Licensed under the MIT license.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd"># Documentation Overview</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">`diskannpy` is mostly structured around 2 distinct processes: [Index Builder Functions](#index-builders) and [Search Classes](#search-classes)</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">It also includes a few nascent [utilities](#utilities).</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">And lastly, it makes substantial use of type hints, with various shorthand [type aliases](#parameter-and-response-type-aliases) documented. </span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">When reading the `diskannpy` code we refer to the type aliases, though `pdoc` helpfully expands them.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">## Index Builders</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">- `build_disk_index` - To build an index that cannot fully fit into memory when searching</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">- `build_memory_index` - To build an index that can fully fit into memory when searching</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">## Search Classes</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">- `StaticMemoryIndex` - for indices that can fully fit in memory and won&#39;t be changed during the search operations</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">- `StaticDiskIndex` - for indices that cannot fully fit in memory, thus relying on disk IO to search, and also won&#39;t be changed during search operations</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">- `DynamicMemoryIndex` - for indices that can fully fit in memory and will be mutated via insert/deletion operations as well as search operations</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">## Parameter Defaults</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">- `diskannpy.defaults` - Default values exported from the C++ extension for Python users</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">## Parameter and Response Type Aliases</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">- `DistanceMetric` - What distance metrics does `diskannpy` support?</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">- `VectorDType` - What vector datatypes does `diskannpy` support?</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">- `QueryResponse` - What can I expect as a response to my search?</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">- `QueryResponseBatch` - What can I expect as a response to my batch search?</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">- `VectorIdentifier` - What types do `diskannpy` support as vector identifiers?</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">- `VectorIdentifierBatch` - A batch of identifiers of the exact same type. The type can change, but they must **all** change.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">- `VectorLike` - How does a vector look to `diskannpy`, to be inserted or searched with.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">- `VectorLikeBatch` - A batch of those vectors, to be inserted or searched with.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">- `Metadata` - DiskANN vector binary file metadata (num_points, vector_dim)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">## Utilities</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">- `vectors_to_file` - Turns a 2 dimensional `numpy.typing.NDArray[VectorDType]` with shape `(number_of_points, vector_dim)` into a DiskANN vector bin file.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">- `vectors_from_file` - Reads a DiskANN vector bin file representing stored vectors into a numpy ndarray.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">- `vectors_metadata_from_file` - Reads metadata stored in a DiskANN vector bin file without reading the entire file</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">- `tags_to_file` - Turns a 1 dimensional `numpy.typing.NDArray[VectorIdentifier]` into a DiskANN tags bin file.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">- `tags_from_file` - Reads a DiskANN tags bin file representing stored tags into a numpy ndarray.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">- `valid_dtype` - Checks if a given vector dtype is supported by `diskannpy`</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">typing</span> <span class="k">as</span> <span class="n">npt</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="n">DistanceMetric</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;l2&quot;</span><span class="p">,</span> <span class="s2">&quot;mips&quot;</span><span class="p">,</span> <span class="s2">&quot;cosine&quot;</span><span class="p">]</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">&quot;&quot;&quot; Type alias for one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;} &quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="n">VectorDType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">&quot;&quot;&quot; Type alias for one of {`numpy.float32`, `numpy.int8`, `numpy.uint8`} &quot;&quot;&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="n">VectorLike</span> <span class="o">=</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">&quot;&quot;&quot; Type alias for something that can be treated as a vector &quot;&quot;&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="n">VectorLikeBatch</span> <span class="o">=</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">&quot;&quot;&quot; Type alias for a batch of VectorLikes &quot;&quot;&quot;</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="n">VectorIdentifier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">&quot;&quot;&quot; </span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">Type alias for a vector identifier, whether it be an implicit array index identifier from StaticMemoryIndex or </span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">StaticDiskIndex, or an explicit tag identifier from DynamicMemoryIndex </span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="n">VectorIdentifierBatch</span> <span class="o">=</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">]</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">&quot;&quot;&quot; Type alias for a batch of VectorIdentifiers &quot;&quot;&quot;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="k">class</span><span class="w"> </span><span class="nc">QueryResponse</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">    Tuple with two values, identifiers and distances. Both are 1d arrays, positionally correspond, and will contain the</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">    nearest neighbors from [0..k_neighbors)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="n">identifiers</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">VectorIdentifier</span><span class="p">]</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; A `numpy.typing.NDArray[VectorIdentifier]` array of vector identifiers, 1 dimensional &quot;&quot;&quot;</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>    <span class="n">distances</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">    A `numpy.typing.NDAarray[numpy.float32]` of distances as calculated by the distance metric function,  1 dimensional</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="k">class</span><span class="w"> </span><span class="nc">QueryResponseBatch</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    Tuple with two values, identifiers and distances. Both are 2d arrays, with dimensionality determined by the</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">    rows corresponding to the number of queries made, and the columns corresponding to the k neighbors</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">    requested. The two 2d arrays have an implicit, position-based relationship</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="n">identifiers</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">VectorIdentifier</span><span class="p">]</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    A `numpy.typing.NDArray[VectorIdentifier]` array of vector identifiers, 2 dimensional. The row corresponds to index </span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    of the query, and the column corresponds to the k neighbors requested </span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>    <span class="n">distances</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;  </span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">    A `numpy.typing.NDAarray[numpy.float32]` of distances as calculated by the distance metric function, 2 dimensional. </span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">    The row corresponds to the index of the query, and the column corresponds to the distance of the query to the </span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">    *k-th* neighbor </span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaults</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._builder</span><span class="w"> </span><span class="kn">import</span> <span class="n">build_disk_index</span><span class="p">,</span> <span class="n">build_memory_index</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._common</span><span class="w"> </span><span class="kn">import</span> <span class="n">valid_dtype</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._dynamic_memory_index</span><span class="w"> </span><span class="kn">import</span> <span class="n">DynamicMemoryIndex</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._files</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="n">Metadata</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>    <span class="n">tags_from_file</span><span class="p">,</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="n">tags_to_file</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="n">vectors_from_file</span><span class="p">,</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="n">vectors_metadata_from_file</span><span class="p">,</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>    <span class="n">vectors_to_file</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._static_disk_index</span><span class="w"> </span><span class="kn">import</span> <span class="n">StaticDiskIndex</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">._static_memory_index</span><span class="w"> </span><span class="kn">import</span> <span class="n">StaticMemoryIndex</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>    <span class="s2">&quot;build_disk_index&quot;</span><span class="p">,</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="s2">&quot;build_memory_index&quot;</span><span class="p">,</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="s2">&quot;StaticDiskIndex&quot;</span><span class="p">,</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="s2">&quot;StaticMemoryIndex&quot;</span><span class="p">,</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="s2">&quot;DynamicMemoryIndex&quot;</span><span class="p">,</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="s2">&quot;defaults&quot;</span><span class="p">,</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="s2">&quot;DistanceMetric&quot;</span><span class="p">,</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="s2">&quot;VectorDType&quot;</span><span class="p">,</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="s2">&quot;QueryResponse&quot;</span><span class="p">,</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>    <span class="s2">&quot;QueryResponseBatch&quot;</span><span class="p">,</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="s2">&quot;VectorIdentifier&quot;</span><span class="p">,</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>    <span class="s2">&quot;VectorIdentifierBatch&quot;</span><span class="p">,</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="s2">&quot;VectorLike&quot;</span><span class="p">,</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="s2">&quot;VectorLikeBatch&quot;</span><span class="p">,</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="s2">&quot;Metadata&quot;</span><span class="p">,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="s2">&quot;vectors_metadata_from_file&quot;</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="s2">&quot;vectors_to_file&quot;</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="s2">&quot;vectors_from_file&quot;</span><span class="p">,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="s2">&quot;tags_to_file&quot;</span><span class="p">,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="s2">&quot;tags_from_file&quot;</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="s2">&quot;valid_dtype&quot;</span><span class="p">,</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="build_disk_index">
                            <input id="build_disk_index-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_disk_index</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]]</span>,</span><span class="param">	<span class="n">distance_metric</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;mips&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">graph_degree</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">search_memory_maximum</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">build_memory_maximum</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">pq_disk_bytes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ann&#39;</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="build_disk_index-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#build_disk_index"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="build_disk_index-53"><a href="#build_disk_index-53"><span class="linenos"> 53</span></a><span class="k">def</span><span class="w"> </span><span class="nf">build_disk_index</span><span class="p">(</span>
</span><span id="build_disk_index-54"><a href="#build_disk_index-54"><span class="linenos"> 54</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">VectorLikeBatch</span><span class="p">],</span>
</span><span id="build_disk_index-55"><a href="#build_disk_index-55"><span class="linenos"> 55</span></a>    <span class="n">distance_metric</span><span class="p">:</span> <span class="n">DistanceMetric</span><span class="p">,</span>
</span><span id="build_disk_index-56"><a href="#build_disk_index-56"><span class="linenos"> 56</span></a>    <span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="build_disk_index-57"><a href="#build_disk_index-57"><span class="linenos"> 57</span></a>    <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="build_disk_index-58"><a href="#build_disk_index-58"><span class="linenos"> 58</span></a>    <span class="n">graph_degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="build_disk_index-59"><a href="#build_disk_index-59"><span class="linenos"> 59</span></a>    <span class="n">search_memory_maximum</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="build_disk_index-60"><a href="#build_disk_index-60"><span class="linenos"> 60</span></a>    <span class="n">build_memory_maximum</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="build_disk_index-61"><a href="#build_disk_index-61"><span class="linenos"> 61</span></a>    <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="build_disk_index-62"><a href="#build_disk_index-62"><span class="linenos"> 62</span></a>    <span class="n">pq_disk_bytes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">PQ_DISK_BYTES</span><span class="p">,</span>
</span><span id="build_disk_index-63"><a href="#build_disk_index-63"><span class="linenos"> 63</span></a>    <span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="build_disk_index-64"><a href="#build_disk_index-64"><span class="linenos"> 64</span></a>    <span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ann&quot;</span><span class="p">,</span>
</span><span id="build_disk_index-65"><a href="#build_disk_index-65"><span class="linenos"> 65</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="build_disk_index-66"><a href="#build_disk_index-66"><span class="linenos"> 66</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="build_disk_index-67"><a href="#build_disk_index-67"><span class="linenos"> 67</span></a><span class="sd">    This function will construct a DiskANN disk index. Disk indices are ideal for very large datasets that</span>
</span><span id="build_disk_index-68"><a href="#build_disk_index-68"><span class="linenos"> 68</span></a><span class="sd">    are too large to fit in memory. Memory is still used, but it is primarily used to provide precise disk</span>
</span><span id="build_disk_index-69"><a href="#build_disk_index-69"><span class="linenos"> 69</span></a><span class="sd">    locations for fast retrieval of smaller subsets of the index without compromising much on recall.</span>
</span><span id="build_disk_index-70"><a href="#build_disk_index-70"><span class="linenos"> 70</span></a>
</span><span id="build_disk_index-71"><a href="#build_disk_index-71"><span class="linenos"> 71</span></a><span class="sd">    If you provide a numpy array, it will save this array to disk in a temp location</span>
</span><span id="build_disk_index-72"><a href="#build_disk_index-72"><span class="linenos"> 72</span></a><span class="sd">    in the format DiskANN&#39;s PQ Flash Index builder requires. This temp folder is deleted upon index creation completion</span>
</span><span id="build_disk_index-73"><a href="#build_disk_index-73"><span class="linenos"> 73</span></a><span class="sd">    or error.</span>
</span><span id="build_disk_index-74"><a href="#build_disk_index-74"><span class="linenos"> 74</span></a>
</span><span id="build_disk_index-75"><a href="#build_disk_index-75"><span class="linenos"> 75</span></a><span class="sd">    ## Distance Metric and Vector Datatype Restrictions</span>
</span><span id="build_disk_index-76"><a href="#build_disk_index-76"><span class="linenos"> 76</span></a><span class="sd">    | Metric \ Datatype | np.float32 | np.uint8 | np.int8 |</span>
</span><span id="build_disk_index-77"><a href="#build_disk_index-77"><span class="linenos"> 77</span></a><span class="sd">    |-------------------|------------|----------|---------|</span>
</span><span id="build_disk_index-78"><a href="#build_disk_index-78"><span class="linenos"> 78</span></a><span class="sd">    | L2                |           |         |        |</span>
</span><span id="build_disk_index-79"><a href="#build_disk_index-79"><span class="linenos"> 79</span></a><span class="sd">    | MIPS              |           |         |        |</span>
</span><span id="build_disk_index-80"><a href="#build_disk_index-80"><span class="linenos"> 80</span></a><span class="sd">    | Cosine [^bug-in-disk-cosine]     |           |         |        |</span>
</span><span id="build_disk_index-81"><a href="#build_disk_index-81"><span class="linenos"> 81</span></a>
</span><span id="build_disk_index-82"><a href="#build_disk_index-82"><span class="linenos"> 82</span></a><span class="sd">    [^bug-in-disk-cosine]: For StaticDiskIndex, Cosine distances are not currently supported.</span>
</span><span id="build_disk_index-83"><a href="#build_disk_index-83"><span class="linenos"> 83</span></a>
</span><span id="build_disk_index-84"><a href="#build_disk_index-84"><span class="linenos"> 84</span></a><span class="sd">    ### Parameters</span>
</span><span id="build_disk_index-85"><a href="#build_disk_index-85"><span class="linenos"> 85</span></a><span class="sd">    - **data**: Either a `str` representing a path to a DiskANN vector bin file, or a numpy.ndarray,</span>
</span><span id="build_disk_index-86"><a href="#build_disk_index-86"><span class="linenos"> 86</span></a><span class="sd">      of a supported dtype, in 2 dimensions. Note that `vector_dtype` must be provided if data is a `str`</span>
</span><span id="build_disk_index-87"><a href="#build_disk_index-87"><span class="linenos"> 87</span></a><span class="sd">    - **distance_metric**: A `str`, strictly one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;}. `l2` and `cosine` are supported for all 3</span>
</span><span id="build_disk_index-88"><a href="#build_disk_index-88"><span class="linenos"> 88</span></a><span class="sd">      vector dtypes, but `mips` is only available for single precision floats.</span>
</span><span id="build_disk_index-89"><a href="#build_disk_index-89"><span class="linenos"> 89</span></a><span class="sd">    - **index_directory**: The index files will be saved to this **existing** directory path</span>
</span><span id="build_disk_index-90"><a href="#build_disk_index-90"><span class="linenos"> 90</span></a><span class="sd">    - **complexity**: The size of the candidate nearest neighbor list to use when building the index. Values between 75</span>
</span><span id="build_disk_index-91"><a href="#build_disk_index-91"><span class="linenos"> 91</span></a><span class="sd">      and 200 are typical. Larger values will take more time to build but result in indices that provide higher recall</span>
</span><span id="build_disk_index-92"><a href="#build_disk_index-92"><span class="linenos"> 92</span></a><span class="sd">      for the same search complexity. Use a value that is at least as large as `graph_degree` unless you are prepared</span>
</span><span id="build_disk_index-93"><a href="#build_disk_index-93"><span class="linenos"> 93</span></a><span class="sd">      to compromise on quality</span>
</span><span id="build_disk_index-94"><a href="#build_disk_index-94"><span class="linenos"> 94</span></a><span class="sd">    - **graph_degree**: The degree of the graph index, typically between 60 and 150. A larger maximum degree will</span>
</span><span id="build_disk_index-95"><a href="#build_disk_index-95"><span class="linenos"> 95</span></a><span class="sd">      result in larger indices and longer indexing times, but better search quality.</span>
</span><span id="build_disk_index-96"><a href="#build_disk_index-96"><span class="linenos"> 96</span></a><span class="sd">    - **search_memory_maximum**: Build index with the expectation that the search will use at most</span>
</span><span id="build_disk_index-97"><a href="#build_disk_index-97"><span class="linenos"> 97</span></a><span class="sd">      `search_memory_maximum`, in gb.</span>
</span><span id="build_disk_index-98"><a href="#build_disk_index-98"><span class="linenos"> 98</span></a><span class="sd">    - **build_memory_maximum**: Build index using at most `build_memory_maximum` in gb. Building processes typically</span>
</span><span id="build_disk_index-99"><a href="#build_disk_index-99"><span class="linenos"> 99</span></a><span class="sd">      require more memory, while search memory can be reduced.</span>
</span><span id="build_disk_index-100"><a href="#build_disk_index-100"><span class="linenos">100</span></a><span class="sd">    - **num_threads**: Number of threads to use when creating this index. `0` is used to indicate all available</span>
</span><span id="build_disk_index-101"><a href="#build_disk_index-101"><span class="linenos">101</span></a><span class="sd">      logical processors should be used.</span>
</span><span id="build_disk_index-102"><a href="#build_disk_index-102"><span class="linenos">102</span></a><span class="sd">    - **pq_disk_bytes**: Use `0` to store uncompressed data on SSD. This allows the index to asymptote to 100%</span>
</span><span id="build_disk_index-103"><a href="#build_disk_index-103"><span class="linenos">103</span></a><span class="sd">      recall. If your vectors are too large to store in SSD, this parameter provides the option to compress the</span>
</span><span id="build_disk_index-104"><a href="#build_disk_index-104"><span class="linenos">104</span></a><span class="sd">      vectors using PQ for storing on SSD. This will trade off recall. You would also want this to be greater</span>
</span><span id="build_disk_index-105"><a href="#build_disk_index-105"><span class="linenos">105</span></a><span class="sd">      than the number of bytes used for the PQ compressed data stored in-memory. Default is `0`.</span>
</span><span id="build_disk_index-106"><a href="#build_disk_index-106"><span class="linenos">106</span></a><span class="sd">    - **vector_dtype**: Required if the provided `data` is of type `str`, else we use the `data.dtype` if np array.</span>
</span><span id="build_disk_index-107"><a href="#build_disk_index-107"><span class="linenos">107</span></a><span class="sd">    - **index_prefix**: The prefix of the index files. Defaults to &quot;ann&quot;.</span>
</span><span id="build_disk_index-108"><a href="#build_disk_index-108"><span class="linenos">108</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="build_disk_index-109"><a href="#build_disk_index-109"><span class="linenos">109</span></a>
</span><span id="build_disk_index-110"><a href="#build_disk_index-110"><span class="linenos">110</span></a>    <span class="n">_assert</span><span class="p">(</span>
</span><span id="build_disk_index-111"><a href="#build_disk_index-111"><span class="linenos">111</span></a>        <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">vector_dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="build_disk_index-112"><a href="#build_disk_index-112"><span class="linenos">112</span></a>        <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span>
</span><span id="build_disk_index-113"><a href="#build_disk_index-113"><span class="linenos">113</span></a>        <span class="s2">&quot;vector_dtype is required if data is a str representing a path to the vector bin file&quot;</span><span class="p">,</span>
</span><span id="build_disk_index-114"><a href="#build_disk_index-114"><span class="linenos">114</span></a>    <span class="p">)</span>
</span><span id="build_disk_index-115"><a href="#build_disk_index-115"><span class="linenos">115</span></a>    <span class="n">dap_metric</span> <span class="o">=</span> <span class="n">_valid_metric</span><span class="p">(</span><span class="n">distance_metric</span><span class="p">)</span>
</span><span id="build_disk_index-116"><a href="#build_disk_index-116"><span class="linenos">116</span></a>    <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="build_disk_index-117"><a href="#build_disk_index-117"><span class="linenos">117</span></a>    <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">graph_degree</span><span class="p">,</span> <span class="s2">&quot;graph_degree&quot;</span><span class="p">)</span>
</span><span id="build_disk_index-118"><a href="#build_disk_index-118"><span class="linenos">118</span></a>    <span class="n">_assert</span><span class="p">(</span><span class="n">search_memory_maximum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;search_memory_maximum must be larger than 0&quot;</span><span class="p">)</span>
</span><span id="build_disk_index-119"><a href="#build_disk_index-119"><span class="linenos">119</span></a>    <span class="n">_assert</span><span class="p">(</span><span class="n">build_memory_maximum</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;build_memory_maximum must be larger than 0&quot;</span><span class="p">)</span>
</span><span id="build_disk_index-120"><a href="#build_disk_index-120"><span class="linenos">120</span></a>    <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="build_disk_index-121"><a href="#build_disk_index-121"><span class="linenos">121</span></a>    <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">pq_disk_bytes</span><span class="p">,</span> <span class="s2">&quot;pq_disk_bytes&quot;</span><span class="p">)</span>
</span><span id="build_disk_index-122"><a href="#build_disk_index-122"><span class="linenos">122</span></a>    <span class="n">_assert</span><span class="p">(</span><span class="n">index_prefix</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;index_prefix cannot be an empty string&quot;</span><span class="p">)</span>
</span><span id="build_disk_index-123"><a href="#build_disk_index-123"><span class="linenos">123</span></a>
</span><span id="build_disk_index-124"><a href="#build_disk_index-124"><span class="linenos">124</span></a>    <span class="n">index_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">index_directory</span><span class="p">)</span>
</span><span id="build_disk_index-125"><a href="#build_disk_index-125"><span class="linenos">125</span></a>    <span class="n">_assert</span><span class="p">(</span>
</span><span id="build_disk_index-126"><a href="#build_disk_index-126"><span class="linenos">126</span></a>        <span class="n">index_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">index_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">(),</span>
</span><span id="build_disk_index-127"><a href="#build_disk_index-127"><span class="linenos">127</span></a>        <span class="s2">&quot;index_directory must both exist and be a directory&quot;</span><span class="p">,</span>
</span><span id="build_disk_index-128"><a href="#build_disk_index-128"><span class="linenos">128</span></a>    <span class="p">)</span>
</span><span id="build_disk_index-129"><a href="#build_disk_index-129"><span class="linenos">129</span></a>
</span><span id="build_disk_index-130"><a href="#build_disk_index-130"><span class="linenos">130</span></a>    <span class="n">vector_bin_path</span><span class="p">,</span> <span class="n">vector_dtype_actual</span> <span class="o">=</span> <span class="n">_valid_path_and_dtype</span><span class="p">(</span>
</span><span id="build_disk_index-131"><a href="#build_disk_index-131"><span class="linenos">131</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">vector_dtype</span><span class="p">,</span> <span class="n">index_directory</span><span class="p">,</span> <span class="n">index_prefix</span>
</span><span id="build_disk_index-132"><a href="#build_disk_index-132"><span class="linenos">132</span></a>    <span class="p">)</span>
</span><span id="build_disk_index-133"><a href="#build_disk_index-133"><span class="linenos">133</span></a>    <span class="n">_assert</span><span class="p">(</span><span class="n">dap_metric</span> <span class="o">!=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">COSINE</span><span class="p">,</span> <span class="s2">&quot;Cosine is currently not supported in StaticDiskIndex&quot;</span><span class="p">)</span>
</span><span id="build_disk_index-134"><a href="#build_disk_index-134"><span class="linenos">134</span></a>    <span class="k">if</span> <span class="n">dap_metric</span> <span class="o">==</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">INNER_PRODUCT</span><span class="p">:</span>
</span><span id="build_disk_index-135"><a href="#build_disk_index-135"><span class="linenos">135</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="build_disk_index-136"><a href="#build_disk_index-136"><span class="linenos">136</span></a>            <span class="n">vector_dtype_actual</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="build_disk_index-137"><a href="#build_disk_index-137"><span class="linenos">137</span></a>            <span class="s2">&quot;Integral vector dtypes (np.uint8, np.int8) are not supported with distance metric mips&quot;</span>
</span><span id="build_disk_index-138"><a href="#build_disk_index-138"><span class="linenos">138</span></a>        <span class="p">)</span>
</span><span id="build_disk_index-139"><a href="#build_disk_index-139"><span class="linenos">139</span></a>
</span><span id="build_disk_index-140"><a href="#build_disk_index-140"><span class="linenos">140</span></a>    <span class="n">num_points</span><span class="p">,</span> <span class="n">dimensions</span> <span class="o">=</span> <span class="n">vectors_metadata_from_file</span><span class="p">(</span><span class="n">vector_bin_path</span><span class="p">)</span>
</span><span id="build_disk_index-141"><a href="#build_disk_index-141"><span class="linenos">141</span></a>
</span><span id="build_disk_index-142"><a href="#build_disk_index-142"><span class="linenos">142</span></a>    <span class="k">if</span> <span class="n">vector_dtype_actual</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="build_disk_index-143"><a href="#build_disk_index-143"><span class="linenos">143</span></a>        <span class="n">_builder</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">build_disk_uint8_index</span>
</span><span id="build_disk_index-144"><a href="#build_disk_index-144"><span class="linenos">144</span></a>    <span class="k">elif</span> <span class="n">vector_dtype_actual</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
</span><span id="build_disk_index-145"><a href="#build_disk_index-145"><span class="linenos">145</span></a>        <span class="n">_builder</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">build_disk_int8_index</span>
</span><span id="build_disk_index-146"><a href="#build_disk_index-146"><span class="linenos">146</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="build_disk_index-147"><a href="#build_disk_index-147"><span class="linenos">147</span></a>        <span class="n">_builder</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">build_disk_float_index</span>
</span><span id="build_disk_index-148"><a href="#build_disk_index-148"><span class="linenos">148</span></a>
</span><span id="build_disk_index-149"><a href="#build_disk_index-149"><span class="linenos">149</span></a>    <span class="n">index_prefix_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">index_directory</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">)</span>
</span><span id="build_disk_index-150"><a href="#build_disk_index-150"><span class="linenos">150</span></a>
</span><span id="build_disk_index-151"><a href="#build_disk_index-151"><span class="linenos">151</span></a>    <span class="n">_builder</span><span class="p">(</span>
</span><span id="build_disk_index-152"><a href="#build_disk_index-152"><span class="linenos">152</span></a>        <span class="n">distance_metric</span><span class="o">=</span><span class="n">dap_metric</span><span class="p">,</span>
</span><span id="build_disk_index-153"><a href="#build_disk_index-153"><span class="linenos">153</span></a>        <span class="n">data_file_path</span><span class="o">=</span><span class="n">vector_bin_path</span><span class="p">,</span>
</span><span id="build_disk_index-154"><a href="#build_disk_index-154"><span class="linenos">154</span></a>        <span class="n">index_prefix_path</span><span class="o">=</span><span class="n">index_prefix_path</span><span class="p">,</span>
</span><span id="build_disk_index-155"><a href="#build_disk_index-155"><span class="linenos">155</span></a>        <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="build_disk_index-156"><a href="#build_disk_index-156"><span class="linenos">156</span></a>        <span class="n">graph_degree</span><span class="o">=</span><span class="n">graph_degree</span><span class="p">,</span>
</span><span id="build_disk_index-157"><a href="#build_disk_index-157"><span class="linenos">157</span></a>        <span class="n">final_index_ram_limit</span><span class="o">=</span><span class="n">search_memory_maximum</span><span class="p">,</span>
</span><span id="build_disk_index-158"><a href="#build_disk_index-158"><span class="linenos">158</span></a>        <span class="n">indexing_ram_budget</span><span class="o">=</span><span class="n">build_memory_maximum</span><span class="p">,</span>
</span><span id="build_disk_index-159"><a href="#build_disk_index-159"><span class="linenos">159</span></a>        <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="build_disk_index-160"><a href="#build_disk_index-160"><span class="linenos">160</span></a>        <span class="n">pq_disk_bytes</span><span class="o">=</span><span class="n">pq_disk_bytes</span><span class="p">,</span>
</span><span id="build_disk_index-161"><a href="#build_disk_index-161"><span class="linenos">161</span></a>    <span class="p">)</span>
</span><span id="build_disk_index-162"><a href="#build_disk_index-162"><span class="linenos">162</span></a>    <span class="n">_write_index_metadata</span><span class="p">(</span>
</span><span id="build_disk_index-163"><a href="#build_disk_index-163"><span class="linenos">163</span></a>        <span class="n">index_prefix_path</span><span class="p">,</span> <span class="n">vector_dtype_actual</span><span class="p">,</span> <span class="n">dap_metric</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">dimensions</span>
</span><span id="build_disk_index-164"><a href="#build_disk_index-164"><span class="linenos">164</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function will construct a DiskANN disk index. Disk indices are ideal for very large datasets that
are too large to fit in memory. Memory is still used, but it is primarily used to provide precise disk
locations for fast retrieval of smaller subsets of the index without compromising much on recall.</p>

<p>If you provide a numpy array, it will save this array to disk in a temp location
in the format DiskANN's PQ Flash Index builder requires. This temp folder is deleted upon index creation completion
or error.</p>

<h2 id="distance-metric-and-vector-datatype-restrictions">Distance Metric and Vector Datatype Restrictions</h2>

<table>
<thead>
<tr>
  <th>Metric \ Datatype</th>
  <th>np.float32</th>
  <th>np.uint8</th>
  <th>np.int8</th>
</tr>
</thead>
<tbody>
<tr>
  <td>L2</td>
  <td></td>
  <td></td>
  <td></td>
</tr>
<tr>
  <td>MIPS</td>
  <td></td>
  <td></td>
  <td></td>
</tr>
<tr>
  <td>Cosine <sup class="footnote-ref" id="fnref-bug-in-disk-cosine"><a href="#fn-bug-in-disk-cosine">1</a></sup></td>
  <td></td>
  <td></td>
  <td></td>
</tr>
</tbody>
</table>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>data</strong>: Either a <code>str</code> representing a path to a DiskANN vector bin file, or a numpy.ndarray,
of a supported dtype, in 2 dimensions. Note that <code>vector_dtype</code> must be provided if data is a <code>str</code></li>
<li><strong>distance_metric</strong>: A <code>str</code>, strictly one of {"l2", "mips", "cosine"}. <code>l2</code> and <code>cosine</code> are supported for all 3
vector dtypes, but <code>mips</code> is only available for single precision floats.</li>
<li><strong>index_directory</strong>: The index files will be saved to this <strong>existing</strong> directory path</li>
<li><strong>complexity</strong>: The size of the candidate nearest neighbor list to use when building the index. Values between 75
and 200 are typical. Larger values will take more time to build but result in indices that provide higher recall
for the same search complexity. Use a value that is at least as large as <code>graph_degree</code> unless you are prepared
to compromise on quality</li>
<li><strong>graph_degree</strong>: The degree of the graph index, typically between 60 and 150. A larger maximum degree will
result in larger indices and longer indexing times, but better search quality.</li>
<li><strong>search_memory_maximum</strong>: Build index with the expectation that the search will use at most
<code>search_memory_maximum</code>, in gb.</li>
<li><strong>build_memory_maximum</strong>: Build index using at most <code>build_memory_maximum</code> in gb. Building processes typically
require more memory, while search memory can be reduced.</li>
<li><strong>num_threads</strong>: Number of threads to use when creating this index. <code>0</code> is used to indicate all available
logical processors should be used.</li>
<li><strong>pq_disk_bytes</strong>: Use <code>0</code> to store uncompressed data on SSD. This allows the index to asymptote to 100%
recall. If your vectors are too large to store in SSD, this parameter provides the option to compress the
vectors using PQ for storing on SSD. This will trade off recall. You would also want this to be greater
than the number of bytes used for the PQ compressed data stored in-memory. Default is <code>0</code>.</li>
<li><strong>vector_dtype</strong>: Required if the provided <code>data</code> is of type <code>str</code>, else we use the <code>data.dtype</code> if np array.</li>
<li><strong>index_prefix</strong>: The prefix of the index files. Defaults to "ann".</li>
</ul>

<div class="footnotes">
<hr />
<ol>
<li id="fn-bug-in-disk-cosine">
<p>For StaticDiskIndex, Cosine distances are not currently supported.&#160;<a href="#fnref-bug-in-disk-cosine" class="footnoteBackLink" title="Jump back to footnote 1 in the text.">&#8617;</a></p>
</li>
</ol>
</div>
</div>


                </section>
                <section id="build_memory_index">
                            <input id="build_memory_index-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">build_memory_index</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]]</span>,</span><span class="param">	<span class="n">distance_metric</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;mips&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">graph_degree</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.2000000476837158</span>,</span><span class="param">	<span class="n">use_pq_build</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">num_pq_bytes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">use_opq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">tags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">filter_labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">universal_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">filter_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ann&#39;</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="build_memory_index-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#build_memory_index"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="build_memory_index-167"><a href="#build_memory_index-167"><span class="linenos">167</span></a><span class="k">def</span><span class="w"> </span><span class="nf">build_memory_index</span><span class="p">(</span>
</span><span id="build_memory_index-168"><a href="#build_memory_index-168"><span class="linenos">168</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">VectorLikeBatch</span><span class="p">],</span>
</span><span id="build_memory_index-169"><a href="#build_memory_index-169"><span class="linenos">169</span></a>    <span class="n">distance_metric</span><span class="p">:</span> <span class="n">DistanceMetric</span><span class="p">,</span>
</span><span id="build_memory_index-170"><a href="#build_memory_index-170"><span class="linenos">170</span></a>    <span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="build_memory_index-171"><a href="#build_memory_index-171"><span class="linenos">171</span></a>    <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="build_memory_index-172"><a href="#build_memory_index-172"><span class="linenos">172</span></a>    <span class="n">graph_degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="build_memory_index-173"><a href="#build_memory_index-173"><span class="linenos">173</span></a>    <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="build_memory_index-174"><a href="#build_memory_index-174"><span class="linenos">174</span></a>    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">ALPHA</span><span class="p">,</span>
</span><span id="build_memory_index-175"><a href="#build_memory_index-175"><span class="linenos">175</span></a>    <span class="n">use_pq_build</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">USE_PQ_BUILD</span><span class="p">,</span>
</span><span id="build_memory_index-176"><a href="#build_memory_index-176"><span class="linenos">176</span></a>    <span class="n">num_pq_bytes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">NUM_PQ_BYTES</span><span class="p">,</span>
</span><span id="build_memory_index-177"><a href="#build_memory_index-177"><span class="linenos">177</span></a>    <span class="n">use_opq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">USE_OPQ</span><span class="p">,</span>
</span><span id="build_memory_index-178"><a href="#build_memory_index-178"><span class="linenos">178</span></a>    <span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="build_memory_index-179"><a href="#build_memory_index-179"><span class="linenos">179</span></a>    <span class="n">tags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">VectorIdentifierBatch</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="build_memory_index-180"><a href="#build_memory_index-180"><span class="linenos">180</span></a>    <span class="n">filter_labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="build_memory_index-181"><a href="#build_memory_index-181"><span class="linenos">181</span></a>    <span class="n">universal_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="build_memory_index-182"><a href="#build_memory_index-182"><span class="linenos">182</span></a>    <span class="n">filter_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">FILTER_COMPLEXITY</span><span class="p">,</span>
</span><span id="build_memory_index-183"><a href="#build_memory_index-183"><span class="linenos">183</span></a>    <span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ann&quot;</span><span class="p">,</span>
</span><span id="build_memory_index-184"><a href="#build_memory_index-184"><span class="linenos">184</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="build_memory_index-185"><a href="#build_memory_index-185"><span class="linenos">185</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="build_memory_index-186"><a href="#build_memory_index-186"><span class="linenos">186</span></a><span class="sd">    This function will construct a DiskANN memory index. Memory indices are ideal for smaller datasets whose</span>
</span><span id="build_memory_index-187"><a href="#build_memory_index-187"><span class="linenos">187</span></a><span class="sd">    indices can fit into memory. Memory indices are faster than disk indices, but usually cannot scale to massive</span>
</span><span id="build_memory_index-188"><a href="#build_memory_index-188"><span class="linenos">188</span></a><span class="sd">    sizes in an individual index on an individual machine.</span>
</span><span id="build_memory_index-189"><a href="#build_memory_index-189"><span class="linenos">189</span></a>
</span><span id="build_memory_index-190"><a href="#build_memory_index-190"><span class="linenos">190</span></a><span class="sd">    `diskannpy`&#39;s memory indices take two forms: a `diskannpy.StaticMemoryIndex`, which will not be mutated, only</span>
</span><span id="build_memory_index-191"><a href="#build_memory_index-191"><span class="linenos">191</span></a><span class="sd">    searched upon, and a `diskannpy.DynamicMemoryIndex`, which can be mutated AND searched upon in the same process.</span>
</span><span id="build_memory_index-192"><a href="#build_memory_index-192"><span class="linenos">192</span></a>
</span><span id="build_memory_index-193"><a href="#build_memory_index-193"><span class="linenos">193</span></a><span class="sd">    ## Important Note:</span>
</span><span id="build_memory_index-194"><a href="#build_memory_index-194"><span class="linenos">194</span></a><span class="sd">    You **must** determine the type of index you are building for. If you are building for a</span>
</span><span id="build_memory_index-195"><a href="#build_memory_index-195"><span class="linenos">195</span></a><span class="sd">    `diskannpy.DynamicMemoryIndex`, you **must** supply a valid value for the `tags` parameter. **Do not supply</span>
</span><span id="build_memory_index-196"><a href="#build_memory_index-196"><span class="linenos">196</span></a><span class="sd">    tags if the index is intended to be `diskannpy.StaticMemoryIndex`**!</span>
</span><span id="build_memory_index-197"><a href="#build_memory_index-197"><span class="linenos">197</span></a>
</span><span id="build_memory_index-198"><a href="#build_memory_index-198"><span class="linenos">198</span></a><span class="sd">    ## Distance Metric and Vector Datatype Restrictions</span>
</span><span id="build_memory_index-199"><a href="#build_memory_index-199"><span class="linenos">199</span></a>
</span><span id="build_memory_index-200"><a href="#build_memory_index-200"><span class="linenos">200</span></a><span class="sd">    | Metric \ Datatype | np.float32 | np.uint8 | np.int8 |</span>
</span><span id="build_memory_index-201"><a href="#build_memory_index-201"><span class="linenos">201</span></a><span class="sd">    |-------------------|------------|----------|---------|</span>
</span><span id="build_memory_index-202"><a href="#build_memory_index-202"><span class="linenos">202</span></a><span class="sd">    | L2                |           |         |        |</span>
</span><span id="build_memory_index-203"><a href="#build_memory_index-203"><span class="linenos">203</span></a><span class="sd">    | MIPS              |           |         |        |</span>
</span><span id="build_memory_index-204"><a href="#build_memory_index-204"><span class="linenos">204</span></a><span class="sd">    | Cosine            |           |         |        |</span>
</span><span id="build_memory_index-205"><a href="#build_memory_index-205"><span class="linenos">205</span></a>
</span><span id="build_memory_index-206"><a href="#build_memory_index-206"><span class="linenos">206</span></a><span class="sd">    ### Parameters</span>
</span><span id="build_memory_index-207"><a href="#build_memory_index-207"><span class="linenos">207</span></a>
</span><span id="build_memory_index-208"><a href="#build_memory_index-208"><span class="linenos">208</span></a><span class="sd">    - **data**: Either a `str` representing a path to an existing DiskANN vector bin file, or a numpy.ndarray of a</span>
</span><span id="build_memory_index-209"><a href="#build_memory_index-209"><span class="linenos">209</span></a><span class="sd">      supported dtype in 2 dimensions. Note that `vector_dtype` must be provided if `data` is a `str`.</span>
</span><span id="build_memory_index-210"><a href="#build_memory_index-210"><span class="linenos">210</span></a><span class="sd">    - **distance_metric**: A `str`, strictly one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;}. `l2` and `cosine` are supported for all 3</span>
</span><span id="build_memory_index-211"><a href="#build_memory_index-211"><span class="linenos">211</span></a><span class="sd">      vector dtypes, but `mips` is only available for single precision floats.</span>
</span><span id="build_memory_index-212"><a href="#build_memory_index-212"><span class="linenos">212</span></a><span class="sd">    - **index_directory**: The index files will be saved to this **existing** directory path</span>
</span><span id="build_memory_index-213"><a href="#build_memory_index-213"><span class="linenos">213</span></a><span class="sd">    - **complexity**: The size of the candidate nearest neighbor list to use when building the index. Values between 75</span>
</span><span id="build_memory_index-214"><a href="#build_memory_index-214"><span class="linenos">214</span></a><span class="sd">      and 200 are typical. Larger values will take more time to build but result in indices that provide higher recall</span>
</span><span id="build_memory_index-215"><a href="#build_memory_index-215"><span class="linenos">215</span></a><span class="sd">      for the same search complexity. Use a value that is at least as large as `graph_degree` unless you are prepared</span>
</span><span id="build_memory_index-216"><a href="#build_memory_index-216"><span class="linenos">216</span></a><span class="sd">      to compromise on quality</span>
</span><span id="build_memory_index-217"><a href="#build_memory_index-217"><span class="linenos">217</span></a><span class="sd">    - **graph_degree**: The degree of the graph index, typically between 60 and 150. A larger maximum degree will</span>
</span><span id="build_memory_index-218"><a href="#build_memory_index-218"><span class="linenos">218</span></a><span class="sd">      result in larger indices and longer indexing times, but better search quality.</span>
</span><span id="build_memory_index-219"><a href="#build_memory_index-219"><span class="linenos">219</span></a><span class="sd">    - **num_threads**: Number of threads to use when creating this index. `0` is used to indicate all available</span>
</span><span id="build_memory_index-220"><a href="#build_memory_index-220"><span class="linenos">220</span></a><span class="sd">      logical processors should be used.</span>
</span><span id="build_memory_index-221"><a href="#build_memory_index-221"><span class="linenos">221</span></a><span class="sd">    - **alpha**: The alpha parameter (&gt;=1) is used to control the nature and number of points that are added to the</span>
</span><span id="build_memory_index-222"><a href="#build_memory_index-222"><span class="linenos">222</span></a><span class="sd">      graph. A higher alpha value (e.g., 1.4) will result in fewer hops (and IOs) to convergence, but probably more</span>
</span><span id="build_memory_index-223"><a href="#build_memory_index-223"><span class="linenos">223</span></a><span class="sd">      distance comparisons compared to a lower alpha value.</span>
</span><span id="build_memory_index-224"><a href="#build_memory_index-224"><span class="linenos">224</span></a><span class="sd">    - **use_pq_build**: Use product quantization during build. Product quantization is a lossy compression technique</span>
</span><span id="build_memory_index-225"><a href="#build_memory_index-225"><span class="linenos">225</span></a><span class="sd">      that can reduce the size of the index on disk. This will trade off recall. Default is `True`.</span>
</span><span id="build_memory_index-226"><a href="#build_memory_index-226"><span class="linenos">226</span></a><span class="sd">    - **num_pq_bytes**: The number of bytes used to store the PQ compressed data in memory. This will trade off recall.</span>
</span><span id="build_memory_index-227"><a href="#build_memory_index-227"><span class="linenos">227</span></a><span class="sd">      Default is `0`.</span>
</span><span id="build_memory_index-228"><a href="#build_memory_index-228"><span class="linenos">228</span></a><span class="sd">    - **use_opq**: Use optimized product quantization during build.</span>
</span><span id="build_memory_index-229"><a href="#build_memory_index-229"><span class="linenos">229</span></a><span class="sd">    - **vector_dtype**: Required if the provided `data` is of type `str`, else we use the `data.dtype` if np array.</span>
</span><span id="build_memory_index-230"><a href="#build_memory_index-230"><span class="linenos">230</span></a><span class="sd">    - **tags**: Tags can be defined either as a path on disk to an existing .tags file, or provided as a np.array of</span>
</span><span id="build_memory_index-231"><a href="#build_memory_index-231"><span class="linenos">231</span></a><span class="sd">      the same length as the number of vectors. Tags are used to identify vectors in the index via your *own*</span>
</span><span id="build_memory_index-232"><a href="#build_memory_index-232"><span class="linenos">232</span></a><span class="sd">      numbering conventions, and is absolutely required for loading DynamicMemoryIndex indices `from_file`.</span>
</span><span id="build_memory_index-233"><a href="#build_memory_index-233"><span class="linenos">233</span></a><span class="sd">    - **filter_labels**: An optional, but exhaustive list of categories for each vector. This is used to filter</span>
</span><span id="build_memory_index-234"><a href="#build_memory_index-234"><span class="linenos">234</span></a><span class="sd">      search results by category. If provided, this must be a list of lists, where each inner list is a list of</span>
</span><span id="build_memory_index-235"><a href="#build_memory_index-235"><span class="linenos">235</span></a><span class="sd">      categories for the corresponding vector. For example, if you have 3 vectors, and the first vector belongs to</span>
</span><span id="build_memory_index-236"><a href="#build_memory_index-236"><span class="linenos">236</span></a><span class="sd">      categories &quot;a&quot; and &quot;b&quot;, the second vector belongs to category &quot;b&quot;, and the third vector belongs to no categories,</span>
</span><span id="build_memory_index-237"><a href="#build_memory_index-237"><span class="linenos">237</span></a><span class="sd">      you would provide `filter_labels=[[&quot;a&quot;, &quot;b&quot;], [&quot;b&quot;], []]`. If you do not want to provide categories for a</span>
</span><span id="build_memory_index-238"><a href="#build_memory_index-238"><span class="linenos">238</span></a><span class="sd">      particular vector, you can provide an empty list. If you do not want to provide categories for any vectors,</span>
</span><span id="build_memory_index-239"><a href="#build_memory_index-239"><span class="linenos">239</span></a><span class="sd">      you can provide `None` for this parameter (which is the default)</span>
</span><span id="build_memory_index-240"><a href="#build_memory_index-240"><span class="linenos">240</span></a><span class="sd">    - **universal_label**: An optional label that indicates that this vector should be included in *every* search</span>
</span><span id="build_memory_index-241"><a href="#build_memory_index-241"><span class="linenos">241</span></a><span class="sd">      in which it also meets the knn search criteria.</span>
</span><span id="build_memory_index-242"><a href="#build_memory_index-242"><span class="linenos">242</span></a><span class="sd">    - **filter_complexity**: Complexity to use when using filters. Default is 0. 0 is strictly invalid if you are</span>
</span><span id="build_memory_index-243"><a href="#build_memory_index-243"><span class="linenos">243</span></a><span class="sd">      using filters.</span>
</span><span id="build_memory_index-244"><a href="#build_memory_index-244"><span class="linenos">244</span></a><span class="sd">    - **index_prefix**: The prefix of the index files. Defaults to &quot;ann&quot;.</span>
</span><span id="build_memory_index-245"><a href="#build_memory_index-245"><span class="linenos">245</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="build_memory_index-246"><a href="#build_memory_index-246"><span class="linenos">246</span></a>    <span class="n">_assert</span><span class="p">(</span>
</span><span id="build_memory_index-247"><a href="#build_memory_index-247"><span class="linenos">247</span></a>        <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">vector_dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="build_memory_index-248"><a href="#build_memory_index-248"><span class="linenos">248</span></a>        <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span>
</span><span id="build_memory_index-249"><a href="#build_memory_index-249"><span class="linenos">249</span></a>        <span class="s2">&quot;vector_dtype is required if data is a str representing a path to the vector bin file&quot;</span><span class="p">,</span>
</span><span id="build_memory_index-250"><a href="#build_memory_index-250"><span class="linenos">250</span></a>    <span class="p">)</span>
</span><span id="build_memory_index-251"><a href="#build_memory_index-251"><span class="linenos">251</span></a>    <span class="n">dap_metric</span> <span class="o">=</span> <span class="n">_valid_metric</span><span class="p">(</span><span class="n">distance_metric</span><span class="p">)</span>
</span><span id="build_memory_index-252"><a href="#build_memory_index-252"><span class="linenos">252</span></a>    <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="build_memory_index-253"><a href="#build_memory_index-253"><span class="linenos">253</span></a>    <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">graph_degree</span><span class="p">,</span> <span class="s2">&quot;graph_degree&quot;</span><span class="p">)</span>
</span><span id="build_memory_index-254"><a href="#build_memory_index-254"><span class="linenos">254</span></a>    <span class="n">_assert</span><span class="p">(</span>
</span><span id="build_memory_index-255"><a href="#build_memory_index-255"><span class="linenos">255</span></a>        <span class="n">alpha</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="build_memory_index-256"><a href="#build_memory_index-256"><span class="linenos">256</span></a>        <span class="s2">&quot;alpha must be &gt;= 1, and realistically should be kept between [1.0, 2.0)&quot;</span><span class="p">,</span>
</span><span id="build_memory_index-257"><a href="#build_memory_index-257"><span class="linenos">257</span></a>    <span class="p">)</span>
</span><span id="build_memory_index-258"><a href="#build_memory_index-258"><span class="linenos">258</span></a>    <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="build_memory_index-259"><a href="#build_memory_index-259"><span class="linenos">259</span></a>    <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_pq_bytes</span><span class="p">,</span> <span class="s2">&quot;num_pq_bytes&quot;</span><span class="p">)</span>
</span><span id="build_memory_index-260"><a href="#build_memory_index-260"><span class="linenos">260</span></a>    <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">filter_complexity</span><span class="p">,</span> <span class="s2">&quot;filter_complexity&quot;</span><span class="p">)</span>
</span><span id="build_memory_index-261"><a href="#build_memory_index-261"><span class="linenos">261</span></a>    <span class="n">_assert</span><span class="p">(</span><span class="n">index_prefix</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;index_prefix cannot be an empty string&quot;</span><span class="p">)</span>
</span><span id="build_memory_index-262"><a href="#build_memory_index-262"><span class="linenos">262</span></a>    <span class="n">_assert</span><span class="p">(</span>
</span><span id="build_memory_index-263"><a href="#build_memory_index-263"><span class="linenos">263</span></a>        <span class="n">filter_labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">filter_complexity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="build_memory_index-264"><a href="#build_memory_index-264"><span class="linenos">264</span></a>        <span class="s2">&quot;if filter_labels is provided, filter_complexity must not be 0&quot;</span>
</span><span id="build_memory_index-265"><a href="#build_memory_index-265"><span class="linenos">265</span></a>    <span class="p">)</span>
</span><span id="build_memory_index-266"><a href="#build_memory_index-266"><span class="linenos">266</span></a>
</span><span id="build_memory_index-267"><a href="#build_memory_index-267"><span class="linenos">267</span></a>    <span class="n">index_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">index_directory</span><span class="p">)</span>
</span><span id="build_memory_index-268"><a href="#build_memory_index-268"><span class="linenos">268</span></a>    <span class="n">_assert</span><span class="p">(</span>
</span><span id="build_memory_index-269"><a href="#build_memory_index-269"><span class="linenos">269</span></a>        <span class="n">index_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">index_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">(),</span>
</span><span id="build_memory_index-270"><a href="#build_memory_index-270"><span class="linenos">270</span></a>        <span class="s2">&quot;index_directory must both exist and be a directory&quot;</span><span class="p">,</span>
</span><span id="build_memory_index-271"><a href="#build_memory_index-271"><span class="linenos">271</span></a>    <span class="p">)</span>
</span><span id="build_memory_index-272"><a href="#build_memory_index-272"><span class="linenos">272</span></a>
</span><span id="build_memory_index-273"><a href="#build_memory_index-273"><span class="linenos">273</span></a>    <span class="n">vector_bin_path</span><span class="p">,</span> <span class="n">vector_dtype_actual</span> <span class="o">=</span> <span class="n">_valid_path_and_dtype</span><span class="p">(</span>
</span><span id="build_memory_index-274"><a href="#build_memory_index-274"><span class="linenos">274</span></a>        <span class="n">data</span><span class="p">,</span> <span class="n">vector_dtype</span><span class="p">,</span> <span class="n">index_directory</span><span class="p">,</span> <span class="n">index_prefix</span>
</span><span id="build_memory_index-275"><a href="#build_memory_index-275"><span class="linenos">275</span></a>    <span class="p">)</span>
</span><span id="build_memory_index-276"><a href="#build_memory_index-276"><span class="linenos">276</span></a>    <span class="k">if</span> <span class="n">dap_metric</span> <span class="o">==</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">INNER_PRODUCT</span><span class="p">:</span>
</span><span id="build_memory_index-277"><a href="#build_memory_index-277"><span class="linenos">277</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="build_memory_index-278"><a href="#build_memory_index-278"><span class="linenos">278</span></a>            <span class="n">vector_dtype_actual</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="build_memory_index-279"><a href="#build_memory_index-279"><span class="linenos">279</span></a>            <span class="s2">&quot;Integral vector dtypes (np.uint8, np.int8) are not supported with distance metric mips&quot;</span>
</span><span id="build_memory_index-280"><a href="#build_memory_index-280"><span class="linenos">280</span></a>        <span class="p">)</span>
</span><span id="build_memory_index-281"><a href="#build_memory_index-281"><span class="linenos">281</span></a>
</span><span id="build_memory_index-282"><a href="#build_memory_index-282"><span class="linenos">282</span></a>    <span class="n">num_points</span><span class="p">,</span> <span class="n">dimensions</span> <span class="o">=</span> <span class="n">vectors_metadata_from_file</span><span class="p">(</span><span class="n">vector_bin_path</span><span class="p">)</span>
</span><span id="build_memory_index-283"><a href="#build_memory_index-283"><span class="linenos">283</span></a>    <span class="k">if</span> <span class="n">filter_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="build_memory_index-284"><a href="#build_memory_index-284"><span class="linenos">284</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="build_memory_index-285"><a href="#build_memory_index-285"><span class="linenos">285</span></a>            <span class="nb">len</span><span class="p">(</span><span class="n">filter_labels</span><span class="p">)</span> <span class="o">==</span> <span class="n">num_points</span><span class="p">,</span>
</span><span id="build_memory_index-286"><a href="#build_memory_index-286"><span class="linenos">286</span></a>            <span class="s2">&quot;filter_labels must be the same length as the number of points&quot;</span>
</span><span id="build_memory_index-287"><a href="#build_memory_index-287"><span class="linenos">287</span></a>        <span class="p">)</span>
</span><span id="build_memory_index-288"><a href="#build_memory_index-288"><span class="linenos">288</span></a>
</span><span id="build_memory_index-289"><a href="#build_memory_index-289"><span class="linenos">289</span></a>    <span class="k">if</span> <span class="n">vector_dtype_actual</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="build_memory_index-290"><a href="#build_memory_index-290"><span class="linenos">290</span></a>        <span class="n">_builder</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">build_memory_uint8_index</span>
</span><span id="build_memory_index-291"><a href="#build_memory_index-291"><span class="linenos">291</span></a>    <span class="k">elif</span> <span class="n">vector_dtype_actual</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
</span><span id="build_memory_index-292"><a href="#build_memory_index-292"><span class="linenos">292</span></a>        <span class="n">_builder</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">build_memory_int8_index</span>
</span><span id="build_memory_index-293"><a href="#build_memory_index-293"><span class="linenos">293</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="build_memory_index-294"><a href="#build_memory_index-294"><span class="linenos">294</span></a>        <span class="n">_builder</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">build_memory_float_index</span>
</span><span id="build_memory_index-295"><a href="#build_memory_index-295"><span class="linenos">295</span></a>
</span><span id="build_memory_index-296"><a href="#build_memory_index-296"><span class="linenos">296</span></a>    <span class="n">index_prefix_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">index_directory</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">)</span>
</span><span id="build_memory_index-297"><a href="#build_memory_index-297"><span class="linenos">297</span></a>
</span><span id="build_memory_index-298"><a href="#build_memory_index-298"><span class="linenos">298</span></a>    <span class="n">filter_labels_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="build_memory_index-299"><a href="#build_memory_index-299"><span class="linenos">299</span></a>    <span class="k">if</span> <span class="n">filter_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="build_memory_index-300"><a href="#build_memory_index-300"><span class="linenos">300</span></a>        <span class="n">label_counts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="build_memory_index-301"><a href="#build_memory_index-301"><span class="linenos">301</span></a>        <span class="n">filter_labels_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index_prefix_path</span><span class="si">}</span><span class="s2">_pylabels.txt&quot;</span>
</span><span id="build_memory_index-302"><a href="#build_memory_index-302"><span class="linenos">302</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filter_labels_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">labels_file</span><span class="p">:</span>
</span><span id="build_memory_index-303"><a href="#build_memory_index-303"><span class="linenos">303</span></a>            <span class="k">for</span> <span class="n">labels</span> <span class="ow">in</span> <span class="n">filter_labels</span><span class="p">:</span>
</span><span id="build_memory_index-304"><a href="#build_memory_index-304"><span class="linenos">304</span></a>                <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
</span><span id="build_memory_index-305"><a href="#build_memory_index-305"><span class="linenos">305</span></a>                    <span class="n">label_counts</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">label_counts</span> <span class="k">else</span> <span class="n">label_counts</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="build_memory_index-306"><a href="#build_memory_index-306"><span class="linenos">306</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="build_memory_index-307"><a href="#build_memory_index-307"><span class="linenos">307</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;default&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">labels_file</span><span class="p">)</span>
</span><span id="build_memory_index-308"><a href="#build_memory_index-308"><span class="linenos">308</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="build_memory_index-309"><a href="#build_memory_index-309"><span class="linenos">309</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">labels_file</span><span class="p">)</span>
</span><span id="build_memory_index-310"><a href="#build_memory_index-310"><span class="linenos">310</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index_prefix_path</span><span class="si">}</span><span class="s2">_label_metadata.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">label_metadata_file</span><span class="p">:</span>
</span><span id="build_memory_index-311"><a href="#build_memory_index-311"><span class="linenos">311</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">label_counts</span><span class="p">,</span> <span class="n">label_metadata_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="build_memory_index-312"><a href="#build_memory_index-312"><span class="linenos">312</span></a>
</span><span id="build_memory_index-313"><a href="#build_memory_index-313"><span class="linenos">313</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tags</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tags</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="build_memory_index-314"><a href="#build_memory_index-314"><span class="linenos">314</span></a>        <span class="n">use_tags</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="build_memory_index-315"><a href="#build_memory_index-315"><span class="linenos">315</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tags</span><span class="p">,</span> <span class="n">index_prefix_path</span> <span class="o">+</span> <span class="s2">&quot;.tags&quot;</span><span class="p">)</span>
</span><span id="build_memory_index-316"><a href="#build_memory_index-316"><span class="linenos">316</span></a>    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tags</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="build_memory_index-317"><a href="#build_memory_index-317"><span class="linenos">317</span></a>        <span class="n">use_tags</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="build_memory_index-318"><a href="#build_memory_index-318"><span class="linenos">318</span></a>        <span class="n">tags_as_array</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">tags</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span>
</span><span id="build_memory_index-319"><a href="#build_memory_index-319"><span class="linenos">319</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tags_as_array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Provided tags must be 1 dimensional&quot;</span><span class="p">)</span>
</span><span id="build_memory_index-320"><a href="#build_memory_index-320"><span class="linenos">320</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="build_memory_index-321"><a href="#build_memory_index-321"><span class="linenos">321</span></a>            <span class="n">tags_as_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">num_points</span><span class="p">,</span>
</span><span id="build_memory_index-322"><a href="#build_memory_index-322"><span class="linenos">322</span></a>            <span class="s2">&quot;Provided tags must contain an identical population to the number of points, &quot;</span>
</span><span id="build_memory_index-323"><a href="#build_memory_index-323"><span class="linenos">323</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tags_as_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">num_points</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="build_memory_index-324"><a href="#build_memory_index-324"><span class="linenos">324</span></a>        <span class="p">)</span>
</span><span id="build_memory_index-325"><a href="#build_memory_index-325"><span class="linenos">325</span></a>        <span class="n">tags_to_file</span><span class="p">(</span><span class="n">index_prefix_path</span> <span class="o">+</span> <span class="s2">&quot;.tags&quot;</span><span class="p">,</span> <span class="n">tags_as_array</span><span class="p">)</span>
</span><span id="build_memory_index-326"><a href="#build_memory_index-326"><span class="linenos">326</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="build_memory_index-327"><a href="#build_memory_index-327"><span class="linenos">327</span></a>        <span class="n">use_tags</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="build_memory_index-328"><a href="#build_memory_index-328"><span class="linenos">328</span></a>
</span><span id="build_memory_index-329"><a href="#build_memory_index-329"><span class="linenos">329</span></a>    <span class="n">_builder</span><span class="p">(</span>
</span><span id="build_memory_index-330"><a href="#build_memory_index-330"><span class="linenos">330</span></a>        <span class="n">distance_metric</span><span class="o">=</span><span class="n">dap_metric</span><span class="p">,</span>
</span><span id="build_memory_index-331"><a href="#build_memory_index-331"><span class="linenos">331</span></a>        <span class="n">data_file_path</span><span class="o">=</span><span class="n">vector_bin_path</span><span class="p">,</span>
</span><span id="build_memory_index-332"><a href="#build_memory_index-332"><span class="linenos">332</span></a>        <span class="n">index_output_path</span><span class="o">=</span><span class="n">index_prefix_path</span><span class="p">,</span>
</span><span id="build_memory_index-333"><a href="#build_memory_index-333"><span class="linenos">333</span></a>        <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="build_memory_index-334"><a href="#build_memory_index-334"><span class="linenos">334</span></a>        <span class="n">graph_degree</span><span class="o">=</span><span class="n">graph_degree</span><span class="p">,</span>
</span><span id="build_memory_index-335"><a href="#build_memory_index-335"><span class="linenos">335</span></a>        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="build_memory_index-336"><a href="#build_memory_index-336"><span class="linenos">336</span></a>        <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="build_memory_index-337"><a href="#build_memory_index-337"><span class="linenos">337</span></a>        <span class="n">use_pq_build</span><span class="o">=</span><span class="n">use_pq_build</span><span class="p">,</span>
</span><span id="build_memory_index-338"><a href="#build_memory_index-338"><span class="linenos">338</span></a>        <span class="n">num_pq_bytes</span><span class="o">=</span><span class="n">num_pq_bytes</span><span class="p">,</span>
</span><span id="build_memory_index-339"><a href="#build_memory_index-339"><span class="linenos">339</span></a>        <span class="n">use_opq</span><span class="o">=</span><span class="n">use_opq</span><span class="p">,</span>
</span><span id="build_memory_index-340"><a href="#build_memory_index-340"><span class="linenos">340</span></a>        <span class="n">use_tags</span><span class="o">=</span><span class="n">use_tags</span><span class="p">,</span>
</span><span id="build_memory_index-341"><a href="#build_memory_index-341"><span class="linenos">341</span></a>        <span class="n">filter_labels_file</span><span class="o">=</span><span class="n">filter_labels_file</span><span class="p">,</span>
</span><span id="build_memory_index-342"><a href="#build_memory_index-342"><span class="linenos">342</span></a>        <span class="n">universal_label</span><span class="o">=</span><span class="n">universal_label</span><span class="p">,</span>
</span><span id="build_memory_index-343"><a href="#build_memory_index-343"><span class="linenos">343</span></a>        <span class="n">filter_complexity</span><span class="o">=</span><span class="n">filter_complexity</span><span class="p">,</span>
</span><span id="build_memory_index-344"><a href="#build_memory_index-344"><span class="linenos">344</span></a>    <span class="p">)</span>
</span><span id="build_memory_index-345"><a href="#build_memory_index-345"><span class="linenos">345</span></a>
</span><span id="build_memory_index-346"><a href="#build_memory_index-346"><span class="linenos">346</span></a>    <span class="n">_write_index_metadata</span><span class="p">(</span>
</span><span id="build_memory_index-347"><a href="#build_memory_index-347"><span class="linenos">347</span></a>        <span class="n">index_prefix_path</span><span class="p">,</span> <span class="n">vector_dtype_actual</span><span class="p">,</span> <span class="n">dap_metric</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">dimensions</span>
</span><span id="build_memory_index-348"><a href="#build_memory_index-348"><span class="linenos">348</span></a>    <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function will construct a DiskANN memory index. Memory indices are ideal for smaller datasets whose
indices can fit into memory. Memory indices are faster than disk indices, but usually cannot scale to massive
sizes in an individual index on an individual machine.</p>

<p><code><a href="">diskannpy</a></code>'s memory indices take two forms: a <code><a href="#StaticMemoryIndex">diskannpy.StaticMemoryIndex</a></code>, which will not be mutated, only
searched upon, and a <code><a href="#DynamicMemoryIndex">diskannpy.DynamicMemoryIndex</a></code>, which can be mutated AND searched upon in the same process.</p>

<h2 id="important-note">Important Note:</h2>

<p>You <strong>must</strong> determine the type of index you are building for. If you are building for a
<code><a href="#DynamicMemoryIndex">diskannpy.DynamicMemoryIndex</a></code>, you <strong>must</strong> supply a valid value for the <code>tags</code> parameter. <strong>Do not supply
tags if the index is intended to be <code><a href="#StaticMemoryIndex">diskannpy.StaticMemoryIndex</a></code></strong>!</p>

<h2 id="distance-metric-and-vector-datatype-restrictions">Distance Metric and Vector Datatype Restrictions</h2>

<table>
<thead>
<tr>
  <th>Metric \ Datatype</th>
  <th>np.float32</th>
  <th>np.uint8</th>
  <th>np.int8</th>
</tr>
</thead>
<tbody>
<tr>
  <td>L2</td>
  <td></td>
  <td></td>
  <td></td>
</tr>
<tr>
  <td>MIPS</td>
  <td></td>
  <td></td>
  <td></td>
</tr>
<tr>
  <td>Cosine</td>
  <td></td>
  <td></td>
  <td></td>
</tr>
</tbody>
</table>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>data</strong>: Either a <code>str</code> representing a path to an existing DiskANN vector bin file, or a numpy.ndarray of a
supported dtype in 2 dimensions. Note that <code>vector_dtype</code> must be provided if <code>data</code> is a <code>str</code>.</li>
<li><strong>distance_metric</strong>: A <code>str</code>, strictly one of {"l2", "mips", "cosine"}. <code>l2</code> and <code>cosine</code> are supported for all 3
vector dtypes, but <code>mips</code> is only available for single precision floats.</li>
<li><strong>index_directory</strong>: The index files will be saved to this <strong>existing</strong> directory path</li>
<li><strong>complexity</strong>: The size of the candidate nearest neighbor list to use when building the index. Values between 75
and 200 are typical. Larger values will take more time to build but result in indices that provide higher recall
for the same search complexity. Use a value that is at least as large as <code>graph_degree</code> unless you are prepared
to compromise on quality</li>
<li><strong>graph_degree</strong>: The degree of the graph index, typically between 60 and 150. A larger maximum degree will
result in larger indices and longer indexing times, but better search quality.</li>
<li><strong>num_threads</strong>: Number of threads to use when creating this index. <code>0</code> is used to indicate all available
logical processors should be used.</li>
<li><strong>alpha</strong>: The alpha parameter (&gt;=1) is used to control the nature and number of points that are added to the
graph. A higher alpha value (e.g., 1.4) will result in fewer hops (and IOs) to convergence, but probably more
distance comparisons compared to a lower alpha value.</li>
<li><strong>use_pq_build</strong>: Use product quantization during build. Product quantization is a lossy compression technique
that can reduce the size of the index on disk. This will trade off recall. Default is <code>True</code>.</li>
<li><strong>num_pq_bytes</strong>: The number of bytes used to store the PQ compressed data in memory. This will trade off recall.
Default is <code>0</code>.</li>
<li><strong>use_opq</strong>: Use optimized product quantization during build.</li>
<li><strong>vector_dtype</strong>: Required if the provided <code>data</code> is of type <code>str</code>, else we use the <code>data.dtype</code> if np array.</li>
<li><strong>tags</strong>: Tags can be defined either as a path on disk to an existing .tags file, or provided as a np.array of
the same length as the number of vectors. Tags are used to identify vectors in the index via your <em>own</em>
numbering conventions, and is absolutely required for loading DynamicMemoryIndex indices <code>from_file</code>.</li>
<li><strong>filter_labels</strong>: An optional, but exhaustive list of categories for each vector. This is used to filter
search results by category. If provided, this must be a list of lists, where each inner list is a list of
categories for the corresponding vector. For example, if you have 3 vectors, and the first vector belongs to
categories "a" and "b", the second vector belongs to category "b", and the third vector belongs to no categories,
you would provide <code>filter_labels=[["a", "b"], ["b"], []]</code>. If you do not want to provide categories for a
particular vector, you can provide an empty list. If you do not want to provide categories for any vectors,
you can provide <code>None</code> for this parameter (which is the default)</li>
<li><strong>universal_label</strong>: An optional label that indicates that this vector should be included in <em>every</em> search
in which it also meets the knn search criteria.</li>
<li><strong>filter_complexity</strong>: Complexity to use when using filters. Default is 0. 0 is strictly invalid if you are
using filters.</li>
<li><strong>index_prefix</strong>: The prefix of the index files. Defaults to "ann".</li>
</ul>
</div>


                </section>
                <section id="StaticDiskIndex">
                            <input id="StaticDiskIndex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">StaticDiskIndex</span>:

                <label class="view-source-button" for="StaticDiskIndex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StaticDiskIndex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StaticDiskIndex-34"><a href="#StaticDiskIndex-34"><span class="linenos"> 34</span></a><span class="k">class</span><span class="w"> </span><span class="nc">StaticDiskIndex</span><span class="p">:</span>
</span><span id="StaticDiskIndex-35"><a href="#StaticDiskIndex-35"><span class="linenos"> 35</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex-36"><a href="#StaticDiskIndex-36"><span class="linenos"> 36</span></a><span class="sd">    A StaticDiskIndex is a disk-backed index that is not mutable.</span>
</span><span id="StaticDiskIndex-37"><a href="#StaticDiskIndex-37"><span class="linenos"> 37</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex-38"><a href="#StaticDiskIndex-38"><span class="linenos"> 38</span></a>
</span><span id="StaticDiskIndex-39"><a href="#StaticDiskIndex-39"><span class="linenos"> 39</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="StaticDiskIndex-40"><a href="#StaticDiskIndex-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="StaticDiskIndex-41"><a href="#StaticDiskIndex-41"><span class="linenos"> 41</span></a>        <span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="StaticDiskIndex-42"><a href="#StaticDiskIndex-42"><span class="linenos"> 42</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticDiskIndex-43"><a href="#StaticDiskIndex-43"><span class="linenos"> 43</span></a>        <span class="n">num_nodes_to_cache</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticDiskIndex-44"><a href="#StaticDiskIndex-44"><span class="linenos"> 44</span></a>        <span class="n">cache_mechanism</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="StaticDiskIndex-45"><a href="#StaticDiskIndex-45"><span class="linenos"> 45</span></a>        <span class="n">distance_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DistanceMetric</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticDiskIndex-46"><a href="#StaticDiskIndex-46"><span class="linenos"> 46</span></a>        <span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticDiskIndex-47"><a href="#StaticDiskIndex-47"><span class="linenos"> 47</span></a>        <span class="n">dimensions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticDiskIndex-48"><a href="#StaticDiskIndex-48"><span class="linenos"> 48</span></a>        <span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ann&quot;</span><span class="p">,</span>
</span><span id="StaticDiskIndex-49"><a href="#StaticDiskIndex-49"><span class="linenos"> 49</span></a>    <span class="p">):</span>
</span><span id="StaticDiskIndex-50"><a href="#StaticDiskIndex-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex-51"><a href="#StaticDiskIndex-51"><span class="linenos"> 51</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticDiskIndex-52"><a href="#StaticDiskIndex-52"><span class="linenos"> 52</span></a><span class="sd">        - **index_directory**: The directory containing the index files. This directory must contain the following</span>
</span><span id="StaticDiskIndex-53"><a href="#StaticDiskIndex-53"><span class="linenos"> 53</span></a><span class="sd">            files:</span>
</span><span id="StaticDiskIndex-54"><a href="#StaticDiskIndex-54"><span class="linenos"> 54</span></a><span class="sd">            - `{index_prefix}_sample_data.bin`</span>
</span><span id="StaticDiskIndex-55"><a href="#StaticDiskIndex-55"><span class="linenos"> 55</span></a><span class="sd">            - `{index_prefix}_mem.index.data`</span>
</span><span id="StaticDiskIndex-56"><a href="#StaticDiskIndex-56"><span class="linenos"> 56</span></a><span class="sd">            - `{index_prefix}_pq_compressed.bin`</span>
</span><span id="StaticDiskIndex-57"><a href="#StaticDiskIndex-57"><span class="linenos"> 57</span></a><span class="sd">            - `{index_prefix}_pq_pivots.bin`</span>
</span><span id="StaticDiskIndex-58"><a href="#StaticDiskIndex-58"><span class="linenos"> 58</span></a><span class="sd">            - `{index_prefix}_sample_ids.bin`</span>
</span><span id="StaticDiskIndex-59"><a href="#StaticDiskIndex-59"><span class="linenos"> 59</span></a><span class="sd">            - `{index_prefix}_disk.index`</span>
</span><span id="StaticDiskIndex-60"><a href="#StaticDiskIndex-60"><span class="linenos"> 60</span></a>
</span><span id="StaticDiskIndex-61"><a href="#StaticDiskIndex-61"><span class="linenos"> 61</span></a><span class="sd">          It may also include the following optional files:</span>
</span><span id="StaticDiskIndex-62"><a href="#StaticDiskIndex-62"><span class="linenos"> 62</span></a><span class="sd">            - `{index_prefix}_vectors.bin`: Optional. `diskannpy` builder functions may create this file in the</span>
</span><span id="StaticDiskIndex-63"><a href="#StaticDiskIndex-63"><span class="linenos"> 63</span></a><span class="sd">              `index_directory` if the index was created from a numpy array</span>
</span><span id="StaticDiskIndex-64"><a href="#StaticDiskIndex-64"><span class="linenos"> 64</span></a><span class="sd">            - `{index_prefix}_metadata.bin`: Optional. `diskannpy` builder functions create this file to store metadata</span>
</span><span id="StaticDiskIndex-65"><a href="#StaticDiskIndex-65"><span class="linenos"> 65</span></a><span class="sd">            about the index, such as vector dtype, distance metric, number of vectors and vector dimensionality.</span>
</span><span id="StaticDiskIndex-66"><a href="#StaticDiskIndex-66"><span class="linenos"> 66</span></a><span class="sd">            If an index is built from the `diskann` cli tools, this file will not exist.</span>
</span><span id="StaticDiskIndex-67"><a href="#StaticDiskIndex-67"><span class="linenos"> 67</span></a><span class="sd">        - **num_threads**: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="StaticDiskIndex-68"><a href="#StaticDiskIndex-68"><span class="linenos"> 68</span></a><span class="sd">        - **num_nodes_to_cache**: Number of nodes to cache in memory (&gt; -1)</span>
</span><span id="StaticDiskIndex-69"><a href="#StaticDiskIndex-69"><span class="linenos"> 69</span></a><span class="sd">        - **cache_mechanism**: 1 -&gt; use the generated sample_data.bin file for</span>
</span><span id="StaticDiskIndex-70"><a href="#StaticDiskIndex-70"><span class="linenos"> 70</span></a><span class="sd">            the index to initialize a set of cached nodes, up to `num_nodes_to_cache`, 2 -&gt; ready the cache for up to</span>
</span><span id="StaticDiskIndex-71"><a href="#StaticDiskIndex-71"><span class="linenos"> 71</span></a><span class="sd">            `num_nodes_to_cache`, but do not initialize it with any nodes. Any other value disables node caching.</span>
</span><span id="StaticDiskIndex-72"><a href="#StaticDiskIndex-72"><span class="linenos"> 72</span></a><span class="sd">        - **distance_metric**: A `str`, strictly one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;}. `l2` and `cosine` are supported for all 3</span>
</span><span id="StaticDiskIndex-73"><a href="#StaticDiskIndex-73"><span class="linenos"> 73</span></a><span class="sd">          vector dtypes, but `mips` is only available for single precision floats. Default is `None`. **This</span>
</span><span id="StaticDiskIndex-74"><a href="#StaticDiskIndex-74"><span class="linenos"> 74</span></a><span class="sd">          value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it does not exist,</span>
</span><span id="StaticDiskIndex-75"><a href="#StaticDiskIndex-75"><span class="linenos"> 75</span></a><span class="sd">          you are required to provide it.</span>
</span><span id="StaticDiskIndex-76"><a href="#StaticDiskIndex-76"><span class="linenos"> 76</span></a><span class="sd">        - **vector_dtype**: The vector dtype this index has been built with. **This value is only used if a</span>
</span><span id="StaticDiskIndex-77"><a href="#StaticDiskIndex-77"><span class="linenos"> 77</span></a><span class="sd">          `{index_prefix}_metadata.bin` file does not exist.** If it does not exist, you are required to provide it.</span>
</span><span id="StaticDiskIndex-78"><a href="#StaticDiskIndex-78"><span class="linenos"> 78</span></a><span class="sd">        - **dimensions**: The vector dimensionality of this index. All new vectors inserted must be the same</span>
</span><span id="StaticDiskIndex-79"><a href="#StaticDiskIndex-79"><span class="linenos"> 79</span></a><span class="sd">          dimensionality. **This value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it</span>
</span><span id="StaticDiskIndex-80"><a href="#StaticDiskIndex-80"><span class="linenos"> 80</span></a><span class="sd">          does not exist, you are required to provide it.</span>
</span><span id="StaticDiskIndex-81"><a href="#StaticDiskIndex-81"><span class="linenos"> 81</span></a><span class="sd">        - **index_prefix**: The prefix of the index files. Defaults to &quot;ann&quot;.</span>
</span><span id="StaticDiskIndex-82"><a href="#StaticDiskIndex-82"><span class="linenos"> 82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex-83"><a href="#StaticDiskIndex-83"><span class="linenos"> 83</span></a>        <span class="n">index_prefix_path</span> <span class="o">=</span> <span class="n">_valid_index_prefix</span><span class="p">(</span><span class="n">index_directory</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">)</span>
</span><span id="StaticDiskIndex-84"><a href="#StaticDiskIndex-84"><span class="linenos"> 84</span></a>        <span class="n">vector_dtype</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_ensure_index_metadata</span><span class="p">(</span>
</span><span id="StaticDiskIndex-85"><a href="#StaticDiskIndex-85"><span class="linenos"> 85</span></a>            <span class="n">index_prefix_path</span><span class="p">,</span>
</span><span id="StaticDiskIndex-86"><a href="#StaticDiskIndex-86"><span class="linenos"> 86</span></a>            <span class="n">vector_dtype</span><span class="p">,</span>
</span><span id="StaticDiskIndex-87"><a href="#StaticDiskIndex-87"><span class="linenos"> 87</span></a>            <span class="n">distance_metric</span><span class="p">,</span>
</span><span id="StaticDiskIndex-88"><a href="#StaticDiskIndex-88"><span class="linenos"> 88</span></a>            <span class="mi">1</span><span class="p">,</span>  <span class="c1"># it doesn&#39;t matter because we don&#39;t need it in this context anyway</span>
</span><span id="StaticDiskIndex-89"><a href="#StaticDiskIndex-89"><span class="linenos"> 89</span></a>            <span class="n">dimensions</span><span class="p">,</span>
</span><span id="StaticDiskIndex-90"><a href="#StaticDiskIndex-90"><span class="linenos"> 90</span></a>        <span class="p">)</span>
</span><span id="StaticDiskIndex-91"><a href="#StaticDiskIndex-91"><span class="linenos"> 91</span></a>        <span class="n">dap_metric</span> <span class="o">=</span> <span class="n">_valid_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
</span><span id="StaticDiskIndex-92"><a href="#StaticDiskIndex-92"><span class="linenos"> 92</span></a>
</span><span id="StaticDiskIndex-93"><a href="#StaticDiskIndex-93"><span class="linenos"> 93</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-94"><a href="#StaticDiskIndex-94"><span class="linenos"> 94</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_nodes_to_cache</span><span class="p">,</span> <span class="s2">&quot;num_nodes_to_cache&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-95"><a href="#StaticDiskIndex-95"><span class="linenos"> 95</span></a>
</span><span id="StaticDiskIndex-96"><a href="#StaticDiskIndex-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span> <span class="o">=</span> <span class="n">vector_dtype</span>
</span><span id="StaticDiskIndex-97"><a href="#StaticDiskIndex-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="StaticDiskIndex-98"><a href="#StaticDiskIndex-98"><span class="linenos"> 98</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticDiskUInt8Index</span>
</span><span id="StaticDiskIndex-99"><a href="#StaticDiskIndex-99"><span class="linenos"> 99</span></a>        <span class="k">elif</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
</span><span id="StaticDiskIndex-100"><a href="#StaticDiskIndex-100"><span class="linenos">100</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticDiskInt8Index</span>
</span><span id="StaticDiskIndex-101"><a href="#StaticDiskIndex-101"><span class="linenos">101</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StaticDiskIndex-102"><a href="#StaticDiskIndex-102"><span class="linenos">102</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticDiskFloatIndex</span>
</span><span id="StaticDiskIndex-103"><a href="#StaticDiskIndex-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">_index</span><span class="p">(</span>
</span><span id="StaticDiskIndex-104"><a href="#StaticDiskIndex-104"><span class="linenos">104</span></a>            <span class="n">distance_metric</span><span class="o">=</span><span class="n">dap_metric</span><span class="p">,</span>
</span><span id="StaticDiskIndex-105"><a href="#StaticDiskIndex-105"><span class="linenos">105</span></a>            <span class="n">index_path_prefix</span><span class="o">=</span><span class="n">index_prefix_path</span><span class="p">,</span>
</span><span id="StaticDiskIndex-106"><a href="#StaticDiskIndex-106"><span class="linenos">106</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="StaticDiskIndex-107"><a href="#StaticDiskIndex-107"><span class="linenos">107</span></a>            <span class="n">num_nodes_to_cache</span><span class="o">=</span><span class="n">num_nodes_to_cache</span><span class="p">,</span>
</span><span id="StaticDiskIndex-108"><a href="#StaticDiskIndex-108"><span class="linenos">108</span></a>            <span class="n">cache_mechanism</span><span class="o">=</span><span class="n">cache_mechanism</span><span class="p">,</span>
</span><span id="StaticDiskIndex-109"><a href="#StaticDiskIndex-109"><span class="linenos">109</span></a>        <span class="p">)</span>
</span><span id="StaticDiskIndex-110"><a href="#StaticDiskIndex-110"><span class="linenos">110</span></a>
</span><span id="StaticDiskIndex-111"><a href="#StaticDiskIndex-111"><span class="linenos">111</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
</span><span id="StaticDiskIndex-112"><a href="#StaticDiskIndex-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">VectorLike</span><span class="p">,</span> <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">beam_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="StaticDiskIndex-113"><a href="#StaticDiskIndex-113"><span class="linenos">113</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponse</span><span class="p">:</span>
</span><span id="StaticDiskIndex-114"><a href="#StaticDiskIndex-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex-115"><a href="#StaticDiskIndex-115"><span class="linenos">115</span></a><span class="sd">        Searches the index by a single query vector.</span>
</span><span id="StaticDiskIndex-116"><a href="#StaticDiskIndex-116"><span class="linenos">116</span></a>
</span><span id="StaticDiskIndex-117"><a href="#StaticDiskIndex-117"><span class="linenos">117</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticDiskIndex-118"><a href="#StaticDiskIndex-118"><span class="linenos">118</span></a><span class="sd">        - **query**: 1d numpy array of the same dimensionality and dtype of the index.</span>
</span><span id="StaticDiskIndex-119"><a href="#StaticDiskIndex-119"><span class="linenos">119</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="StaticDiskIndex-120"><a href="#StaticDiskIndex-120"><span class="linenos">120</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="StaticDiskIndex-121"><a href="#StaticDiskIndex-121"><span class="linenos">121</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="StaticDiskIndex-122"><a href="#StaticDiskIndex-122"><span class="linenos">122</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="StaticDiskIndex-123"><a href="#StaticDiskIndex-123"><span class="linenos">123</span></a><span class="sd">        - **beam_width**: The beamwidth to be used for search. This is the maximum number of IO requests each query</span>
</span><span id="StaticDiskIndex-124"><a href="#StaticDiskIndex-124"><span class="linenos">124</span></a><span class="sd">          will issue per iteration of search code. Larger beamwidth will result in fewer IO round-trips per query,</span>
</span><span id="StaticDiskIndex-125"><a href="#StaticDiskIndex-125"><span class="linenos">125</span></a><span class="sd">          but might result in slightly higher total number of IO requests to SSD per query. For the highest query</span>
</span><span id="StaticDiskIndex-126"><a href="#StaticDiskIndex-126"><span class="linenos">126</span></a><span class="sd">          throughput with a fixed SSD IOps rating, use W=1. For best latency, use W=4,8 or higher complexity search.</span>
</span><span id="StaticDiskIndex-127"><a href="#StaticDiskIndex-127"><span class="linenos">127</span></a><span class="sd">          Specifying 0 will optimize the beamwidth depending on the number of threads performing search, but will</span>
</span><span id="StaticDiskIndex-128"><a href="#StaticDiskIndex-128"><span class="linenos">128</span></a><span class="sd">          involve some tuning overhead.</span>
</span><span id="StaticDiskIndex-129"><a href="#StaticDiskIndex-129"><span class="linenos">129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex-130"><a href="#StaticDiskIndex-130"><span class="linenos">130</span></a>        <span class="n">_query</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="StaticDiskIndex-131"><a href="#StaticDiskIndex-131"><span class="linenos">131</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;query vector must be 1-d&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-132"><a href="#StaticDiskIndex-132"><span class="linenos">132</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-133"><a href="#StaticDiskIndex-133"><span class="linenos">133</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-134"><a href="#StaticDiskIndex-134"><span class="linenos">134</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">beam_width</span><span class="p">,</span> <span class="s2">&quot;beam_width&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-135"><a href="#StaticDiskIndex-135"><span class="linenos">135</span></a>
</span><span id="StaticDiskIndex-136"><a href="#StaticDiskIndex-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="StaticDiskIndex-137"><a href="#StaticDiskIndex-137"><span class="linenos">137</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="StaticDiskIndex-138"><a href="#StaticDiskIndex-138"><span class="linenos">138</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">=}</span><span class="s2"> asked for, but </span><span class="si">{</span><span class="n">complexity</span><span class="si">=}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="StaticDiskIndex-139"><a href="#StaticDiskIndex-139"><span class="linenos">139</span></a>            <span class="p">)</span>
</span><span id="StaticDiskIndex-140"><a href="#StaticDiskIndex-140"><span class="linenos">140</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="StaticDiskIndex-141"><a href="#StaticDiskIndex-141"><span class="linenos">141</span></a>
</span><span id="StaticDiskIndex-142"><a href="#StaticDiskIndex-142"><span class="linenos">142</span></a>        <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
</span><span id="StaticDiskIndex-143"><a href="#StaticDiskIndex-143"><span class="linenos">143</span></a>            <span class="n">query</span><span class="o">=</span><span class="n">_query</span><span class="p">,</span>
</span><span id="StaticDiskIndex-144"><a href="#StaticDiskIndex-144"><span class="linenos">144</span></a>            <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span>
</span><span id="StaticDiskIndex-145"><a href="#StaticDiskIndex-145"><span class="linenos">145</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="StaticDiskIndex-146"><a href="#StaticDiskIndex-146"><span class="linenos">146</span></a>            <span class="n">beam_width</span><span class="o">=</span><span class="n">beam_width</span><span class="p">,</span>
</span><span id="StaticDiskIndex-147"><a href="#StaticDiskIndex-147"><span class="linenos">147</span></a>        <span class="p">)</span>
</span><span id="StaticDiskIndex-148"><a href="#StaticDiskIndex-148"><span class="linenos">148</span></a>        <span class="k">return</span> <span class="n">QueryResponse</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span><span id="StaticDiskIndex-149"><a href="#StaticDiskIndex-149"><span class="linenos">149</span></a>
</span><span id="StaticDiskIndex-150"><a href="#StaticDiskIndex-150"><span class="linenos">150</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_search</span><span class="p">(</span>
</span><span id="StaticDiskIndex-151"><a href="#StaticDiskIndex-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="StaticDiskIndex-152"><a href="#StaticDiskIndex-152"><span class="linenos">152</span></a>        <span class="n">queries</span><span class="p">:</span> <span class="n">VectorLikeBatch</span><span class="p">,</span>
</span><span id="StaticDiskIndex-153"><a href="#StaticDiskIndex-153"><span class="linenos">153</span></a>        <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticDiskIndex-154"><a href="#StaticDiskIndex-154"><span class="linenos">154</span></a>        <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticDiskIndex-155"><a href="#StaticDiskIndex-155"><span class="linenos">155</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticDiskIndex-156"><a href="#StaticDiskIndex-156"><span class="linenos">156</span></a>        <span class="n">beam_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="StaticDiskIndex-157"><a href="#StaticDiskIndex-157"><span class="linenos">157</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponseBatch</span><span class="p">:</span>
</span><span id="StaticDiskIndex-158"><a href="#StaticDiskIndex-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex-159"><a href="#StaticDiskIndex-159"><span class="linenos">159</span></a><span class="sd">        Searches the index by a batch of query vectors.</span>
</span><span id="StaticDiskIndex-160"><a href="#StaticDiskIndex-160"><span class="linenos">160</span></a>
</span><span id="StaticDiskIndex-161"><a href="#StaticDiskIndex-161"><span class="linenos">161</span></a><span class="sd">        This search is parallelized and far more efficient than searching for each vector individually.</span>
</span><span id="StaticDiskIndex-162"><a href="#StaticDiskIndex-162"><span class="linenos">162</span></a>
</span><span id="StaticDiskIndex-163"><a href="#StaticDiskIndex-163"><span class="linenos">163</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticDiskIndex-164"><a href="#StaticDiskIndex-164"><span class="linenos">164</span></a><span class="sd">        - **queries**: 2d numpy array, with column dimensionality matching the index and row dimensionality being the</span>
</span><span id="StaticDiskIndex-165"><a href="#StaticDiskIndex-165"><span class="linenos">165</span></a><span class="sd">          number of queries intended to search for in parallel. Dtype must match dtype of the index.</span>
</span><span id="StaticDiskIndex-166"><a href="#StaticDiskIndex-166"><span class="linenos">166</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="StaticDiskIndex-167"><a href="#StaticDiskIndex-167"><span class="linenos">167</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="StaticDiskIndex-168"><a href="#StaticDiskIndex-168"><span class="linenos">168</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="StaticDiskIndex-169"><a href="#StaticDiskIndex-169"><span class="linenos">169</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="StaticDiskIndex-170"><a href="#StaticDiskIndex-170"><span class="linenos">170</span></a><span class="sd">        - **num_threads**: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="StaticDiskIndex-171"><a href="#StaticDiskIndex-171"><span class="linenos">171</span></a><span class="sd">        - **beam_width**: The beamwidth to be used for search. This is the maximum number of IO requests each query</span>
</span><span id="StaticDiskIndex-172"><a href="#StaticDiskIndex-172"><span class="linenos">172</span></a><span class="sd">          will issue per iteration of search code. Larger beamwidth will result in fewer IO round-trips per query,</span>
</span><span id="StaticDiskIndex-173"><a href="#StaticDiskIndex-173"><span class="linenos">173</span></a><span class="sd">          but might result in slightly higher total number of IO requests to SSD per query. For the highest query</span>
</span><span id="StaticDiskIndex-174"><a href="#StaticDiskIndex-174"><span class="linenos">174</span></a><span class="sd">          throughput with a fixed SSD IOps rating, use W=1. For best latency, use W=4,8 or higher complexity search.</span>
</span><span id="StaticDiskIndex-175"><a href="#StaticDiskIndex-175"><span class="linenos">175</span></a><span class="sd">          Specifying 0 will optimize the beamwidth depending on the number of threads performing search, but will</span>
</span><span id="StaticDiskIndex-176"><a href="#StaticDiskIndex-176"><span class="linenos">176</span></a><span class="sd">          involve some tuning overhead.</span>
</span><span id="StaticDiskIndex-177"><a href="#StaticDiskIndex-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex-178"><a href="#StaticDiskIndex-178"><span class="linenos">178</span></a>        <span class="n">_queries</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="StaticDiskIndex-179"><a href="#StaticDiskIndex-179"><span class="linenos">179</span></a>        <span class="n">_assert_2d</span><span class="p">(</span><span class="n">_queries</span><span class="p">,</span> <span class="s2">&quot;queries&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-180"><a href="#StaticDiskIndex-180"><span class="linenos">180</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-181"><a href="#StaticDiskIndex-181"><span class="linenos">181</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-182"><a href="#StaticDiskIndex-182"><span class="linenos">182</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-183"><a href="#StaticDiskIndex-183"><span class="linenos">183</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">beam_width</span><span class="p">,</span> <span class="s2">&quot;beam_width&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex-184"><a href="#StaticDiskIndex-184"><span class="linenos">184</span></a>
</span><span id="StaticDiskIndex-185"><a href="#StaticDiskIndex-185"><span class="linenos">185</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="StaticDiskIndex-186"><a href="#StaticDiskIndex-186"><span class="linenos">186</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="StaticDiskIndex-187"><a href="#StaticDiskIndex-187"><span class="linenos">187</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">=}</span><span class="s2"> asked for, but </span><span class="si">{</span><span class="n">complexity</span><span class="si">=}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="StaticDiskIndex-188"><a href="#StaticDiskIndex-188"><span class="linenos">188</span></a>            <span class="p">)</span>
</span><span id="StaticDiskIndex-189"><a href="#StaticDiskIndex-189"><span class="linenos">189</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="StaticDiskIndex-190"><a href="#StaticDiskIndex-190"><span class="linenos">190</span></a>
</span><span id="StaticDiskIndex-191"><a href="#StaticDiskIndex-191"><span class="linenos">191</span></a>        <span class="n">num_queries</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">_queries</span><span class="o">.</span><span class="n">shape</span>
</span><span id="StaticDiskIndex-192"><a href="#StaticDiskIndex-192"><span class="linenos">192</span></a>        <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">batch_search</span><span class="p">(</span>
</span><span id="StaticDiskIndex-193"><a href="#StaticDiskIndex-193"><span class="linenos">193</span></a>            <span class="n">queries</span><span class="o">=</span><span class="n">_queries</span><span class="p">,</span>
</span><span id="StaticDiskIndex-194"><a href="#StaticDiskIndex-194"><span class="linenos">194</span></a>            <span class="n">num_queries</span><span class="o">=</span><span class="n">num_queries</span><span class="p">,</span>
</span><span id="StaticDiskIndex-195"><a href="#StaticDiskIndex-195"><span class="linenos">195</span></a>            <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span>
</span><span id="StaticDiskIndex-196"><a href="#StaticDiskIndex-196"><span class="linenos">196</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="StaticDiskIndex-197"><a href="#StaticDiskIndex-197"><span class="linenos">197</span></a>            <span class="n">beam_width</span><span class="o">=</span><span class="n">beam_width</span><span class="p">,</span>
</span><span id="StaticDiskIndex-198"><a href="#StaticDiskIndex-198"><span class="linenos">198</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="StaticDiskIndex-199"><a href="#StaticDiskIndex-199"><span class="linenos">199</span></a>        <span class="p">)</span>
</span><span id="StaticDiskIndex-200"><a href="#StaticDiskIndex-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="n">QueryResponseBatch</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A StaticDiskIndex is a disk-backed index that is not mutable.</p>
</div>


                            <div id="StaticDiskIndex.__init__" class="classattr">
                                        <input id="StaticDiskIndex.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">StaticDiskIndex</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">num_nodes_to_cache</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">cache_mechanism</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">distance_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;mips&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dimensions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ann&#39;</span></span>)</span>

                <label class="view-source-button" for="StaticDiskIndex.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StaticDiskIndex.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StaticDiskIndex.__init__-39"><a href="#StaticDiskIndex.__init__-39"><span class="linenos"> 39</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="StaticDiskIndex.__init__-40"><a href="#StaticDiskIndex.__init__-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-41"><a href="#StaticDiskIndex.__init__-41"><span class="linenos"> 41</span></a>        <span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-42"><a href="#StaticDiskIndex.__init__-42"><span class="linenos"> 42</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-43"><a href="#StaticDiskIndex.__init__-43"><span class="linenos"> 43</span></a>        <span class="n">num_nodes_to_cache</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-44"><a href="#StaticDiskIndex.__init__-44"><span class="linenos"> 44</span></a>        <span class="n">cache_mechanism</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-45"><a href="#StaticDiskIndex.__init__-45"><span class="linenos"> 45</span></a>        <span class="n">distance_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DistanceMetric</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-46"><a href="#StaticDiskIndex.__init__-46"><span class="linenos"> 46</span></a>        <span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-47"><a href="#StaticDiskIndex.__init__-47"><span class="linenos"> 47</span></a>        <span class="n">dimensions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-48"><a href="#StaticDiskIndex.__init__-48"><span class="linenos"> 48</span></a>        <span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ann&quot;</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-49"><a href="#StaticDiskIndex.__init__-49"><span class="linenos"> 49</span></a>    <span class="p">):</span>
</span><span id="StaticDiskIndex.__init__-50"><a href="#StaticDiskIndex.__init__-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex.__init__-51"><a href="#StaticDiskIndex.__init__-51"><span class="linenos"> 51</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticDiskIndex.__init__-52"><a href="#StaticDiskIndex.__init__-52"><span class="linenos"> 52</span></a><span class="sd">        - **index_directory**: The directory containing the index files. This directory must contain the following</span>
</span><span id="StaticDiskIndex.__init__-53"><a href="#StaticDiskIndex.__init__-53"><span class="linenos"> 53</span></a><span class="sd">            files:</span>
</span><span id="StaticDiskIndex.__init__-54"><a href="#StaticDiskIndex.__init__-54"><span class="linenos"> 54</span></a><span class="sd">            - `{index_prefix}_sample_data.bin`</span>
</span><span id="StaticDiskIndex.__init__-55"><a href="#StaticDiskIndex.__init__-55"><span class="linenos"> 55</span></a><span class="sd">            - `{index_prefix}_mem.index.data`</span>
</span><span id="StaticDiskIndex.__init__-56"><a href="#StaticDiskIndex.__init__-56"><span class="linenos"> 56</span></a><span class="sd">            - `{index_prefix}_pq_compressed.bin`</span>
</span><span id="StaticDiskIndex.__init__-57"><a href="#StaticDiskIndex.__init__-57"><span class="linenos"> 57</span></a><span class="sd">            - `{index_prefix}_pq_pivots.bin`</span>
</span><span id="StaticDiskIndex.__init__-58"><a href="#StaticDiskIndex.__init__-58"><span class="linenos"> 58</span></a><span class="sd">            - `{index_prefix}_sample_ids.bin`</span>
</span><span id="StaticDiskIndex.__init__-59"><a href="#StaticDiskIndex.__init__-59"><span class="linenos"> 59</span></a><span class="sd">            - `{index_prefix}_disk.index`</span>
</span><span id="StaticDiskIndex.__init__-60"><a href="#StaticDiskIndex.__init__-60"><span class="linenos"> 60</span></a>
</span><span id="StaticDiskIndex.__init__-61"><a href="#StaticDiskIndex.__init__-61"><span class="linenos"> 61</span></a><span class="sd">          It may also include the following optional files:</span>
</span><span id="StaticDiskIndex.__init__-62"><a href="#StaticDiskIndex.__init__-62"><span class="linenos"> 62</span></a><span class="sd">            - `{index_prefix}_vectors.bin`: Optional. `diskannpy` builder functions may create this file in the</span>
</span><span id="StaticDiskIndex.__init__-63"><a href="#StaticDiskIndex.__init__-63"><span class="linenos"> 63</span></a><span class="sd">              `index_directory` if the index was created from a numpy array</span>
</span><span id="StaticDiskIndex.__init__-64"><a href="#StaticDiskIndex.__init__-64"><span class="linenos"> 64</span></a><span class="sd">            - `{index_prefix}_metadata.bin`: Optional. `diskannpy` builder functions create this file to store metadata</span>
</span><span id="StaticDiskIndex.__init__-65"><a href="#StaticDiskIndex.__init__-65"><span class="linenos"> 65</span></a><span class="sd">            about the index, such as vector dtype, distance metric, number of vectors and vector dimensionality.</span>
</span><span id="StaticDiskIndex.__init__-66"><a href="#StaticDiskIndex.__init__-66"><span class="linenos"> 66</span></a><span class="sd">            If an index is built from the `diskann` cli tools, this file will not exist.</span>
</span><span id="StaticDiskIndex.__init__-67"><a href="#StaticDiskIndex.__init__-67"><span class="linenos"> 67</span></a><span class="sd">        - **num_threads**: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="StaticDiskIndex.__init__-68"><a href="#StaticDiskIndex.__init__-68"><span class="linenos"> 68</span></a><span class="sd">        - **num_nodes_to_cache**: Number of nodes to cache in memory (&gt; -1)</span>
</span><span id="StaticDiskIndex.__init__-69"><a href="#StaticDiskIndex.__init__-69"><span class="linenos"> 69</span></a><span class="sd">        - **cache_mechanism**: 1 -&gt; use the generated sample_data.bin file for</span>
</span><span id="StaticDiskIndex.__init__-70"><a href="#StaticDiskIndex.__init__-70"><span class="linenos"> 70</span></a><span class="sd">            the index to initialize a set of cached nodes, up to `num_nodes_to_cache`, 2 -&gt; ready the cache for up to</span>
</span><span id="StaticDiskIndex.__init__-71"><a href="#StaticDiskIndex.__init__-71"><span class="linenos"> 71</span></a><span class="sd">            `num_nodes_to_cache`, but do not initialize it with any nodes. Any other value disables node caching.</span>
</span><span id="StaticDiskIndex.__init__-72"><a href="#StaticDiskIndex.__init__-72"><span class="linenos"> 72</span></a><span class="sd">        - **distance_metric**: A `str`, strictly one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;}. `l2` and `cosine` are supported for all 3</span>
</span><span id="StaticDiskIndex.__init__-73"><a href="#StaticDiskIndex.__init__-73"><span class="linenos"> 73</span></a><span class="sd">          vector dtypes, but `mips` is only available for single precision floats. Default is `None`. **This</span>
</span><span id="StaticDiskIndex.__init__-74"><a href="#StaticDiskIndex.__init__-74"><span class="linenos"> 74</span></a><span class="sd">          value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it does not exist,</span>
</span><span id="StaticDiskIndex.__init__-75"><a href="#StaticDiskIndex.__init__-75"><span class="linenos"> 75</span></a><span class="sd">          you are required to provide it.</span>
</span><span id="StaticDiskIndex.__init__-76"><a href="#StaticDiskIndex.__init__-76"><span class="linenos"> 76</span></a><span class="sd">        - **vector_dtype**: The vector dtype this index has been built with. **This value is only used if a</span>
</span><span id="StaticDiskIndex.__init__-77"><a href="#StaticDiskIndex.__init__-77"><span class="linenos"> 77</span></a><span class="sd">          `{index_prefix}_metadata.bin` file does not exist.** If it does not exist, you are required to provide it.</span>
</span><span id="StaticDiskIndex.__init__-78"><a href="#StaticDiskIndex.__init__-78"><span class="linenos"> 78</span></a><span class="sd">        - **dimensions**: The vector dimensionality of this index. All new vectors inserted must be the same</span>
</span><span id="StaticDiskIndex.__init__-79"><a href="#StaticDiskIndex.__init__-79"><span class="linenos"> 79</span></a><span class="sd">          dimensionality. **This value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it</span>
</span><span id="StaticDiskIndex.__init__-80"><a href="#StaticDiskIndex.__init__-80"><span class="linenos"> 80</span></a><span class="sd">          does not exist, you are required to provide it.</span>
</span><span id="StaticDiskIndex.__init__-81"><a href="#StaticDiskIndex.__init__-81"><span class="linenos"> 81</span></a><span class="sd">        - **index_prefix**: The prefix of the index files. Defaults to &quot;ann&quot;.</span>
</span><span id="StaticDiskIndex.__init__-82"><a href="#StaticDiskIndex.__init__-82"><span class="linenos"> 82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex.__init__-83"><a href="#StaticDiskIndex.__init__-83"><span class="linenos"> 83</span></a>        <span class="n">index_prefix_path</span> <span class="o">=</span> <span class="n">_valid_index_prefix</span><span class="p">(</span><span class="n">index_directory</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">)</span>
</span><span id="StaticDiskIndex.__init__-84"><a href="#StaticDiskIndex.__init__-84"><span class="linenos"> 84</span></a>        <span class="n">vector_dtype</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_ensure_index_metadata</span><span class="p">(</span>
</span><span id="StaticDiskIndex.__init__-85"><a href="#StaticDiskIndex.__init__-85"><span class="linenos"> 85</span></a>            <span class="n">index_prefix_path</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-86"><a href="#StaticDiskIndex.__init__-86"><span class="linenos"> 86</span></a>            <span class="n">vector_dtype</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-87"><a href="#StaticDiskIndex.__init__-87"><span class="linenos"> 87</span></a>            <span class="n">distance_metric</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-88"><a href="#StaticDiskIndex.__init__-88"><span class="linenos"> 88</span></a>            <span class="mi">1</span><span class="p">,</span>  <span class="c1"># it doesn&#39;t matter because we don&#39;t need it in this context anyway</span>
</span><span id="StaticDiskIndex.__init__-89"><a href="#StaticDiskIndex.__init__-89"><span class="linenos"> 89</span></a>            <span class="n">dimensions</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-90"><a href="#StaticDiskIndex.__init__-90"><span class="linenos"> 90</span></a>        <span class="p">)</span>
</span><span id="StaticDiskIndex.__init__-91"><a href="#StaticDiskIndex.__init__-91"><span class="linenos"> 91</span></a>        <span class="n">dap_metric</span> <span class="o">=</span> <span class="n">_valid_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
</span><span id="StaticDiskIndex.__init__-92"><a href="#StaticDiskIndex.__init__-92"><span class="linenos"> 92</span></a>
</span><span id="StaticDiskIndex.__init__-93"><a href="#StaticDiskIndex.__init__-93"><span class="linenos"> 93</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.__init__-94"><a href="#StaticDiskIndex.__init__-94"><span class="linenos"> 94</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_nodes_to_cache</span><span class="p">,</span> <span class="s2">&quot;num_nodes_to_cache&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.__init__-95"><a href="#StaticDiskIndex.__init__-95"><span class="linenos"> 95</span></a>
</span><span id="StaticDiskIndex.__init__-96"><a href="#StaticDiskIndex.__init__-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span> <span class="o">=</span> <span class="n">vector_dtype</span>
</span><span id="StaticDiskIndex.__init__-97"><a href="#StaticDiskIndex.__init__-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="StaticDiskIndex.__init__-98"><a href="#StaticDiskIndex.__init__-98"><span class="linenos"> 98</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticDiskUInt8Index</span>
</span><span id="StaticDiskIndex.__init__-99"><a href="#StaticDiskIndex.__init__-99"><span class="linenos"> 99</span></a>        <span class="k">elif</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
</span><span id="StaticDiskIndex.__init__-100"><a href="#StaticDiskIndex.__init__-100"><span class="linenos">100</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticDiskInt8Index</span>
</span><span id="StaticDiskIndex.__init__-101"><a href="#StaticDiskIndex.__init__-101"><span class="linenos">101</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StaticDiskIndex.__init__-102"><a href="#StaticDiskIndex.__init__-102"><span class="linenos">102</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticDiskFloatIndex</span>
</span><span id="StaticDiskIndex.__init__-103"><a href="#StaticDiskIndex.__init__-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">_index</span><span class="p">(</span>
</span><span id="StaticDiskIndex.__init__-104"><a href="#StaticDiskIndex.__init__-104"><span class="linenos">104</span></a>            <span class="n">distance_metric</span><span class="o">=</span><span class="n">dap_metric</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-105"><a href="#StaticDiskIndex.__init__-105"><span class="linenos">105</span></a>            <span class="n">index_path_prefix</span><span class="o">=</span><span class="n">index_prefix_path</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-106"><a href="#StaticDiskIndex.__init__-106"><span class="linenos">106</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-107"><a href="#StaticDiskIndex.__init__-107"><span class="linenos">107</span></a>            <span class="n">num_nodes_to_cache</span><span class="o">=</span><span class="n">num_nodes_to_cache</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-108"><a href="#StaticDiskIndex.__init__-108"><span class="linenos">108</span></a>            <span class="n">cache_mechanism</span><span class="o">=</span><span class="n">cache_mechanism</span><span class="p">,</span>
</span><span id="StaticDiskIndex.__init__-109"><a href="#StaticDiskIndex.__init__-109"><span class="linenos">109</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h3 id="parameters">Parameters</h3>

<ul>
<li><p><strong>index_directory</strong>: The directory containing the index files. This directory must contain the following
  files:</p>

<ul>
<li><code>{index_prefix}_sample_data.bin</code></li>
<li><code>{index_prefix}_mem.index.data</code></li>
<li><code>{index_prefix}_pq_compressed.bin</code></li>
<li><code>{index_prefix}_pq_pivots.bin</code></li>
<li><code>{index_prefix}_sample_ids.bin</code></li>
<li><code>{index_prefix}_disk.index</code></li>
</ul>

<p>It may also include the following optional files:</p>

<ul>
<li><code>{index_prefix}_vectors.bin</code>: Optional. <code><a href="">diskannpy</a></code> builder functions may create this file in the
<code>index_directory</code> if the index was created from a numpy array</li>
<li><code>{index_prefix}_metadata.bin</code>: Optional. <code><a href="">diskannpy</a></code> builder functions create this file to store metadata
about the index, such as vector dtype, distance metric, number of vectors and vector dimensionality.
If an index is built from the <code>diskann</code> cli tools, this file will not exist.</li>
</ul></li>
<li><strong>num_threads</strong>: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</li>
<li><strong>num_nodes_to_cache</strong>: Number of nodes to cache in memory (&gt; -1)</li>
<li><strong>cache_mechanism</strong>: 1 -> use the generated sample_data.bin file for
the index to initialize a set of cached nodes, up to <code>num_nodes_to_cache</code>, 2 -> ready the cache for up to
<code>num_nodes_to_cache</code>, but do not initialize it with any nodes. Any other value disables node caching.</li>
<li><strong>distance_metric</strong>: A <code>str</code>, strictly one of {"l2", "mips", "cosine"}. <code>l2</code> and <code>cosine</code> are supported for all 3
vector dtypes, but <code>mips</code> is only available for single precision floats. Default is <code>None</code>. <strong>This
value is only used if a <code>{index_prefix}_metadata.bin</code> file does not exist.</strong> If it does not exist,
you are required to provide it.</li>
<li><strong>vector_dtype</strong>: The vector dtype this index has been built with. <strong>This value is only used if a
<code>{index_prefix}_metadata.bin</code> file does not exist.</strong> If it does not exist, you are required to provide it.</li>
<li><strong>dimensions</strong>: The vector dimensionality of this index. All new vectors inserted must be the same
dimensionality. <strong>This value is only used if a <code>{index_prefix}_metadata.bin</code> file does not exist.</strong> If it
does not exist, you are required to provide it.</li>
<li><strong>index_prefix</strong>: The prefix of the index files. Defaults to "ann".</li>
</ul>
</div>


                            </div>
                            <div id="StaticDiskIndex.search" class="classattr">
                                        <input id="StaticDiskIndex.search-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">search</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">query</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]</span>,</span><span class="param">	<span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">beam_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span><span class="return-annotation">) -> <span class="n"><a href="#QueryResponse">QueryResponse</a></span>:</span></span>

                <label class="view-source-button" for="StaticDiskIndex.search-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StaticDiskIndex.search"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StaticDiskIndex.search-111"><a href="#StaticDiskIndex.search-111"><span class="linenos">111</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
</span><span id="StaticDiskIndex.search-112"><a href="#StaticDiskIndex.search-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">VectorLike</span><span class="p">,</span> <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">beam_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="StaticDiskIndex.search-113"><a href="#StaticDiskIndex.search-113"><span class="linenos">113</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponse</span><span class="p">:</span>
</span><span id="StaticDiskIndex.search-114"><a href="#StaticDiskIndex.search-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex.search-115"><a href="#StaticDiskIndex.search-115"><span class="linenos">115</span></a><span class="sd">        Searches the index by a single query vector.</span>
</span><span id="StaticDiskIndex.search-116"><a href="#StaticDiskIndex.search-116"><span class="linenos">116</span></a>
</span><span id="StaticDiskIndex.search-117"><a href="#StaticDiskIndex.search-117"><span class="linenos">117</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticDiskIndex.search-118"><a href="#StaticDiskIndex.search-118"><span class="linenos">118</span></a><span class="sd">        - **query**: 1d numpy array of the same dimensionality and dtype of the index.</span>
</span><span id="StaticDiskIndex.search-119"><a href="#StaticDiskIndex.search-119"><span class="linenos">119</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="StaticDiskIndex.search-120"><a href="#StaticDiskIndex.search-120"><span class="linenos">120</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="StaticDiskIndex.search-121"><a href="#StaticDiskIndex.search-121"><span class="linenos">121</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="StaticDiskIndex.search-122"><a href="#StaticDiskIndex.search-122"><span class="linenos">122</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="StaticDiskIndex.search-123"><a href="#StaticDiskIndex.search-123"><span class="linenos">123</span></a><span class="sd">        - **beam_width**: The beamwidth to be used for search. This is the maximum number of IO requests each query</span>
</span><span id="StaticDiskIndex.search-124"><a href="#StaticDiskIndex.search-124"><span class="linenos">124</span></a><span class="sd">          will issue per iteration of search code. Larger beamwidth will result in fewer IO round-trips per query,</span>
</span><span id="StaticDiskIndex.search-125"><a href="#StaticDiskIndex.search-125"><span class="linenos">125</span></a><span class="sd">          but might result in slightly higher total number of IO requests to SSD per query. For the highest query</span>
</span><span id="StaticDiskIndex.search-126"><a href="#StaticDiskIndex.search-126"><span class="linenos">126</span></a><span class="sd">          throughput with a fixed SSD IOps rating, use W=1. For best latency, use W=4,8 or higher complexity search.</span>
</span><span id="StaticDiskIndex.search-127"><a href="#StaticDiskIndex.search-127"><span class="linenos">127</span></a><span class="sd">          Specifying 0 will optimize the beamwidth depending on the number of threads performing search, but will</span>
</span><span id="StaticDiskIndex.search-128"><a href="#StaticDiskIndex.search-128"><span class="linenos">128</span></a><span class="sd">          involve some tuning overhead.</span>
</span><span id="StaticDiskIndex.search-129"><a href="#StaticDiskIndex.search-129"><span class="linenos">129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex.search-130"><a href="#StaticDiskIndex.search-130"><span class="linenos">130</span></a>        <span class="n">_query</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="StaticDiskIndex.search-131"><a href="#StaticDiskIndex.search-131"><span class="linenos">131</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;query vector must be 1-d&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.search-132"><a href="#StaticDiskIndex.search-132"><span class="linenos">132</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.search-133"><a href="#StaticDiskIndex.search-133"><span class="linenos">133</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.search-134"><a href="#StaticDiskIndex.search-134"><span class="linenos">134</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">beam_width</span><span class="p">,</span> <span class="s2">&quot;beam_width&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.search-135"><a href="#StaticDiskIndex.search-135"><span class="linenos">135</span></a>
</span><span id="StaticDiskIndex.search-136"><a href="#StaticDiskIndex.search-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="StaticDiskIndex.search-137"><a href="#StaticDiskIndex.search-137"><span class="linenos">137</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="StaticDiskIndex.search-138"><a href="#StaticDiskIndex.search-138"><span class="linenos">138</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">=}</span><span class="s2"> asked for, but </span><span class="si">{</span><span class="n">complexity</span><span class="si">=}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="StaticDiskIndex.search-139"><a href="#StaticDiskIndex.search-139"><span class="linenos">139</span></a>            <span class="p">)</span>
</span><span id="StaticDiskIndex.search-140"><a href="#StaticDiskIndex.search-140"><span class="linenos">140</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="StaticDiskIndex.search-141"><a href="#StaticDiskIndex.search-141"><span class="linenos">141</span></a>
</span><span id="StaticDiskIndex.search-142"><a href="#StaticDiskIndex.search-142"><span class="linenos">142</span></a>        <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
</span><span id="StaticDiskIndex.search-143"><a href="#StaticDiskIndex.search-143"><span class="linenos">143</span></a>            <span class="n">query</span><span class="o">=</span><span class="n">_query</span><span class="p">,</span>
</span><span id="StaticDiskIndex.search-144"><a href="#StaticDiskIndex.search-144"><span class="linenos">144</span></a>            <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span>
</span><span id="StaticDiskIndex.search-145"><a href="#StaticDiskIndex.search-145"><span class="linenos">145</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="StaticDiskIndex.search-146"><a href="#StaticDiskIndex.search-146"><span class="linenos">146</span></a>            <span class="n">beam_width</span><span class="o">=</span><span class="n">beam_width</span><span class="p">,</span>
</span><span id="StaticDiskIndex.search-147"><a href="#StaticDiskIndex.search-147"><span class="linenos">147</span></a>        <span class="p">)</span>
</span><span id="StaticDiskIndex.search-148"><a href="#StaticDiskIndex.search-148"><span class="linenos">148</span></a>        <span class="k">return</span> <span class="n">QueryResponse</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Searches the index by a single query vector.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>query</strong>: 1d numpy array of the same dimensionality and dtype of the index.</li>
<li><strong>k_neighbors</strong>: Number of neighbors to be returned. If query vector exists in index, it almost definitely
will be returned as well, so adjust your <code>k_neighbors</code> as appropriate. Must be &gt; 0.</li>
<li><strong>complexity</strong>: Size of distance ordered list of candidate neighbors to use while searching. List size
increases accuracy at the cost of latency. Must be at least k_neighbors in size.</li>
<li><strong>beam_width</strong>: The beamwidth to be used for search. This is the maximum number of IO requests each query
will issue per iteration of search code. Larger beamwidth will result in fewer IO round-trips per query,
but might result in slightly higher total number of IO requests to SSD per query. For the highest query
throughput with a fixed SSD IOps rating, use W=1. For best latency, use W=4,8 or higher complexity search.
Specifying 0 will optimize the beamwidth depending on the number of threads performing search, but will
involve some tuning overhead.</li>
</ul>
</div>


                            </div>
                            <div id="StaticDiskIndex.batch_search" class="classattr">
                                        <input id="StaticDiskIndex.batch_search-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">batch_search</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">queries</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]</span>,</span><span class="param">	<span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">beam_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></span><span class="return-annotation">) -> <span class="n"><a href="#QueryResponseBatch">QueryResponseBatch</a></span>:</span></span>

                <label class="view-source-button" for="StaticDiskIndex.batch_search-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StaticDiskIndex.batch_search"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StaticDiskIndex.batch_search-150"><a href="#StaticDiskIndex.batch_search-150"><span class="linenos">150</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_search</span><span class="p">(</span>
</span><span id="StaticDiskIndex.batch_search-151"><a href="#StaticDiskIndex.batch_search-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-152"><a href="#StaticDiskIndex.batch_search-152"><span class="linenos">152</span></a>        <span class="n">queries</span><span class="p">:</span> <span class="n">VectorLikeBatch</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-153"><a href="#StaticDiskIndex.batch_search-153"><span class="linenos">153</span></a>        <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-154"><a href="#StaticDiskIndex.batch_search-154"><span class="linenos">154</span></a>        <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-155"><a href="#StaticDiskIndex.batch_search-155"><span class="linenos">155</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-156"><a href="#StaticDiskIndex.batch_search-156"><span class="linenos">156</span></a>        <span class="n">beam_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-157"><a href="#StaticDiskIndex.batch_search-157"><span class="linenos">157</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponseBatch</span><span class="p">:</span>
</span><span id="StaticDiskIndex.batch_search-158"><a href="#StaticDiskIndex.batch_search-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex.batch_search-159"><a href="#StaticDiskIndex.batch_search-159"><span class="linenos">159</span></a><span class="sd">        Searches the index by a batch of query vectors.</span>
</span><span id="StaticDiskIndex.batch_search-160"><a href="#StaticDiskIndex.batch_search-160"><span class="linenos">160</span></a>
</span><span id="StaticDiskIndex.batch_search-161"><a href="#StaticDiskIndex.batch_search-161"><span class="linenos">161</span></a><span class="sd">        This search is parallelized and far more efficient than searching for each vector individually.</span>
</span><span id="StaticDiskIndex.batch_search-162"><a href="#StaticDiskIndex.batch_search-162"><span class="linenos">162</span></a>
</span><span id="StaticDiskIndex.batch_search-163"><a href="#StaticDiskIndex.batch_search-163"><span class="linenos">163</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticDiskIndex.batch_search-164"><a href="#StaticDiskIndex.batch_search-164"><span class="linenos">164</span></a><span class="sd">        - **queries**: 2d numpy array, with column dimensionality matching the index and row dimensionality being the</span>
</span><span id="StaticDiskIndex.batch_search-165"><a href="#StaticDiskIndex.batch_search-165"><span class="linenos">165</span></a><span class="sd">          number of queries intended to search for in parallel. Dtype must match dtype of the index.</span>
</span><span id="StaticDiskIndex.batch_search-166"><a href="#StaticDiskIndex.batch_search-166"><span class="linenos">166</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="StaticDiskIndex.batch_search-167"><a href="#StaticDiskIndex.batch_search-167"><span class="linenos">167</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="StaticDiskIndex.batch_search-168"><a href="#StaticDiskIndex.batch_search-168"><span class="linenos">168</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="StaticDiskIndex.batch_search-169"><a href="#StaticDiskIndex.batch_search-169"><span class="linenos">169</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="StaticDiskIndex.batch_search-170"><a href="#StaticDiskIndex.batch_search-170"><span class="linenos">170</span></a><span class="sd">        - **num_threads**: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="StaticDiskIndex.batch_search-171"><a href="#StaticDiskIndex.batch_search-171"><span class="linenos">171</span></a><span class="sd">        - **beam_width**: The beamwidth to be used for search. This is the maximum number of IO requests each query</span>
</span><span id="StaticDiskIndex.batch_search-172"><a href="#StaticDiskIndex.batch_search-172"><span class="linenos">172</span></a><span class="sd">          will issue per iteration of search code. Larger beamwidth will result in fewer IO round-trips per query,</span>
</span><span id="StaticDiskIndex.batch_search-173"><a href="#StaticDiskIndex.batch_search-173"><span class="linenos">173</span></a><span class="sd">          but might result in slightly higher total number of IO requests to SSD per query. For the highest query</span>
</span><span id="StaticDiskIndex.batch_search-174"><a href="#StaticDiskIndex.batch_search-174"><span class="linenos">174</span></a><span class="sd">          throughput with a fixed SSD IOps rating, use W=1. For best latency, use W=4,8 or higher complexity search.</span>
</span><span id="StaticDiskIndex.batch_search-175"><a href="#StaticDiskIndex.batch_search-175"><span class="linenos">175</span></a><span class="sd">          Specifying 0 will optimize the beamwidth depending on the number of threads performing search, but will</span>
</span><span id="StaticDiskIndex.batch_search-176"><a href="#StaticDiskIndex.batch_search-176"><span class="linenos">176</span></a><span class="sd">          involve some tuning overhead.</span>
</span><span id="StaticDiskIndex.batch_search-177"><a href="#StaticDiskIndex.batch_search-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticDiskIndex.batch_search-178"><a href="#StaticDiskIndex.batch_search-178"><span class="linenos">178</span></a>        <span class="n">_queries</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="StaticDiskIndex.batch_search-179"><a href="#StaticDiskIndex.batch_search-179"><span class="linenos">179</span></a>        <span class="n">_assert_2d</span><span class="p">(</span><span class="n">_queries</span><span class="p">,</span> <span class="s2">&quot;queries&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.batch_search-180"><a href="#StaticDiskIndex.batch_search-180"><span class="linenos">180</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.batch_search-181"><a href="#StaticDiskIndex.batch_search-181"><span class="linenos">181</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.batch_search-182"><a href="#StaticDiskIndex.batch_search-182"><span class="linenos">182</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.batch_search-183"><a href="#StaticDiskIndex.batch_search-183"><span class="linenos">183</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">beam_width</span><span class="p">,</span> <span class="s2">&quot;beam_width&quot;</span><span class="p">)</span>
</span><span id="StaticDiskIndex.batch_search-184"><a href="#StaticDiskIndex.batch_search-184"><span class="linenos">184</span></a>
</span><span id="StaticDiskIndex.batch_search-185"><a href="#StaticDiskIndex.batch_search-185"><span class="linenos">185</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="StaticDiskIndex.batch_search-186"><a href="#StaticDiskIndex.batch_search-186"><span class="linenos">186</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="StaticDiskIndex.batch_search-187"><a href="#StaticDiskIndex.batch_search-187"><span class="linenos">187</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">=}</span><span class="s2"> asked for, but </span><span class="si">{</span><span class="n">complexity</span><span class="si">=}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="StaticDiskIndex.batch_search-188"><a href="#StaticDiskIndex.batch_search-188"><span class="linenos">188</span></a>            <span class="p">)</span>
</span><span id="StaticDiskIndex.batch_search-189"><a href="#StaticDiskIndex.batch_search-189"><span class="linenos">189</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="StaticDiskIndex.batch_search-190"><a href="#StaticDiskIndex.batch_search-190"><span class="linenos">190</span></a>
</span><span id="StaticDiskIndex.batch_search-191"><a href="#StaticDiskIndex.batch_search-191"><span class="linenos">191</span></a>        <span class="n">num_queries</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">_queries</span><span class="o">.</span><span class="n">shape</span>
</span><span id="StaticDiskIndex.batch_search-192"><a href="#StaticDiskIndex.batch_search-192"><span class="linenos">192</span></a>        <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">batch_search</span><span class="p">(</span>
</span><span id="StaticDiskIndex.batch_search-193"><a href="#StaticDiskIndex.batch_search-193"><span class="linenos">193</span></a>            <span class="n">queries</span><span class="o">=</span><span class="n">_queries</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-194"><a href="#StaticDiskIndex.batch_search-194"><span class="linenos">194</span></a>            <span class="n">num_queries</span><span class="o">=</span><span class="n">num_queries</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-195"><a href="#StaticDiskIndex.batch_search-195"><span class="linenos">195</span></a>            <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-196"><a href="#StaticDiskIndex.batch_search-196"><span class="linenos">196</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-197"><a href="#StaticDiskIndex.batch_search-197"><span class="linenos">197</span></a>            <span class="n">beam_width</span><span class="o">=</span><span class="n">beam_width</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-198"><a href="#StaticDiskIndex.batch_search-198"><span class="linenos">198</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="StaticDiskIndex.batch_search-199"><a href="#StaticDiskIndex.batch_search-199"><span class="linenos">199</span></a>        <span class="p">)</span>
</span><span id="StaticDiskIndex.batch_search-200"><a href="#StaticDiskIndex.batch_search-200"><span class="linenos">200</span></a>        <span class="k">return</span> <span class="n">QueryResponseBatch</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Searches the index by a batch of query vectors.</p>

<p>This search is parallelized and far more efficient than searching for each vector individually.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>queries</strong>: 2d numpy array, with column dimensionality matching the index and row dimensionality being the
number of queries intended to search for in parallel. Dtype must match dtype of the index.</li>
<li><strong>k_neighbors</strong>: Number of neighbors to be returned. If query vector exists in index, it almost definitely
will be returned as well, so adjust your <code>k_neighbors</code> as appropriate. Must be &gt; 0.</li>
<li><strong>complexity</strong>: Size of distance ordered list of candidate neighbors to use while searching. List size
increases accuracy at the cost of latency. Must be at least k_neighbors in size.</li>
<li><strong>num_threads</strong>: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</li>
<li><strong>beam_width</strong>: The beamwidth to be used for search. This is the maximum number of IO requests each query
will issue per iteration of search code. Larger beamwidth will result in fewer IO round-trips per query,
but might result in slightly higher total number of IO requests to SSD per query. For the highest query
throughput with a fixed SSD IOps rating, use W=1. For best latency, use W=4,8 or higher complexity search.
Specifying 0 will optimize the beamwidth depending on the number of threads performing search, but will
involve some tuning overhead.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="StaticMemoryIndex">
                            <input id="StaticMemoryIndex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">StaticMemoryIndex</span>:

                <label class="view-source-button" for="StaticMemoryIndex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StaticMemoryIndex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StaticMemoryIndex-34"><a href="#StaticMemoryIndex-34"><span class="linenos"> 34</span></a><span class="k">class</span><span class="w"> </span><span class="nc">StaticMemoryIndex</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-35"><a href="#StaticMemoryIndex-35"><span class="linenos"> 35</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex-36"><a href="#StaticMemoryIndex-36"><span class="linenos"> 36</span></a><span class="sd">    A StaticMemoryIndex is an immutable in-memory DiskANN index.</span>
</span><span id="StaticMemoryIndex-37"><a href="#StaticMemoryIndex-37"><span class="linenos"> 37</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex-38"><a href="#StaticMemoryIndex-38"><span class="linenos"> 38</span></a>
</span><span id="StaticMemoryIndex-39"><a href="#StaticMemoryIndex-39"><span class="linenos"> 39</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-40"><a href="#StaticMemoryIndex-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-41"><a href="#StaticMemoryIndex-41"><span class="linenos"> 41</span></a>        <span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-42"><a href="#StaticMemoryIndex-42"><span class="linenos"> 42</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-43"><a href="#StaticMemoryIndex-43"><span class="linenos"> 43</span></a>        <span class="n">initial_search_complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-44"><a href="#StaticMemoryIndex-44"><span class="linenos"> 44</span></a>        <span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ann&quot;</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-45"><a href="#StaticMemoryIndex-45"><span class="linenos"> 45</span></a>        <span class="n">distance_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DistanceMetric</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-46"><a href="#StaticMemoryIndex-46"><span class="linenos"> 46</span></a>        <span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-47"><a href="#StaticMemoryIndex-47"><span class="linenos"> 47</span></a>        <span class="n">dimensions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-48"><a href="#StaticMemoryIndex-48"><span class="linenos"> 48</span></a>        <span class="n">enable_filters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StaticMemoryIndex-49"><a href="#StaticMemoryIndex-49"><span class="linenos"> 49</span></a>    <span class="p">):</span>
</span><span id="StaticMemoryIndex-50"><a href="#StaticMemoryIndex-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex-51"><a href="#StaticMemoryIndex-51"><span class="linenos"> 51</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticMemoryIndex-52"><a href="#StaticMemoryIndex-52"><span class="linenos"> 52</span></a><span class="sd">        - **index_directory**: The directory containing the index files. This directory must contain the following</span>
</span><span id="StaticMemoryIndex-53"><a href="#StaticMemoryIndex-53"><span class="linenos"> 53</span></a><span class="sd">          files:</span>
</span><span id="StaticMemoryIndex-54"><a href="#StaticMemoryIndex-54"><span class="linenos"> 54</span></a><span class="sd">            - `{index_prefix}.data`</span>
</span><span id="StaticMemoryIndex-55"><a href="#StaticMemoryIndex-55"><span class="linenos"> 55</span></a><span class="sd">            - `{index_prefix}`</span>
</span><span id="StaticMemoryIndex-56"><a href="#StaticMemoryIndex-56"><span class="linenos"> 56</span></a>
</span><span id="StaticMemoryIndex-57"><a href="#StaticMemoryIndex-57"><span class="linenos"> 57</span></a>
</span><span id="StaticMemoryIndex-58"><a href="#StaticMemoryIndex-58"><span class="linenos"> 58</span></a><span class="sd">          It may also include the following optional files:</span>
</span><span id="StaticMemoryIndex-59"><a href="#StaticMemoryIndex-59"><span class="linenos"> 59</span></a><span class="sd">            - `{index_prefix}_vectors.bin`: Optional. `diskannpy` builder functions may create this file in the</span>
</span><span id="StaticMemoryIndex-60"><a href="#StaticMemoryIndex-60"><span class="linenos"> 60</span></a><span class="sd">              `index_directory` if the index was created from a numpy array</span>
</span><span id="StaticMemoryIndex-61"><a href="#StaticMemoryIndex-61"><span class="linenos"> 61</span></a><span class="sd">            - `{index_prefix}_metadata.bin`: Optional. `diskannpy` builder functions create this file to store metadata</span>
</span><span id="StaticMemoryIndex-62"><a href="#StaticMemoryIndex-62"><span class="linenos"> 62</span></a><span class="sd">            about the index, such as vector dtype, distance metric, number of vectors and vector dimensionality.</span>
</span><span id="StaticMemoryIndex-63"><a href="#StaticMemoryIndex-63"><span class="linenos"> 63</span></a><span class="sd">            If an index is built from the `diskann` cli tools, this file will not exist.</span>
</span><span id="StaticMemoryIndex-64"><a href="#StaticMemoryIndex-64"><span class="linenos"> 64</span></a><span class="sd">        - **num_threads**: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="StaticMemoryIndex-65"><a href="#StaticMemoryIndex-65"><span class="linenos"> 65</span></a><span class="sd">        - **initial_search_complexity**: Should be set to the most common `complexity` expected to be used during the</span>
</span><span id="StaticMemoryIndex-66"><a href="#StaticMemoryIndex-66"><span class="linenos"> 66</span></a><span class="sd">          life of this `diskannpy.DynamicMemoryIndex` object. The working scratch memory allocated is based off of</span>
</span><span id="StaticMemoryIndex-67"><a href="#StaticMemoryIndex-67"><span class="linenos"> 67</span></a><span class="sd">          `initial_search_complexity` * `search_threads`. Note that it may be resized if a `search` or `batch_search`</span>
</span><span id="StaticMemoryIndex-68"><a href="#StaticMemoryIndex-68"><span class="linenos"> 68</span></a><span class="sd">          operation requests a space larger than can be accommodated by these values.</span>
</span><span id="StaticMemoryIndex-69"><a href="#StaticMemoryIndex-69"><span class="linenos"> 69</span></a><span class="sd">        - **index_prefix**: The prefix of the index files. Defaults to &quot;ann&quot;.</span>
</span><span id="StaticMemoryIndex-70"><a href="#StaticMemoryIndex-70"><span class="linenos"> 70</span></a><span class="sd">        - **distance_metric**: A `str`, strictly one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;}. `l2` and `cosine` are supported for all 3</span>
</span><span id="StaticMemoryIndex-71"><a href="#StaticMemoryIndex-71"><span class="linenos"> 71</span></a><span class="sd">          vector dtypes, but `mips` is only available for single precision floats. Default is `None`. **This</span>
</span><span id="StaticMemoryIndex-72"><a href="#StaticMemoryIndex-72"><span class="linenos"> 72</span></a><span class="sd">          value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it does not exist,</span>
</span><span id="StaticMemoryIndex-73"><a href="#StaticMemoryIndex-73"><span class="linenos"> 73</span></a><span class="sd">          you are required to provide it.</span>
</span><span id="StaticMemoryIndex-74"><a href="#StaticMemoryIndex-74"><span class="linenos"> 74</span></a><span class="sd">        - **vector_dtype**: The vector dtype this index has been built with. **This value is only used if a</span>
</span><span id="StaticMemoryIndex-75"><a href="#StaticMemoryIndex-75"><span class="linenos"> 75</span></a><span class="sd">          `{index_prefix}_metadata.bin` file does not exist.** If it does not exist, you are required to provide it.</span>
</span><span id="StaticMemoryIndex-76"><a href="#StaticMemoryIndex-76"><span class="linenos"> 76</span></a><span class="sd">        - **dimensions**: The vector dimensionality of this index. All new vectors inserted must be the same</span>
</span><span id="StaticMemoryIndex-77"><a href="#StaticMemoryIndex-77"><span class="linenos"> 77</span></a><span class="sd">          dimensionality. **This value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it</span>
</span><span id="StaticMemoryIndex-78"><a href="#StaticMemoryIndex-78"><span class="linenos"> 78</span></a><span class="sd">          does not exist, you are required to provide it.</span>
</span><span id="StaticMemoryIndex-79"><a href="#StaticMemoryIndex-79"><span class="linenos"> 79</span></a><span class="sd">        - **enable_filters**: Indexes built with filters can also be used for filtered search.</span>
</span><span id="StaticMemoryIndex-80"><a href="#StaticMemoryIndex-80"><span class="linenos"> 80</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex-81"><a href="#StaticMemoryIndex-81"><span class="linenos"> 81</span></a>        <span class="n">index_prefix_path</span> <span class="o">=</span> <span class="n">_valid_index_prefix</span><span class="p">(</span><span class="n">index_directory</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-82"><a href="#StaticMemoryIndex-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_labels_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StaticMemoryIndex-83"><a href="#StaticMemoryIndex-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_labels_metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StaticMemoryIndex-84"><a href="#StaticMemoryIndex-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="n">enable_filters</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-85"><a href="#StaticMemoryIndex-85"><span class="linenos"> 85</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-86"><a href="#StaticMemoryIndex-86"><span class="linenos"> 86</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index_prefix_path</span><span class="si">}</span><span class="s2">_labels_map.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">labels_map_if</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-87"><a href="#StaticMemoryIndex-87"><span class="linenos"> 87</span></a>                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">labels_map_if</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-88"><a href="#StaticMemoryIndex-88"><span class="linenos"> 88</span></a>                        <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-89"><a href="#StaticMemoryIndex-89"><span class="linenos"> 89</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_labels_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-90"><a href="#StaticMemoryIndex-90"><span class="linenos"> 90</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index_prefix_path</span><span class="si">}</span><span class="s2">_label_metadata.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">labels_metadata_if</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-91"><a href="#StaticMemoryIndex-91"><span class="linenos"> 91</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_labels_metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">labels_metadata_if</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-92"><a href="#StaticMemoryIndex-92"><span class="linenos"> 92</span></a>            <span class="k">except</span><span class="p">:</span> <span class="c1"># noqa: E722</span>
</span><span id="StaticMemoryIndex-93"><a href="#StaticMemoryIndex-93"><span class="linenos"> 93</span></a>                <span class="c1"># exceptions are basically presumed to be either file not found or file not formatted correctly</span>
</span><span id="StaticMemoryIndex-94"><a href="#StaticMemoryIndex-94"><span class="linenos"> 94</span></a>                <span class="k">raise</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s2">&quot;Filter labels file was unable to be processed.&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-95"><a href="#StaticMemoryIndex-95"><span class="linenos"> 95</span></a>        <span class="n">vector_dtype</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="n">_ensure_index_metadata</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-96"><a href="#StaticMemoryIndex-96"><span class="linenos"> 96</span></a>            <span class="n">index_prefix_path</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-97"><a href="#StaticMemoryIndex-97"><span class="linenos"> 97</span></a>            <span class="n">vector_dtype</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-98"><a href="#StaticMemoryIndex-98"><span class="linenos"> 98</span></a>            <span class="n">distance_metric</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-99"><a href="#StaticMemoryIndex-99"><span class="linenos"> 99</span></a>            <span class="mi">1</span><span class="p">,</span>  <span class="c1"># it doesn&#39;t matter because we don&#39;t need it in this context anyway</span>
</span><span id="StaticMemoryIndex-100"><a href="#StaticMemoryIndex-100"><span class="linenos">100</span></a>            <span class="n">dimensions</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-101"><a href="#StaticMemoryIndex-101"><span class="linenos">101</span></a>        <span class="p">)</span>
</span><span id="StaticMemoryIndex-102"><a href="#StaticMemoryIndex-102"><span class="linenos">102</span></a>        <span class="n">dap_metric</span> <span class="o">=</span> <span class="n">_valid_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-103"><a href="#StaticMemoryIndex-103"><span class="linenos">103</span></a>
</span><span id="StaticMemoryIndex-104"><a href="#StaticMemoryIndex-104"><span class="linenos">104</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-105"><a href="#StaticMemoryIndex-105"><span class="linenos">105</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-106"><a href="#StaticMemoryIndex-106"><span class="linenos">106</span></a>            <span class="n">initial_search_complexity</span><span class="p">,</span> <span class="s2">&quot;initial_search_complexity&quot;</span>
</span><span id="StaticMemoryIndex-107"><a href="#StaticMemoryIndex-107"><span class="linenos">107</span></a>        <span class="p">)</span>
</span><span id="StaticMemoryIndex-108"><a href="#StaticMemoryIndex-108"><span class="linenos">108</span></a>
</span><span id="StaticMemoryIndex-109"><a href="#StaticMemoryIndex-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span> <span class="o">=</span> <span class="n">vector_dtype</span>
</span><span id="StaticMemoryIndex-110"><a href="#StaticMemoryIndex-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="n">dims</span>
</span><span id="StaticMemoryIndex-111"><a href="#StaticMemoryIndex-111"><span class="linenos">111</span></a>
</span><span id="StaticMemoryIndex-112"><a href="#StaticMemoryIndex-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-113"><a href="#StaticMemoryIndex-113"><span class="linenos">113</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticMemoryUInt8Index</span>
</span><span id="StaticMemoryIndex-114"><a href="#StaticMemoryIndex-114"><span class="linenos">114</span></a>        <span class="k">elif</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-115"><a href="#StaticMemoryIndex-115"><span class="linenos">115</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticMemoryInt8Index</span>
</span><span id="StaticMemoryIndex-116"><a href="#StaticMemoryIndex-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-117"><a href="#StaticMemoryIndex-117"><span class="linenos">117</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticMemoryFloatIndex</span>
</span><span id="StaticMemoryIndex-118"><a href="#StaticMemoryIndex-118"><span class="linenos">118</span></a>
</span><span id="StaticMemoryIndex-119"><a href="#StaticMemoryIndex-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">_index</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-120"><a href="#StaticMemoryIndex-120"><span class="linenos">120</span></a>            <span class="n">distance_metric</span><span class="o">=</span><span class="n">dap_metric</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-121"><a href="#StaticMemoryIndex-121"><span class="linenos">121</span></a>            <span class="n">num_points</span><span class="o">=</span><span class="n">num_points</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-122"><a href="#StaticMemoryIndex-122"><span class="linenos">122</span></a>            <span class="n">dimensions</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-123"><a href="#StaticMemoryIndex-123"><span class="linenos">123</span></a>            <span class="n">index_path</span><span class="o">=</span><span class="n">index_prefix_path</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-124"><a href="#StaticMemoryIndex-124"><span class="linenos">124</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-125"><a href="#StaticMemoryIndex-125"><span class="linenos">125</span></a>            <span class="n">initial_search_complexity</span><span class="o">=</span><span class="n">initial_search_complexity</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-126"><a href="#StaticMemoryIndex-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span><span id="StaticMemoryIndex-127"><a href="#StaticMemoryIndex-127"><span class="linenos">127</span></a>
</span><span id="StaticMemoryIndex-128"><a href="#StaticMemoryIndex-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-129"><a href="#StaticMemoryIndex-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">VectorLike</span><span class="p">,</span> <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">filter_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StaticMemoryIndex-130"><a href="#StaticMemoryIndex-130"><span class="linenos">130</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponse</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-131"><a href="#StaticMemoryIndex-131"><span class="linenos">131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex-132"><a href="#StaticMemoryIndex-132"><span class="linenos">132</span></a><span class="sd">        Searches the index by a single query vector.</span>
</span><span id="StaticMemoryIndex-133"><a href="#StaticMemoryIndex-133"><span class="linenos">133</span></a>
</span><span id="StaticMemoryIndex-134"><a href="#StaticMemoryIndex-134"><span class="linenos">134</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticMemoryIndex-135"><a href="#StaticMemoryIndex-135"><span class="linenos">135</span></a><span class="sd">        - **query**: 1d numpy array of the same dimensionality and dtype of the index.</span>
</span><span id="StaticMemoryIndex-136"><a href="#StaticMemoryIndex-136"><span class="linenos">136</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="StaticMemoryIndex-137"><a href="#StaticMemoryIndex-137"><span class="linenos">137</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="StaticMemoryIndex-138"><a href="#StaticMemoryIndex-138"><span class="linenos">138</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="StaticMemoryIndex-139"><a href="#StaticMemoryIndex-139"><span class="linenos">139</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="StaticMemoryIndex-140"><a href="#StaticMemoryIndex-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex-141"><a href="#StaticMemoryIndex-141"><span class="linenos">141</span></a>        <span class="k">if</span> <span class="n">filter_label</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-142"><a href="#StaticMemoryIndex-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labels_map</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-143"><a href="#StaticMemoryIndex-143"><span class="linenos">143</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-144"><a href="#StaticMemoryIndex-144"><span class="linenos">144</span></a>                    <span class="sa">f</span><span class="s2">&quot;A filter label of </span><span class="si">{</span><span class="n">filter_label</span><span class="si">}</span><span class="s2"> was provided, but this class was not initialized with filters &quot;</span>
</span><span id="StaticMemoryIndex-145"><a href="#StaticMemoryIndex-145"><span class="linenos">145</span></a>                    <span class="s2">&quot;enabled, e.g. StaticDiskMemory(..., enable_filters=True)&quot;</span>
</span><span id="StaticMemoryIndex-146"><a href="#StaticMemoryIndex-146"><span class="linenos">146</span></a>                <span class="p">)</span>
</span><span id="StaticMemoryIndex-147"><a href="#StaticMemoryIndex-147"><span class="linenos">147</span></a>            <span class="k">if</span> <span class="n">filter_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels_map</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-148"><a href="#StaticMemoryIndex-148"><span class="linenos">148</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-149"><a href="#StaticMemoryIndex-149"><span class="linenos">149</span></a>                    <span class="sa">f</span><span class="s2">&quot;A filter label of </span><span class="si">{</span><span class="n">filter_label</span><span class="si">}</span><span class="s2"> was provided, but the external(str)-&gt;internal(np.uint32) labels map &quot;</span>
</span><span id="StaticMemoryIndex-150"><a href="#StaticMemoryIndex-150"><span class="linenos">150</span></a>                    <span class="sa">f</span><span class="s2">&quot;does not include that label.&quot;</span>
</span><span id="StaticMemoryIndex-151"><a href="#StaticMemoryIndex-151"><span class="linenos">151</span></a>                <span class="p">)</span>
</span><span id="StaticMemoryIndex-152"><a href="#StaticMemoryIndex-152"><span class="linenos">152</span></a>            <span class="n">k_neighbors</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels_metadata</span><span class="p">[</span><span class="n">filter_label</span><span class="p">])</span>
</span><span id="StaticMemoryIndex-153"><a href="#StaticMemoryIndex-153"><span class="linenos">153</span></a>        <span class="n">_query</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-154"><a href="#StaticMemoryIndex-154"><span class="linenos">154</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;query vector must be 1-d&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-155"><a href="#StaticMemoryIndex-155"><span class="linenos">155</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-156"><a href="#StaticMemoryIndex-156"><span class="linenos">156</span></a>            <span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-157"><a href="#StaticMemoryIndex-157"><span class="linenos">157</span></a>            <span class="sa">f</span><span class="s2">&quot;query vector must have the same dimensionality as the index; index dimensionality: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="StaticMemoryIndex-158"><a href="#StaticMemoryIndex-158"><span class="linenos">158</span></a>            <span class="sa">f</span><span class="s2">&quot;query dimensionality: </span><span class="si">{</span><span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-159"><a href="#StaticMemoryIndex-159"><span class="linenos">159</span></a>            <span class="p">)</span>
</span><span id="StaticMemoryIndex-160"><a href="#StaticMemoryIndex-160"><span class="linenos">160</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-161"><a href="#StaticMemoryIndex-161"><span class="linenos">161</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-162"><a href="#StaticMemoryIndex-162"><span class="linenos">162</span></a>
</span><span id="StaticMemoryIndex-163"><a href="#StaticMemoryIndex-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-164"><a href="#StaticMemoryIndex-164"><span class="linenos">164</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-165"><a href="#StaticMemoryIndex-165"><span class="linenos">165</span></a>                <span class="sa">f</span><span class="s2">&quot;k_neighbors=</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2"> asked for, but list_size=</span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="StaticMemoryIndex-166"><a href="#StaticMemoryIndex-166"><span class="linenos">166</span></a>            <span class="p">)</span>
</span><span id="StaticMemoryIndex-167"><a href="#StaticMemoryIndex-167"><span class="linenos">167</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="StaticMemoryIndex-168"><a href="#StaticMemoryIndex-168"><span class="linenos">168</span></a>
</span><span id="StaticMemoryIndex-169"><a href="#StaticMemoryIndex-169"><span class="linenos">169</span></a>        <span class="k">if</span> <span class="n">filter_label</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-170"><a href="#StaticMemoryIndex-170"><span class="linenos">170</span></a>            <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">_query</span><span class="p">,</span> <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-171"><a href="#StaticMemoryIndex-171"><span class="linenos">171</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-172"><a href="#StaticMemoryIndex-172"><span class="linenos">172</span></a>            <span class="nb">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels_map</span><span class="p">[</span><span class="n">filter_label</span><span class="p">]</span>
</span><span id="StaticMemoryIndex-173"><a href="#StaticMemoryIndex-173"><span class="linenos">173</span></a>            <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">search_with_filter</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-174"><a href="#StaticMemoryIndex-174"><span class="linenos">174</span></a>                <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-175"><a href="#StaticMemoryIndex-175"><span class="linenos">175</span></a>                <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-176"><a href="#StaticMemoryIndex-176"><span class="linenos">176</span></a>                <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-177"><a href="#StaticMemoryIndex-177"><span class="linenos">177</span></a>                <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span>
</span><span id="StaticMemoryIndex-178"><a href="#StaticMemoryIndex-178"><span class="linenos">178</span></a>            <span class="p">)</span>
</span><span id="StaticMemoryIndex-179"><a href="#StaticMemoryIndex-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="n">QueryResponse</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-180"><a href="#StaticMemoryIndex-180"><span class="linenos">180</span></a>
</span><span id="StaticMemoryIndex-181"><a href="#StaticMemoryIndex-181"><span class="linenos">181</span></a>
</span><span id="StaticMemoryIndex-182"><a href="#StaticMemoryIndex-182"><span class="linenos">182</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_search</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-183"><a href="#StaticMemoryIndex-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-184"><a href="#StaticMemoryIndex-184"><span class="linenos">184</span></a>        <span class="n">queries</span><span class="p">:</span> <span class="n">VectorLikeBatch</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-185"><a href="#StaticMemoryIndex-185"><span class="linenos">185</span></a>        <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-186"><a href="#StaticMemoryIndex-186"><span class="linenos">186</span></a>        <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-187"><a href="#StaticMemoryIndex-187"><span class="linenos">187</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-188"><a href="#StaticMemoryIndex-188"><span class="linenos">188</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponseBatch</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-189"><a href="#StaticMemoryIndex-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex-190"><a href="#StaticMemoryIndex-190"><span class="linenos">190</span></a><span class="sd">        Searches the index by a batch of query vectors.</span>
</span><span id="StaticMemoryIndex-191"><a href="#StaticMemoryIndex-191"><span class="linenos">191</span></a>
</span><span id="StaticMemoryIndex-192"><a href="#StaticMemoryIndex-192"><span class="linenos">192</span></a><span class="sd">        This search is parallelized and far more efficient than searching for each vector individually.</span>
</span><span id="StaticMemoryIndex-193"><a href="#StaticMemoryIndex-193"><span class="linenos">193</span></a>
</span><span id="StaticMemoryIndex-194"><a href="#StaticMemoryIndex-194"><span class="linenos">194</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticMemoryIndex-195"><a href="#StaticMemoryIndex-195"><span class="linenos">195</span></a><span class="sd">        - **queries**: 2d numpy array, with column dimensionality matching the index and row dimensionality being the</span>
</span><span id="StaticMemoryIndex-196"><a href="#StaticMemoryIndex-196"><span class="linenos">196</span></a><span class="sd">          number of queries intended to search for in parallel. Dtype must match dtype of the index.</span>
</span><span id="StaticMemoryIndex-197"><a href="#StaticMemoryIndex-197"><span class="linenos">197</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="StaticMemoryIndex-198"><a href="#StaticMemoryIndex-198"><span class="linenos">198</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="StaticMemoryIndex-199"><a href="#StaticMemoryIndex-199"><span class="linenos">199</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="StaticMemoryIndex-200"><a href="#StaticMemoryIndex-200"><span class="linenos">200</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="StaticMemoryIndex-201"><a href="#StaticMemoryIndex-201"><span class="linenos">201</span></a><span class="sd">        - **num_threads**: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="StaticMemoryIndex-202"><a href="#StaticMemoryIndex-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex-203"><a href="#StaticMemoryIndex-203"><span class="linenos">203</span></a>
</span><span id="StaticMemoryIndex-204"><a href="#StaticMemoryIndex-204"><span class="linenos">204</span></a>        <span class="n">_queries</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-205"><a href="#StaticMemoryIndex-205"><span class="linenos">205</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_queries</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;queries must must be 2-d np array&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-206"><a href="#StaticMemoryIndex-206"><span class="linenos">206</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-207"><a href="#StaticMemoryIndex-207"><span class="linenos">207</span></a>            <span class="n">_queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-208"><a href="#StaticMemoryIndex-208"><span class="linenos">208</span></a>            <span class="sa">f</span><span class="s2">&quot;query vectors must have the same dimensionality as the index; index dimensionality: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="StaticMemoryIndex-209"><a href="#StaticMemoryIndex-209"><span class="linenos">209</span></a>            <span class="sa">f</span><span class="s2">&quot;query dimensionality: </span><span class="si">{</span><span class="n">_queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-210"><a href="#StaticMemoryIndex-210"><span class="linenos">210</span></a>        <span class="p">)</span>
</span><span id="StaticMemoryIndex-211"><a href="#StaticMemoryIndex-211"><span class="linenos">211</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-212"><a href="#StaticMemoryIndex-212"><span class="linenos">212</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-213"><a href="#StaticMemoryIndex-213"><span class="linenos">213</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex-214"><a href="#StaticMemoryIndex-214"><span class="linenos">214</span></a>
</span><span id="StaticMemoryIndex-215"><a href="#StaticMemoryIndex-215"><span class="linenos">215</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="StaticMemoryIndex-216"><a href="#StaticMemoryIndex-216"><span class="linenos">216</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-217"><a href="#StaticMemoryIndex-217"><span class="linenos">217</span></a>                <span class="sa">f</span><span class="s2">&quot;k_neighbors=</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2"> asked for, but list_size=</span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="StaticMemoryIndex-218"><a href="#StaticMemoryIndex-218"><span class="linenos">218</span></a>            <span class="p">)</span>
</span><span id="StaticMemoryIndex-219"><a href="#StaticMemoryIndex-219"><span class="linenos">219</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="StaticMemoryIndex-220"><a href="#StaticMemoryIndex-220"><span class="linenos">220</span></a>
</span><span id="StaticMemoryIndex-221"><a href="#StaticMemoryIndex-221"><span class="linenos">221</span></a>        <span class="n">num_queries</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">_queries</span><span class="o">.</span><span class="n">shape</span>
</span><span id="StaticMemoryIndex-222"><a href="#StaticMemoryIndex-222"><span class="linenos">222</span></a>        <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">batch_search</span><span class="p">(</span>
</span><span id="StaticMemoryIndex-223"><a href="#StaticMemoryIndex-223"><span class="linenos">223</span></a>            <span class="n">queries</span><span class="o">=</span><span class="n">_queries</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-224"><a href="#StaticMemoryIndex-224"><span class="linenos">224</span></a>            <span class="n">num_queries</span><span class="o">=</span><span class="n">num_queries</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-225"><a href="#StaticMemoryIndex-225"><span class="linenos">225</span></a>            <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-226"><a href="#StaticMemoryIndex-226"><span class="linenos">226</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-227"><a href="#StaticMemoryIndex-227"><span class="linenos">227</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="StaticMemoryIndex-228"><a href="#StaticMemoryIndex-228"><span class="linenos">228</span></a>        <span class="p">)</span>
</span><span id="StaticMemoryIndex-229"><a href="#StaticMemoryIndex-229"><span class="linenos">229</span></a>        <span class="k">return</span> <span class="n">QueryResponseBatch</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A StaticMemoryIndex is an immutable in-memory DiskANN index.</p>
</div>


                            <div id="StaticMemoryIndex.__init__" class="classattr">
                                        <input id="StaticMemoryIndex.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">StaticMemoryIndex</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">initial_search_complexity</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ann&#39;</span>,</span><span class="param">	<span class="n">distance_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;mips&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dimensions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">enable_filters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="StaticMemoryIndex.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StaticMemoryIndex.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StaticMemoryIndex.__init__-39"><a href="#StaticMemoryIndex.__init__-39"><span class="linenos"> 39</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.__init__-40"><a href="#StaticMemoryIndex.__init__-40"><span class="linenos"> 40</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-41"><a href="#StaticMemoryIndex.__init__-41"><span class="linenos"> 41</span></a>        <span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-42"><a href="#StaticMemoryIndex.__init__-42"><span class="linenos"> 42</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-43"><a href="#StaticMemoryIndex.__init__-43"><span class="linenos"> 43</span></a>        <span class="n">initial_search_complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-44"><a href="#StaticMemoryIndex.__init__-44"><span class="linenos"> 44</span></a>        <span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ann&quot;</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-45"><a href="#StaticMemoryIndex.__init__-45"><span class="linenos"> 45</span></a>        <span class="n">distance_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DistanceMetric</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-46"><a href="#StaticMemoryIndex.__init__-46"><span class="linenos"> 46</span></a>        <span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-47"><a href="#StaticMemoryIndex.__init__-47"><span class="linenos"> 47</span></a>        <span class="n">dimensions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-48"><a href="#StaticMemoryIndex.__init__-48"><span class="linenos"> 48</span></a>        <span class="n">enable_filters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="StaticMemoryIndex.__init__-49"><a href="#StaticMemoryIndex.__init__-49"><span class="linenos"> 49</span></a>    <span class="p">):</span>
</span><span id="StaticMemoryIndex.__init__-50"><a href="#StaticMemoryIndex.__init__-50"><span class="linenos"> 50</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex.__init__-51"><a href="#StaticMemoryIndex.__init__-51"><span class="linenos"> 51</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticMemoryIndex.__init__-52"><a href="#StaticMemoryIndex.__init__-52"><span class="linenos"> 52</span></a><span class="sd">        - **index_directory**: The directory containing the index files. This directory must contain the following</span>
</span><span id="StaticMemoryIndex.__init__-53"><a href="#StaticMemoryIndex.__init__-53"><span class="linenos"> 53</span></a><span class="sd">          files:</span>
</span><span id="StaticMemoryIndex.__init__-54"><a href="#StaticMemoryIndex.__init__-54"><span class="linenos"> 54</span></a><span class="sd">            - `{index_prefix}.data`</span>
</span><span id="StaticMemoryIndex.__init__-55"><a href="#StaticMemoryIndex.__init__-55"><span class="linenos"> 55</span></a><span class="sd">            - `{index_prefix}`</span>
</span><span id="StaticMemoryIndex.__init__-56"><a href="#StaticMemoryIndex.__init__-56"><span class="linenos"> 56</span></a>
</span><span id="StaticMemoryIndex.__init__-57"><a href="#StaticMemoryIndex.__init__-57"><span class="linenos"> 57</span></a>
</span><span id="StaticMemoryIndex.__init__-58"><a href="#StaticMemoryIndex.__init__-58"><span class="linenos"> 58</span></a><span class="sd">          It may also include the following optional files:</span>
</span><span id="StaticMemoryIndex.__init__-59"><a href="#StaticMemoryIndex.__init__-59"><span class="linenos"> 59</span></a><span class="sd">            - `{index_prefix}_vectors.bin`: Optional. `diskannpy` builder functions may create this file in the</span>
</span><span id="StaticMemoryIndex.__init__-60"><a href="#StaticMemoryIndex.__init__-60"><span class="linenos"> 60</span></a><span class="sd">              `index_directory` if the index was created from a numpy array</span>
</span><span id="StaticMemoryIndex.__init__-61"><a href="#StaticMemoryIndex.__init__-61"><span class="linenos"> 61</span></a><span class="sd">            - `{index_prefix}_metadata.bin`: Optional. `diskannpy` builder functions create this file to store metadata</span>
</span><span id="StaticMemoryIndex.__init__-62"><a href="#StaticMemoryIndex.__init__-62"><span class="linenos"> 62</span></a><span class="sd">            about the index, such as vector dtype, distance metric, number of vectors and vector dimensionality.</span>
</span><span id="StaticMemoryIndex.__init__-63"><a href="#StaticMemoryIndex.__init__-63"><span class="linenos"> 63</span></a><span class="sd">            If an index is built from the `diskann` cli tools, this file will not exist.</span>
</span><span id="StaticMemoryIndex.__init__-64"><a href="#StaticMemoryIndex.__init__-64"><span class="linenos"> 64</span></a><span class="sd">        - **num_threads**: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="StaticMemoryIndex.__init__-65"><a href="#StaticMemoryIndex.__init__-65"><span class="linenos"> 65</span></a><span class="sd">        - **initial_search_complexity**: Should be set to the most common `complexity` expected to be used during the</span>
</span><span id="StaticMemoryIndex.__init__-66"><a href="#StaticMemoryIndex.__init__-66"><span class="linenos"> 66</span></a><span class="sd">          life of this `diskannpy.DynamicMemoryIndex` object. The working scratch memory allocated is based off of</span>
</span><span id="StaticMemoryIndex.__init__-67"><a href="#StaticMemoryIndex.__init__-67"><span class="linenos"> 67</span></a><span class="sd">          `initial_search_complexity` * `search_threads`. Note that it may be resized if a `search` or `batch_search`</span>
</span><span id="StaticMemoryIndex.__init__-68"><a href="#StaticMemoryIndex.__init__-68"><span class="linenos"> 68</span></a><span class="sd">          operation requests a space larger than can be accommodated by these values.</span>
</span><span id="StaticMemoryIndex.__init__-69"><a href="#StaticMemoryIndex.__init__-69"><span class="linenos"> 69</span></a><span class="sd">        - **index_prefix**: The prefix of the index files. Defaults to &quot;ann&quot;.</span>
</span><span id="StaticMemoryIndex.__init__-70"><a href="#StaticMemoryIndex.__init__-70"><span class="linenos"> 70</span></a><span class="sd">        - **distance_metric**: A `str`, strictly one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;}. `l2` and `cosine` are supported for all 3</span>
</span><span id="StaticMemoryIndex.__init__-71"><a href="#StaticMemoryIndex.__init__-71"><span class="linenos"> 71</span></a><span class="sd">          vector dtypes, but `mips` is only available for single precision floats. Default is `None`. **This</span>
</span><span id="StaticMemoryIndex.__init__-72"><a href="#StaticMemoryIndex.__init__-72"><span class="linenos"> 72</span></a><span class="sd">          value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it does not exist,</span>
</span><span id="StaticMemoryIndex.__init__-73"><a href="#StaticMemoryIndex.__init__-73"><span class="linenos"> 73</span></a><span class="sd">          you are required to provide it.</span>
</span><span id="StaticMemoryIndex.__init__-74"><a href="#StaticMemoryIndex.__init__-74"><span class="linenos"> 74</span></a><span class="sd">        - **vector_dtype**: The vector dtype this index has been built with. **This value is only used if a</span>
</span><span id="StaticMemoryIndex.__init__-75"><a href="#StaticMemoryIndex.__init__-75"><span class="linenos"> 75</span></a><span class="sd">          `{index_prefix}_metadata.bin` file does not exist.** If it does not exist, you are required to provide it.</span>
</span><span id="StaticMemoryIndex.__init__-76"><a href="#StaticMemoryIndex.__init__-76"><span class="linenos"> 76</span></a><span class="sd">        - **dimensions**: The vector dimensionality of this index. All new vectors inserted must be the same</span>
</span><span id="StaticMemoryIndex.__init__-77"><a href="#StaticMemoryIndex.__init__-77"><span class="linenos"> 77</span></a><span class="sd">          dimensionality. **This value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it</span>
</span><span id="StaticMemoryIndex.__init__-78"><a href="#StaticMemoryIndex.__init__-78"><span class="linenos"> 78</span></a><span class="sd">          does not exist, you are required to provide it.</span>
</span><span id="StaticMemoryIndex.__init__-79"><a href="#StaticMemoryIndex.__init__-79"><span class="linenos"> 79</span></a><span class="sd">        - **enable_filters**: Indexes built with filters can also be used for filtered search.</span>
</span><span id="StaticMemoryIndex.__init__-80"><a href="#StaticMemoryIndex.__init__-80"><span class="linenos"> 80</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex.__init__-81"><a href="#StaticMemoryIndex.__init__-81"><span class="linenos"> 81</span></a>        <span class="n">index_prefix_path</span> <span class="o">=</span> <span class="n">_valid_index_prefix</span><span class="p">(</span><span class="n">index_directory</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.__init__-82"><a href="#StaticMemoryIndex.__init__-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_labels_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StaticMemoryIndex.__init__-83"><a href="#StaticMemoryIndex.__init__-83"><span class="linenos"> 83</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_labels_metadata</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StaticMemoryIndex.__init__-84"><a href="#StaticMemoryIndex.__init__-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="n">enable_filters</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.__init__-85"><a href="#StaticMemoryIndex.__init__-85"><span class="linenos"> 85</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.__init__-86"><a href="#StaticMemoryIndex.__init__-86"><span class="linenos"> 86</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index_prefix_path</span><span class="si">}</span><span class="s2">_labels_map.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">labels_map_if</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.__init__-87"><a href="#StaticMemoryIndex.__init__-87"><span class="linenos"> 87</span></a>                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">labels_map_if</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.__init__-88"><a href="#StaticMemoryIndex.__init__-88"><span class="linenos"> 88</span></a>                        <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.__init__-89"><a href="#StaticMemoryIndex.__init__-89"><span class="linenos"> 89</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_labels_map</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.__init__-90"><a href="#StaticMemoryIndex.__init__-90"><span class="linenos"> 90</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">index_prefix_path</span><span class="si">}</span><span class="s2">_label_metadata.json&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">labels_metadata_if</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.__init__-91"><a href="#StaticMemoryIndex.__init__-91"><span class="linenos"> 91</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_labels_metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">labels_metadata_if</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.__init__-92"><a href="#StaticMemoryIndex.__init__-92"><span class="linenos"> 92</span></a>            <span class="k">except</span><span class="p">:</span> <span class="c1"># noqa: E722</span>
</span><span id="StaticMemoryIndex.__init__-93"><a href="#StaticMemoryIndex.__init__-93"><span class="linenos"> 93</span></a>                <span class="c1"># exceptions are basically presumed to be either file not found or file not formatted correctly</span>
</span><span id="StaticMemoryIndex.__init__-94"><a href="#StaticMemoryIndex.__init__-94"><span class="linenos"> 94</span></a>                <span class="k">raise</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s2">&quot;Filter labels file was unable to be processed.&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.__init__-95"><a href="#StaticMemoryIndex.__init__-95"><span class="linenos"> 95</span></a>        <span class="n">vector_dtype</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="n">_ensure_index_metadata</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.__init__-96"><a href="#StaticMemoryIndex.__init__-96"><span class="linenos"> 96</span></a>            <span class="n">index_prefix_path</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-97"><a href="#StaticMemoryIndex.__init__-97"><span class="linenos"> 97</span></a>            <span class="n">vector_dtype</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-98"><a href="#StaticMemoryIndex.__init__-98"><span class="linenos"> 98</span></a>            <span class="n">distance_metric</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-99"><a href="#StaticMemoryIndex.__init__-99"><span class="linenos"> 99</span></a>            <span class="mi">1</span><span class="p">,</span>  <span class="c1"># it doesn&#39;t matter because we don&#39;t need it in this context anyway</span>
</span><span id="StaticMemoryIndex.__init__-100"><a href="#StaticMemoryIndex.__init__-100"><span class="linenos">100</span></a>            <span class="n">dimensions</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-101"><a href="#StaticMemoryIndex.__init__-101"><span class="linenos">101</span></a>        <span class="p">)</span>
</span><span id="StaticMemoryIndex.__init__-102"><a href="#StaticMemoryIndex.__init__-102"><span class="linenos">102</span></a>        <span class="n">dap_metric</span> <span class="o">=</span> <span class="n">_valid_metric</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.__init__-103"><a href="#StaticMemoryIndex.__init__-103"><span class="linenos">103</span></a>
</span><span id="StaticMemoryIndex.__init__-104"><a href="#StaticMemoryIndex.__init__-104"><span class="linenos">104</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.__init__-105"><a href="#StaticMemoryIndex.__init__-105"><span class="linenos">105</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.__init__-106"><a href="#StaticMemoryIndex.__init__-106"><span class="linenos">106</span></a>            <span class="n">initial_search_complexity</span><span class="p">,</span> <span class="s2">&quot;initial_search_complexity&quot;</span>
</span><span id="StaticMemoryIndex.__init__-107"><a href="#StaticMemoryIndex.__init__-107"><span class="linenos">107</span></a>        <span class="p">)</span>
</span><span id="StaticMemoryIndex.__init__-108"><a href="#StaticMemoryIndex.__init__-108"><span class="linenos">108</span></a>
</span><span id="StaticMemoryIndex.__init__-109"><a href="#StaticMemoryIndex.__init__-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span> <span class="o">=</span> <span class="n">vector_dtype</span>
</span><span id="StaticMemoryIndex.__init__-110"><a href="#StaticMemoryIndex.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="n">dims</span>
</span><span id="StaticMemoryIndex.__init__-111"><a href="#StaticMemoryIndex.__init__-111"><span class="linenos">111</span></a>
</span><span id="StaticMemoryIndex.__init__-112"><a href="#StaticMemoryIndex.__init__-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.__init__-113"><a href="#StaticMemoryIndex.__init__-113"><span class="linenos">113</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticMemoryUInt8Index</span>
</span><span id="StaticMemoryIndex.__init__-114"><a href="#StaticMemoryIndex.__init__-114"><span class="linenos">114</span></a>        <span class="k">elif</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.__init__-115"><a href="#StaticMemoryIndex.__init__-115"><span class="linenos">115</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticMemoryInt8Index</span>
</span><span id="StaticMemoryIndex.__init__-116"><a href="#StaticMemoryIndex.__init__-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.__init__-117"><a href="#StaticMemoryIndex.__init__-117"><span class="linenos">117</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">StaticMemoryFloatIndex</span>
</span><span id="StaticMemoryIndex.__init__-118"><a href="#StaticMemoryIndex.__init__-118"><span class="linenos">118</span></a>
</span><span id="StaticMemoryIndex.__init__-119"><a href="#StaticMemoryIndex.__init__-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">_index</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.__init__-120"><a href="#StaticMemoryIndex.__init__-120"><span class="linenos">120</span></a>            <span class="n">distance_metric</span><span class="o">=</span><span class="n">dap_metric</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-121"><a href="#StaticMemoryIndex.__init__-121"><span class="linenos">121</span></a>            <span class="n">num_points</span><span class="o">=</span><span class="n">num_points</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-122"><a href="#StaticMemoryIndex.__init__-122"><span class="linenos">122</span></a>            <span class="n">dimensions</span><span class="o">=</span><span class="n">dims</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-123"><a href="#StaticMemoryIndex.__init__-123"><span class="linenos">123</span></a>            <span class="n">index_path</span><span class="o">=</span><span class="n">index_prefix_path</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-124"><a href="#StaticMemoryIndex.__init__-124"><span class="linenos">124</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-125"><a href="#StaticMemoryIndex.__init__-125"><span class="linenos">125</span></a>            <span class="n">initial_search_complexity</span><span class="o">=</span><span class="n">initial_search_complexity</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.__init__-126"><a href="#StaticMemoryIndex.__init__-126"><span class="linenos">126</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><h3 id="parameters">Parameters</h3>

<ul>
<li><p><strong>index_directory</strong>: The directory containing the index files. This directory must contain the following
files:</p>

<ul>
<li><code>{index_prefix}.data</code></li>
<li><code>{index_prefix}</code></li>
</ul>

<p>It may also include the following optional files:</p>

<ul>
<li><code>{index_prefix}_vectors.bin</code>: Optional. <code><a href="">diskannpy</a></code> builder functions may create this file in the
<code>index_directory</code> if the index was created from a numpy array</li>
<li><code>{index_prefix}_metadata.bin</code>: Optional. <code><a href="">diskannpy</a></code> builder functions create this file to store metadata
about the index, such as vector dtype, distance metric, number of vectors and vector dimensionality.
If an index is built from the <code>diskann</code> cli tools, this file will not exist.</li>
</ul></li>
<li><strong>num_threads</strong>: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</li>
<li><strong>initial_search_complexity</strong>: Should be set to the most common <code>complexity</code> expected to be used during the
life of this <code><a href="#DynamicMemoryIndex">diskannpy.DynamicMemoryIndex</a></code> object. The working scratch memory allocated is based off of
<code>initial_search_complexity</code> * <code>search_threads</code>. Note that it may be resized if a <code><a href="#StaticMemoryIndex.search">search</a></code> or <code><a href="#StaticMemoryIndex.batch_search">batch_search</a></code>
operation requests a space larger than can be accommodated by these values.</li>
<li><strong>index_prefix</strong>: The prefix of the index files. Defaults to "ann".</li>
<li><strong>distance_metric</strong>: A <code>str</code>, strictly one of {"l2", "mips", "cosine"}. <code>l2</code> and <code>cosine</code> are supported for all 3
vector dtypes, but <code>mips</code> is only available for single precision floats. Default is <code>None</code>. <strong>This
value is only used if a <code>{index_prefix}_metadata.bin</code> file does not exist.</strong> If it does not exist,
you are required to provide it.</li>
<li><strong>vector_dtype</strong>: The vector dtype this index has been built with. <strong>This value is only used if a
<code>{index_prefix}_metadata.bin</code> file does not exist.</strong> If it does not exist, you are required to provide it.</li>
<li><strong>dimensions</strong>: The vector dimensionality of this index. All new vectors inserted must be the same
dimensionality. <strong>This value is only used if a <code>{index_prefix}_metadata.bin</code> file does not exist.</strong> If it
does not exist, you are required to provide it.</li>
<li><strong>enable_filters</strong>: Indexes built with filters can also be used for filtered search.</li>
</ul>
</div>


                            </div>
                            <div id="StaticMemoryIndex.search" class="classattr">
                                        <input id="StaticMemoryIndex.search-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">search</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">query</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]</span>,</span><span class="param">	<span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">filter_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="#QueryResponse">QueryResponse</a></span>:</span></span>

                <label class="view-source-button" for="StaticMemoryIndex.search-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StaticMemoryIndex.search"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StaticMemoryIndex.search-128"><a href="#StaticMemoryIndex.search-128"><span class="linenos">128</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.search-129"><a href="#StaticMemoryIndex.search-129"><span class="linenos">129</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">VectorLike</span><span class="p">,</span> <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">filter_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="StaticMemoryIndex.search-130"><a href="#StaticMemoryIndex.search-130"><span class="linenos">130</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponse</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.search-131"><a href="#StaticMemoryIndex.search-131"><span class="linenos">131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex.search-132"><a href="#StaticMemoryIndex.search-132"><span class="linenos">132</span></a><span class="sd">        Searches the index by a single query vector.</span>
</span><span id="StaticMemoryIndex.search-133"><a href="#StaticMemoryIndex.search-133"><span class="linenos">133</span></a>
</span><span id="StaticMemoryIndex.search-134"><a href="#StaticMemoryIndex.search-134"><span class="linenos">134</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticMemoryIndex.search-135"><a href="#StaticMemoryIndex.search-135"><span class="linenos">135</span></a><span class="sd">        - **query**: 1d numpy array of the same dimensionality and dtype of the index.</span>
</span><span id="StaticMemoryIndex.search-136"><a href="#StaticMemoryIndex.search-136"><span class="linenos">136</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="StaticMemoryIndex.search-137"><a href="#StaticMemoryIndex.search-137"><span class="linenos">137</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="StaticMemoryIndex.search-138"><a href="#StaticMemoryIndex.search-138"><span class="linenos">138</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="StaticMemoryIndex.search-139"><a href="#StaticMemoryIndex.search-139"><span class="linenos">139</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="StaticMemoryIndex.search-140"><a href="#StaticMemoryIndex.search-140"><span class="linenos">140</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex.search-141"><a href="#StaticMemoryIndex.search-141"><span class="linenos">141</span></a>        <span class="k">if</span> <span class="n">filter_label</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.search-142"><a href="#StaticMemoryIndex.search-142"><span class="linenos">142</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_labels_map</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.search-143"><a href="#StaticMemoryIndex.search-143"><span class="linenos">143</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.search-144"><a href="#StaticMemoryIndex.search-144"><span class="linenos">144</span></a>                    <span class="sa">f</span><span class="s2">&quot;A filter label of </span><span class="si">{</span><span class="n">filter_label</span><span class="si">}</span><span class="s2"> was provided, but this class was not initialized with filters &quot;</span>
</span><span id="StaticMemoryIndex.search-145"><a href="#StaticMemoryIndex.search-145"><span class="linenos">145</span></a>                    <span class="s2">&quot;enabled, e.g. StaticDiskMemory(..., enable_filters=True)&quot;</span>
</span><span id="StaticMemoryIndex.search-146"><a href="#StaticMemoryIndex.search-146"><span class="linenos">146</span></a>                <span class="p">)</span>
</span><span id="StaticMemoryIndex.search-147"><a href="#StaticMemoryIndex.search-147"><span class="linenos">147</span></a>            <span class="k">if</span> <span class="n">filter_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels_map</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.search-148"><a href="#StaticMemoryIndex.search-148"><span class="linenos">148</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.search-149"><a href="#StaticMemoryIndex.search-149"><span class="linenos">149</span></a>                    <span class="sa">f</span><span class="s2">&quot;A filter label of </span><span class="si">{</span><span class="n">filter_label</span><span class="si">}</span><span class="s2"> was provided, but the external(str)-&gt;internal(np.uint32) labels map &quot;</span>
</span><span id="StaticMemoryIndex.search-150"><a href="#StaticMemoryIndex.search-150"><span class="linenos">150</span></a>                    <span class="sa">f</span><span class="s2">&quot;does not include that label.&quot;</span>
</span><span id="StaticMemoryIndex.search-151"><a href="#StaticMemoryIndex.search-151"><span class="linenos">151</span></a>                <span class="p">)</span>
</span><span id="StaticMemoryIndex.search-152"><a href="#StaticMemoryIndex.search-152"><span class="linenos">152</span></a>            <span class="n">k_neighbors</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels_metadata</span><span class="p">[</span><span class="n">filter_label</span><span class="p">])</span>
</span><span id="StaticMemoryIndex.search-153"><a href="#StaticMemoryIndex.search-153"><span class="linenos">153</span></a>        <span class="n">_query</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.search-154"><a href="#StaticMemoryIndex.search-154"><span class="linenos">154</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;query vector must be 1-d&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.search-155"><a href="#StaticMemoryIndex.search-155"><span class="linenos">155</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.search-156"><a href="#StaticMemoryIndex.search-156"><span class="linenos">156</span></a>            <span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.search-157"><a href="#StaticMemoryIndex.search-157"><span class="linenos">157</span></a>            <span class="sa">f</span><span class="s2">&quot;query vector must have the same dimensionality as the index; index dimensionality: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="StaticMemoryIndex.search-158"><a href="#StaticMemoryIndex.search-158"><span class="linenos">158</span></a>            <span class="sa">f</span><span class="s2">&quot;query dimensionality: </span><span class="si">{</span><span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.search-159"><a href="#StaticMemoryIndex.search-159"><span class="linenos">159</span></a>            <span class="p">)</span>
</span><span id="StaticMemoryIndex.search-160"><a href="#StaticMemoryIndex.search-160"><span class="linenos">160</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.search-161"><a href="#StaticMemoryIndex.search-161"><span class="linenos">161</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.search-162"><a href="#StaticMemoryIndex.search-162"><span class="linenos">162</span></a>
</span><span id="StaticMemoryIndex.search-163"><a href="#StaticMemoryIndex.search-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.search-164"><a href="#StaticMemoryIndex.search-164"><span class="linenos">164</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.search-165"><a href="#StaticMemoryIndex.search-165"><span class="linenos">165</span></a>                <span class="sa">f</span><span class="s2">&quot;k_neighbors=</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2"> asked for, but list_size=</span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="StaticMemoryIndex.search-166"><a href="#StaticMemoryIndex.search-166"><span class="linenos">166</span></a>            <span class="p">)</span>
</span><span id="StaticMemoryIndex.search-167"><a href="#StaticMemoryIndex.search-167"><span class="linenos">167</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="StaticMemoryIndex.search-168"><a href="#StaticMemoryIndex.search-168"><span class="linenos">168</span></a>
</span><span id="StaticMemoryIndex.search-169"><a href="#StaticMemoryIndex.search-169"><span class="linenos">169</span></a>        <span class="k">if</span> <span class="n">filter_label</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.search-170"><a href="#StaticMemoryIndex.search-170"><span class="linenos">170</span></a>            <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">_query</span><span class="p">,</span> <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.search-171"><a href="#StaticMemoryIndex.search-171"><span class="linenos">171</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.search-172"><a href="#StaticMemoryIndex.search-172"><span class="linenos">172</span></a>            <span class="nb">filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_labels_map</span><span class="p">[</span><span class="n">filter_label</span><span class="p">]</span>
</span><span id="StaticMemoryIndex.search-173"><a href="#StaticMemoryIndex.search-173"><span class="linenos">173</span></a>            <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">search_with_filter</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.search-174"><a href="#StaticMemoryIndex.search-174"><span class="linenos">174</span></a>                <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.search-175"><a href="#StaticMemoryIndex.search-175"><span class="linenos">175</span></a>                <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.search-176"><a href="#StaticMemoryIndex.search-176"><span class="linenos">176</span></a>                <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.search-177"><a href="#StaticMemoryIndex.search-177"><span class="linenos">177</span></a>                <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span>
</span><span id="StaticMemoryIndex.search-178"><a href="#StaticMemoryIndex.search-178"><span class="linenos">178</span></a>            <span class="p">)</span>
</span><span id="StaticMemoryIndex.search-179"><a href="#StaticMemoryIndex.search-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="n">QueryResponse</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Searches the index by a single query vector.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>query</strong>: 1d numpy array of the same dimensionality and dtype of the index.</li>
<li><strong>k_neighbors</strong>: Number of neighbors to be returned. If query vector exists in index, it almost definitely
will be returned as well, so adjust your <code>k_neighbors</code> as appropriate. Must be &gt; 0.</li>
<li><strong>complexity</strong>: Size of distance ordered list of candidate neighbors to use while searching. List size
increases accuracy at the cost of latency. Must be at least k_neighbors in size.</li>
</ul>
</div>


                            </div>
                            <div id="StaticMemoryIndex.batch_search" class="classattr">
                                        <input id="StaticMemoryIndex.batch_search-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">batch_search</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">queries</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]</span>,</span><span class="param">	<span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#QueryResponseBatch">QueryResponseBatch</a></span>:</span></span>

                <label class="view-source-button" for="StaticMemoryIndex.batch_search-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StaticMemoryIndex.batch_search"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StaticMemoryIndex.batch_search-182"><a href="#StaticMemoryIndex.batch_search-182"><span class="linenos">182</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_search</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.batch_search-183"><a href="#StaticMemoryIndex.batch_search-183"><span class="linenos">183</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-184"><a href="#StaticMemoryIndex.batch_search-184"><span class="linenos">184</span></a>        <span class="n">queries</span><span class="p">:</span> <span class="n">VectorLikeBatch</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-185"><a href="#StaticMemoryIndex.batch_search-185"><span class="linenos">185</span></a>        <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-186"><a href="#StaticMemoryIndex.batch_search-186"><span class="linenos">186</span></a>        <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-187"><a href="#StaticMemoryIndex.batch_search-187"><span class="linenos">187</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-188"><a href="#StaticMemoryIndex.batch_search-188"><span class="linenos">188</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponseBatch</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.batch_search-189"><a href="#StaticMemoryIndex.batch_search-189"><span class="linenos">189</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex.batch_search-190"><a href="#StaticMemoryIndex.batch_search-190"><span class="linenos">190</span></a><span class="sd">        Searches the index by a batch of query vectors.</span>
</span><span id="StaticMemoryIndex.batch_search-191"><a href="#StaticMemoryIndex.batch_search-191"><span class="linenos">191</span></a>
</span><span id="StaticMemoryIndex.batch_search-192"><a href="#StaticMemoryIndex.batch_search-192"><span class="linenos">192</span></a><span class="sd">        This search is parallelized and far more efficient than searching for each vector individually.</span>
</span><span id="StaticMemoryIndex.batch_search-193"><a href="#StaticMemoryIndex.batch_search-193"><span class="linenos">193</span></a>
</span><span id="StaticMemoryIndex.batch_search-194"><a href="#StaticMemoryIndex.batch_search-194"><span class="linenos">194</span></a><span class="sd">        ### Parameters</span>
</span><span id="StaticMemoryIndex.batch_search-195"><a href="#StaticMemoryIndex.batch_search-195"><span class="linenos">195</span></a><span class="sd">        - **queries**: 2d numpy array, with column dimensionality matching the index and row dimensionality being the</span>
</span><span id="StaticMemoryIndex.batch_search-196"><a href="#StaticMemoryIndex.batch_search-196"><span class="linenos">196</span></a><span class="sd">          number of queries intended to search for in parallel. Dtype must match dtype of the index.</span>
</span><span id="StaticMemoryIndex.batch_search-197"><a href="#StaticMemoryIndex.batch_search-197"><span class="linenos">197</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="StaticMemoryIndex.batch_search-198"><a href="#StaticMemoryIndex.batch_search-198"><span class="linenos">198</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="StaticMemoryIndex.batch_search-199"><a href="#StaticMemoryIndex.batch_search-199"><span class="linenos">199</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="StaticMemoryIndex.batch_search-200"><a href="#StaticMemoryIndex.batch_search-200"><span class="linenos">200</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="StaticMemoryIndex.batch_search-201"><a href="#StaticMemoryIndex.batch_search-201"><span class="linenos">201</span></a><span class="sd">        - **num_threads**: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="StaticMemoryIndex.batch_search-202"><a href="#StaticMemoryIndex.batch_search-202"><span class="linenos">202</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StaticMemoryIndex.batch_search-203"><a href="#StaticMemoryIndex.batch_search-203"><span class="linenos">203</span></a>
</span><span id="StaticMemoryIndex.batch_search-204"><a href="#StaticMemoryIndex.batch_search-204"><span class="linenos">204</span></a>        <span class="n">_queries</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.batch_search-205"><a href="#StaticMemoryIndex.batch_search-205"><span class="linenos">205</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_queries</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;queries must must be 2-d np array&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.batch_search-206"><a href="#StaticMemoryIndex.batch_search-206"><span class="linenos">206</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.batch_search-207"><a href="#StaticMemoryIndex.batch_search-207"><span class="linenos">207</span></a>            <span class="n">_queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-208"><a href="#StaticMemoryIndex.batch_search-208"><span class="linenos">208</span></a>            <span class="sa">f</span><span class="s2">&quot;query vectors must have the same dimensionality as the index; index dimensionality: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="StaticMemoryIndex.batch_search-209"><a href="#StaticMemoryIndex.batch_search-209"><span class="linenos">209</span></a>            <span class="sa">f</span><span class="s2">&quot;query dimensionality: </span><span class="si">{</span><span class="n">_queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-210"><a href="#StaticMemoryIndex.batch_search-210"><span class="linenos">210</span></a>        <span class="p">)</span>
</span><span id="StaticMemoryIndex.batch_search-211"><a href="#StaticMemoryIndex.batch_search-211"><span class="linenos">211</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.batch_search-212"><a href="#StaticMemoryIndex.batch_search-212"><span class="linenos">212</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.batch_search-213"><a href="#StaticMemoryIndex.batch_search-213"><span class="linenos">213</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="StaticMemoryIndex.batch_search-214"><a href="#StaticMemoryIndex.batch_search-214"><span class="linenos">214</span></a>
</span><span id="StaticMemoryIndex.batch_search-215"><a href="#StaticMemoryIndex.batch_search-215"><span class="linenos">215</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="StaticMemoryIndex.batch_search-216"><a href="#StaticMemoryIndex.batch_search-216"><span class="linenos">216</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.batch_search-217"><a href="#StaticMemoryIndex.batch_search-217"><span class="linenos">217</span></a>                <span class="sa">f</span><span class="s2">&quot;k_neighbors=</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2"> asked for, but list_size=</span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="StaticMemoryIndex.batch_search-218"><a href="#StaticMemoryIndex.batch_search-218"><span class="linenos">218</span></a>            <span class="p">)</span>
</span><span id="StaticMemoryIndex.batch_search-219"><a href="#StaticMemoryIndex.batch_search-219"><span class="linenos">219</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="StaticMemoryIndex.batch_search-220"><a href="#StaticMemoryIndex.batch_search-220"><span class="linenos">220</span></a>
</span><span id="StaticMemoryIndex.batch_search-221"><a href="#StaticMemoryIndex.batch_search-221"><span class="linenos">221</span></a>        <span class="n">num_queries</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">_queries</span><span class="o">.</span><span class="n">shape</span>
</span><span id="StaticMemoryIndex.batch_search-222"><a href="#StaticMemoryIndex.batch_search-222"><span class="linenos">222</span></a>        <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">batch_search</span><span class="p">(</span>
</span><span id="StaticMemoryIndex.batch_search-223"><a href="#StaticMemoryIndex.batch_search-223"><span class="linenos">223</span></a>            <span class="n">queries</span><span class="o">=</span><span class="n">_queries</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-224"><a href="#StaticMemoryIndex.batch_search-224"><span class="linenos">224</span></a>            <span class="n">num_queries</span><span class="o">=</span><span class="n">num_queries</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-225"><a href="#StaticMemoryIndex.batch_search-225"><span class="linenos">225</span></a>            <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-226"><a href="#StaticMemoryIndex.batch_search-226"><span class="linenos">226</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-227"><a href="#StaticMemoryIndex.batch_search-227"><span class="linenos">227</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="StaticMemoryIndex.batch_search-228"><a href="#StaticMemoryIndex.batch_search-228"><span class="linenos">228</span></a>        <span class="p">)</span>
</span><span id="StaticMemoryIndex.batch_search-229"><a href="#StaticMemoryIndex.batch_search-229"><span class="linenos">229</span></a>        <span class="k">return</span> <span class="n">QueryResponseBatch</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Searches the index by a batch of query vectors.</p>

<p>This search is parallelized and far more efficient than searching for each vector individually.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>queries</strong>: 2d numpy array, with column dimensionality matching the index and row dimensionality being the
number of queries intended to search for in parallel. Dtype must match dtype of the index.</li>
<li><strong>k_neighbors</strong>: Number of neighbors to be returned. If query vector exists in index, it almost definitely
will be returned as well, so adjust your <code>k_neighbors</code> as appropriate. Must be &gt; 0.</li>
<li><strong>complexity</strong>: Size of distance ordered list of candidate neighbors to use while searching. List size
increases accuracy at the cost of latency. Must be at least k_neighbors in size.</li>
<li><strong>num_threads</strong>: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</li>
</ul>
</div>


                            </div>
                </section>
                <section id="DynamicMemoryIndex">
                            <input id="DynamicMemoryIndex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DynamicMemoryIndex</span>:

                <label class="view-source-button" for="DynamicMemoryIndex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamicMemoryIndex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamicMemoryIndex-41"><a href="#DynamicMemoryIndex-41"><span class="linenos"> 41</span></a><span class="k">class</span><span class="w"> </span><span class="nc">DynamicMemoryIndex</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-42"><a href="#DynamicMemoryIndex-42"><span class="linenos"> 42</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-43"><a href="#DynamicMemoryIndex-43"><span class="linenos"> 43</span></a><span class="sd">    A DynamicMemoryIndex instance is used to both search and mutate a `diskannpy` memory index. This index is unlike</span>
</span><span id="DynamicMemoryIndex-44"><a href="#DynamicMemoryIndex-44"><span class="linenos"> 44</span></a><span class="sd">    either `diskannpy.StaticMemoryIndex` or `diskannpy.StaticDiskIndex` in the following ways:</span>
</span><span id="DynamicMemoryIndex-45"><a href="#DynamicMemoryIndex-45"><span class="linenos"> 45</span></a>
</span><span id="DynamicMemoryIndex-46"><a href="#DynamicMemoryIndex-46"><span class="linenos"> 46</span></a><span class="sd">    - It requires an explicit vector identifier for each vector added to it.</span>
</span><span id="DynamicMemoryIndex-47"><a href="#DynamicMemoryIndex-47"><span class="linenos"> 47</span></a><span class="sd">    - Insert and (lazy) deletion operations are provided for a flexible, living index</span>
</span><span id="DynamicMemoryIndex-48"><a href="#DynamicMemoryIndex-48"><span class="linenos"> 48</span></a>
</span><span id="DynamicMemoryIndex-49"><a href="#DynamicMemoryIndex-49"><span class="linenos"> 49</span></a><span class="sd">    The mutable aspect of this index will absolutely impact search time performance as new vectors are added and</span>
</span><span id="DynamicMemoryIndex-50"><a href="#DynamicMemoryIndex-50"><span class="linenos"> 50</span></a><span class="sd">    old deleted. `DynamicMemoryIndex.consolidate_deletes()` should be called periodically to restructure the index</span>
</span><span id="DynamicMemoryIndex-51"><a href="#DynamicMemoryIndex-51"><span class="linenos"> 51</span></a><span class="sd">    to remove deleted vectors and improve per-search performance, at the cost of an expensive index consolidation to</span>
</span><span id="DynamicMemoryIndex-52"><a href="#DynamicMemoryIndex-52"><span class="linenos"> 52</span></a><span class="sd">    occur.</span>
</span><span id="DynamicMemoryIndex-53"><a href="#DynamicMemoryIndex-53"><span class="linenos"> 53</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-54"><a href="#DynamicMemoryIndex-54"><span class="linenos"> 54</span></a>
</span><span id="DynamicMemoryIndex-55"><a href="#DynamicMemoryIndex-55"><span class="linenos"> 55</span></a>    <span class="nd">@classmethod</span>
</span><span id="DynamicMemoryIndex-56"><a href="#DynamicMemoryIndex-56"><span class="linenos"> 56</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_file</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-57"><a href="#DynamicMemoryIndex-57"><span class="linenos"> 57</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-58"><a href="#DynamicMemoryIndex-58"><span class="linenos"> 58</span></a>        <span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-59"><a href="#DynamicMemoryIndex-59"><span class="linenos"> 59</span></a>        <span class="n">max_vectors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-60"><a href="#DynamicMemoryIndex-60"><span class="linenos"> 60</span></a>        <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-61"><a href="#DynamicMemoryIndex-61"><span class="linenos"> 61</span></a>        <span class="n">graph_degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-62"><a href="#DynamicMemoryIndex-62"><span class="linenos"> 62</span></a>        <span class="n">saturate_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">SATURATE_GRAPH</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-63"><a href="#DynamicMemoryIndex-63"><span class="linenos"> 63</span></a>        <span class="n">max_occlusion_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">MAX_OCCLUSION_SIZE</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-64"><a href="#DynamicMemoryIndex-64"><span class="linenos"> 64</span></a>        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">ALPHA</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-65"><a href="#DynamicMemoryIndex-65"><span class="linenos"> 65</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">NUM_THREADS</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-66"><a href="#DynamicMemoryIndex-66"><span class="linenos"> 66</span></a>        <span class="n">filter_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">FILTER_COMPLEXITY</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-67"><a href="#DynamicMemoryIndex-67"><span class="linenos"> 67</span></a>        <span class="n">num_frozen_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">NUM_FROZEN_POINTS_DYNAMIC</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-68"><a href="#DynamicMemoryIndex-68"><span class="linenos"> 68</span></a>        <span class="n">initial_search_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-69"><a href="#DynamicMemoryIndex-69"><span class="linenos"> 69</span></a>        <span class="n">search_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-70"><a href="#DynamicMemoryIndex-70"><span class="linenos"> 70</span></a>        <span class="n">concurrent_consolidation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-71"><a href="#DynamicMemoryIndex-71"><span class="linenos"> 71</span></a>        <span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ann&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-72"><a href="#DynamicMemoryIndex-72"><span class="linenos"> 72</span></a>        <span class="n">distance_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DistanceMetric</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-73"><a href="#DynamicMemoryIndex-73"><span class="linenos"> 73</span></a>        <span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-74"><a href="#DynamicMemoryIndex-74"><span class="linenos"> 74</span></a>        <span class="n">dimensions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-75"><a href="#DynamicMemoryIndex-75"><span class="linenos"> 75</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DynamicMemoryIndex&quot;</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-76"><a href="#DynamicMemoryIndex-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-77"><a href="#DynamicMemoryIndex-77"><span class="linenos"> 77</span></a><span class="sd">        The `from_file` classmethod is used to load a previously saved index from disk. This index *must* have been</span>
</span><span id="DynamicMemoryIndex-78"><a href="#DynamicMemoryIndex-78"><span class="linenos"> 78</span></a><span class="sd">        created with a valid `tags` file or `tags` np.ndarray of `diskannpy.VectorIdentifier`s. It is *strongly*</span>
</span><span id="DynamicMemoryIndex-79"><a href="#DynamicMemoryIndex-79"><span class="linenos"> 79</span></a><span class="sd">        recommended that you use the same parameters as the `diskannpy.build_memory_index()` function that created</span>
</span><span id="DynamicMemoryIndex-80"><a href="#DynamicMemoryIndex-80"><span class="linenos"> 80</span></a><span class="sd">        the index.</span>
</span><span id="DynamicMemoryIndex-81"><a href="#DynamicMemoryIndex-81"><span class="linenos"> 81</span></a>
</span><span id="DynamicMemoryIndex-82"><a href="#DynamicMemoryIndex-82"><span class="linenos"> 82</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex-83"><a href="#DynamicMemoryIndex-83"><span class="linenos"> 83</span></a><span class="sd">        - **index_directory**: The directory containing the index files. This directory must contain the following</span>
</span><span id="DynamicMemoryIndex-84"><a href="#DynamicMemoryIndex-84"><span class="linenos"> 84</span></a><span class="sd">            files:</span>
</span><span id="DynamicMemoryIndex-85"><a href="#DynamicMemoryIndex-85"><span class="linenos"> 85</span></a><span class="sd">            - `{index_prefix}.data`</span>
</span><span id="DynamicMemoryIndex-86"><a href="#DynamicMemoryIndex-86"><span class="linenos"> 86</span></a><span class="sd">            - `{index_prefix}.tags`</span>
</span><span id="DynamicMemoryIndex-87"><a href="#DynamicMemoryIndex-87"><span class="linenos"> 87</span></a><span class="sd">            - `{index_prefix}`</span>
</span><span id="DynamicMemoryIndex-88"><a href="#DynamicMemoryIndex-88"><span class="linenos"> 88</span></a>
</span><span id="DynamicMemoryIndex-89"><a href="#DynamicMemoryIndex-89"><span class="linenos"> 89</span></a><span class="sd">          It may also include the following optional files:</span>
</span><span id="DynamicMemoryIndex-90"><a href="#DynamicMemoryIndex-90"><span class="linenos"> 90</span></a><span class="sd">            - `{index_prefix}_vectors.bin`: Optional. `diskannpy` builder functions may create this file in the</span>
</span><span id="DynamicMemoryIndex-91"><a href="#DynamicMemoryIndex-91"><span class="linenos"> 91</span></a><span class="sd">              `index_directory` if the index was created from a numpy array</span>
</span><span id="DynamicMemoryIndex-92"><a href="#DynamicMemoryIndex-92"><span class="linenos"> 92</span></a><span class="sd">            - `{index_prefix}_metadata.bin`: Optional. `diskannpy` builder functions create this file to store metadata</span>
</span><span id="DynamicMemoryIndex-93"><a href="#DynamicMemoryIndex-93"><span class="linenos"> 93</span></a><span class="sd">            about the index, such as vector dtype, distance metric, number of vectors and vector dimensionality.</span>
</span><span id="DynamicMemoryIndex-94"><a href="#DynamicMemoryIndex-94"><span class="linenos"> 94</span></a><span class="sd">            If an index is built from the `diskann` cli tools, this file will not exist.</span>
</span><span id="DynamicMemoryIndex-95"><a href="#DynamicMemoryIndex-95"><span class="linenos"> 95</span></a><span class="sd">        - **max_vectors**: Capacity of the memory index including space for future insertions.</span>
</span><span id="DynamicMemoryIndex-96"><a href="#DynamicMemoryIndex-96"><span class="linenos"> 96</span></a><span class="sd">        - **complexity**: Complexity (a.k.a `L`) references the size of the list we store candidate approximate</span>
</span><span id="DynamicMemoryIndex-97"><a href="#DynamicMemoryIndex-97"><span class="linenos"> 97</span></a><span class="sd">          neighbors in. It&#39;s used during save (which is an index rebuild), and it&#39;s used as an initial search size to</span>
</span><span id="DynamicMemoryIndex-98"><a href="#DynamicMemoryIndex-98"><span class="linenos"> 98</span></a><span class="sd">          warm up our index and lower the latency for initial real searches.</span>
</span><span id="DynamicMemoryIndex-99"><a href="#DynamicMemoryIndex-99"><span class="linenos"> 99</span></a><span class="sd">        - **graph_degree**: Graph degree (a.k.a. `R`) is the maximum degree allowed for a node in the index&#39;s graph</span>
</span><span id="DynamicMemoryIndex-100"><a href="#DynamicMemoryIndex-100"><span class="linenos">100</span></a><span class="sd">          structure. This degree will be pruned throughout the course of the index build, but it will never grow beyond</span>
</span><span id="DynamicMemoryIndex-101"><a href="#DynamicMemoryIndex-101"><span class="linenos">101</span></a><span class="sd">          this value. Higher R values require longer index build times, but may result in an index showing excellent</span>
</span><span id="DynamicMemoryIndex-102"><a href="#DynamicMemoryIndex-102"><span class="linenos">102</span></a><span class="sd">          recall and latency characteristics.</span>
</span><span id="DynamicMemoryIndex-103"><a href="#DynamicMemoryIndex-103"><span class="linenos">103</span></a><span class="sd">        - **saturate_graph**: If True, the adjacency list of each node will be saturated with neighbors to have exactly</span>
</span><span id="DynamicMemoryIndex-104"><a href="#DynamicMemoryIndex-104"><span class="linenos">104</span></a><span class="sd">          `graph_degree` neighbors. If False, each node will have between 1 and `graph_degree` neighbors.</span>
</span><span id="DynamicMemoryIndex-105"><a href="#DynamicMemoryIndex-105"><span class="linenos">105</span></a><span class="sd">        - **max_occlusion_size**: The maximum number of points that can be considered by occlude_list function.</span>
</span><span id="DynamicMemoryIndex-106"><a href="#DynamicMemoryIndex-106"><span class="linenos">106</span></a><span class="sd">        - **alpha**: The alpha parameter (&gt;=1) is used to control the nature and number of points that are added to the</span>
</span><span id="DynamicMemoryIndex-107"><a href="#DynamicMemoryIndex-107"><span class="linenos">107</span></a><span class="sd">          graph. A higher alpha value (e.g., 1.4) will result in fewer hops (and IOs) to convergence, but probably</span>
</span><span id="DynamicMemoryIndex-108"><a href="#DynamicMemoryIndex-108"><span class="linenos">108</span></a><span class="sd">          more distance comparisons compared to a lower alpha value.</span>
</span><span id="DynamicMemoryIndex-109"><a href="#DynamicMemoryIndex-109"><span class="linenos">109</span></a><span class="sd">        - **num_threads**: Number of threads to use when creating this index. `0` indicates we should use all available</span>
</span><span id="DynamicMemoryIndex-110"><a href="#DynamicMemoryIndex-110"><span class="linenos">110</span></a><span class="sd">          logical processors.</span>
</span><span id="DynamicMemoryIndex-111"><a href="#DynamicMemoryIndex-111"><span class="linenos">111</span></a><span class="sd">        - **filter_complexity**: Complexity to use when using filters. Default is 0.</span>
</span><span id="DynamicMemoryIndex-112"><a href="#DynamicMemoryIndex-112"><span class="linenos">112</span></a><span class="sd">        - **num_frozen_points**: Number of points to freeze. Default is 1.</span>
</span><span id="DynamicMemoryIndex-113"><a href="#DynamicMemoryIndex-113"><span class="linenos">113</span></a><span class="sd">        - **initial_search_complexity**: Should be set to the most common `complexity` expected to be used during the</span>
</span><span id="DynamicMemoryIndex-114"><a href="#DynamicMemoryIndex-114"><span class="linenos">114</span></a><span class="sd">          life of this `diskannpy.DynamicMemoryIndex` object. The working scratch memory allocated is based off of</span>
</span><span id="DynamicMemoryIndex-115"><a href="#DynamicMemoryIndex-115"><span class="linenos">115</span></a><span class="sd">          `initial_search_complexity` * `search_threads`. Note that it may be resized if a `search` or `batch_search`</span>
</span><span id="DynamicMemoryIndex-116"><a href="#DynamicMemoryIndex-116"><span class="linenos">116</span></a><span class="sd">          operation requests a space larger than can be accommodated by these values.</span>
</span><span id="DynamicMemoryIndex-117"><a href="#DynamicMemoryIndex-117"><span class="linenos">117</span></a><span class="sd">        - **search_threads**: Should be set to the most common `num_threads` expected to be used during the</span>
</span><span id="DynamicMemoryIndex-118"><a href="#DynamicMemoryIndex-118"><span class="linenos">118</span></a><span class="sd">          life of this `diskannpy.DynamicMemoryIndex` object. The working scratch memory allocated is based off of</span>
</span><span id="DynamicMemoryIndex-119"><a href="#DynamicMemoryIndex-119"><span class="linenos">119</span></a><span class="sd">          `initial_search_complexity` * `search_threads`. Note that it may be resized if a `batch_search`</span>
</span><span id="DynamicMemoryIndex-120"><a href="#DynamicMemoryIndex-120"><span class="linenos">120</span></a><span class="sd">          operation requests a space larger than can be accommodated by these values.</span>
</span><span id="DynamicMemoryIndex-121"><a href="#DynamicMemoryIndex-121"><span class="linenos">121</span></a><span class="sd">        - **concurrent_consolidation**: This flag dictates whether consolidation can be run alongside inserts and</span>
</span><span id="DynamicMemoryIndex-122"><a href="#DynamicMemoryIndex-122"><span class="linenos">122</span></a><span class="sd">          deletes, or whether the index is locked down to changes while consolidation is ongoing.</span>
</span><span id="DynamicMemoryIndex-123"><a href="#DynamicMemoryIndex-123"><span class="linenos">123</span></a><span class="sd">        - **index_prefix**: The prefix of the index files. Defaults to &quot;ann&quot;.</span>
</span><span id="DynamicMemoryIndex-124"><a href="#DynamicMemoryIndex-124"><span class="linenos">124</span></a><span class="sd">        - **distance_metric**: A `str`, strictly one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;}. `l2` and `cosine` are supported for all 3</span>
</span><span id="DynamicMemoryIndex-125"><a href="#DynamicMemoryIndex-125"><span class="linenos">125</span></a><span class="sd">          vector dtypes, but `mips` is only available for single precision floats. Default is `None`. **This</span>
</span><span id="DynamicMemoryIndex-126"><a href="#DynamicMemoryIndex-126"><span class="linenos">126</span></a><span class="sd">          value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it does not exist,</span>
</span><span id="DynamicMemoryIndex-127"><a href="#DynamicMemoryIndex-127"><span class="linenos">127</span></a><span class="sd">          you are required to provide it.</span>
</span><span id="DynamicMemoryIndex-128"><a href="#DynamicMemoryIndex-128"><span class="linenos">128</span></a><span class="sd">        - **vector_dtype**: The vector dtype this index has been built with. **This value is only used if a</span>
</span><span id="DynamicMemoryIndex-129"><a href="#DynamicMemoryIndex-129"><span class="linenos">129</span></a><span class="sd">          `{index_prefix}_metadata.bin` file does not exist.** If it does not exist, you are required to provide it.</span>
</span><span id="DynamicMemoryIndex-130"><a href="#DynamicMemoryIndex-130"><span class="linenos">130</span></a><span class="sd">        - **dimensions**: The vector dimensionality of this index. All new vectors inserted must be the same</span>
</span><span id="DynamicMemoryIndex-131"><a href="#DynamicMemoryIndex-131"><span class="linenos">131</span></a><span class="sd">          dimensionality. **This value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it</span>
</span><span id="DynamicMemoryIndex-132"><a href="#DynamicMemoryIndex-132"><span class="linenos">132</span></a><span class="sd">          does not exist, you are required to provide it.</span>
</span><span id="DynamicMemoryIndex-133"><a href="#DynamicMemoryIndex-133"><span class="linenos">133</span></a>
</span><span id="DynamicMemoryIndex-134"><a href="#DynamicMemoryIndex-134"><span class="linenos">134</span></a><span class="sd">        ### Returns</span>
</span><span id="DynamicMemoryIndex-135"><a href="#DynamicMemoryIndex-135"><span class="linenos">135</span></a><span class="sd">        A `diskannpy.DynamicMemoryIndex` object, with the index loaded from disk and ready to use for insertions,</span>
</span><span id="DynamicMemoryIndex-136"><a href="#DynamicMemoryIndex-136"><span class="linenos">136</span></a><span class="sd">        deletions, and searches.</span>
</span><span id="DynamicMemoryIndex-137"><a href="#DynamicMemoryIndex-137"><span class="linenos">137</span></a>
</span><span id="DynamicMemoryIndex-138"><a href="#DynamicMemoryIndex-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-139"><a href="#DynamicMemoryIndex-139"><span class="linenos">139</span></a>        <span class="n">index_prefix_path</span> <span class="o">=</span> <span class="n">_valid_index_prefix</span><span class="p">(</span><span class="n">index_directory</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-140"><a href="#DynamicMemoryIndex-140"><span class="linenos">140</span></a>
</span><span id="DynamicMemoryIndex-141"><a href="#DynamicMemoryIndex-141"><span class="linenos">141</span></a>        <span class="c1"># do tags exist?</span>
</span><span id="DynamicMemoryIndex-142"><a href="#DynamicMemoryIndex-142"><span class="linenos">142</span></a>        <span class="n">tags_file</span> <span class="o">=</span> <span class="n">index_prefix_path</span> <span class="o">+</span> <span class="s2">&quot;.tags&quot;</span>
</span><span id="DynamicMemoryIndex-143"><a href="#DynamicMemoryIndex-143"><span class="linenos">143</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-144"><a href="#DynamicMemoryIndex-144"><span class="linenos">144</span></a>            <span class="n">Path</span><span class="p">(</span><span class="n">tags_file</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span>
</span><span id="DynamicMemoryIndex-145"><a href="#DynamicMemoryIndex-145"><span class="linenos">145</span></a>            <span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">tags_file</span><span class="si">}</span><span class="s2"> does not exist in </span><span class="si">{</span><span class="n">index_directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-146"><a href="#DynamicMemoryIndex-146"><span class="linenos">146</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-147"><a href="#DynamicMemoryIndex-147"><span class="linenos">147</span></a>        <span class="n">vector_dtype</span><span class="p">,</span> <span class="n">dap_metric</span><span class="p">,</span> <span class="n">num_vectors</span><span class="p">,</span> <span class="n">dimensions</span> <span class="o">=</span> <span class="n">_ensure_index_metadata</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-148"><a href="#DynamicMemoryIndex-148"><span class="linenos">148</span></a>            <span class="n">index_prefix_path</span><span class="p">,</span> <span class="n">vector_dtype</span><span class="p">,</span> <span class="n">distance_metric</span><span class="p">,</span> <span class="n">max_vectors</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">warn_size_exceeded</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamicMemoryIndex-149"><a href="#DynamicMemoryIndex-149"><span class="linenos">149</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-150"><a href="#DynamicMemoryIndex-150"><span class="linenos">150</span></a>
</span><span id="DynamicMemoryIndex-151"><a href="#DynamicMemoryIndex-151"><span class="linenos">151</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-152"><a href="#DynamicMemoryIndex-152"><span class="linenos">152</span></a>            <span class="n">distance_metric</span><span class="o">=</span><span class="n">dap_metric</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
</span><span id="DynamicMemoryIndex-153"><a href="#DynamicMemoryIndex-153"><span class="linenos">153</span></a>            <span class="n">vector_dtype</span><span class="o">=</span><span class="n">vector_dtype</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-154"><a href="#DynamicMemoryIndex-154"><span class="linenos">154</span></a>            <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-155"><a href="#DynamicMemoryIndex-155"><span class="linenos">155</span></a>            <span class="n">max_vectors</span><span class="o">=</span><span class="n">max_vectors</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-156"><a href="#DynamicMemoryIndex-156"><span class="linenos">156</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-157"><a href="#DynamicMemoryIndex-157"><span class="linenos">157</span></a>            <span class="n">graph_degree</span><span class="o">=</span><span class="n">graph_degree</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-158"><a href="#DynamicMemoryIndex-158"><span class="linenos">158</span></a>            <span class="n">saturate_graph</span><span class="o">=</span><span class="n">saturate_graph</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-159"><a href="#DynamicMemoryIndex-159"><span class="linenos">159</span></a>            <span class="n">max_occlusion_size</span><span class="o">=</span><span class="n">max_occlusion_size</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-160"><a href="#DynamicMemoryIndex-160"><span class="linenos">160</span></a>            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-161"><a href="#DynamicMemoryIndex-161"><span class="linenos">161</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-162"><a href="#DynamicMemoryIndex-162"><span class="linenos">162</span></a>            <span class="n">filter_complexity</span><span class="o">=</span><span class="n">filter_complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-163"><a href="#DynamicMemoryIndex-163"><span class="linenos">163</span></a>            <span class="n">num_frozen_points</span><span class="o">=</span><span class="n">num_frozen_points</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-164"><a href="#DynamicMemoryIndex-164"><span class="linenos">164</span></a>            <span class="n">initial_search_complexity</span><span class="o">=</span><span class="n">initial_search_complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-165"><a href="#DynamicMemoryIndex-165"><span class="linenos">165</span></a>            <span class="n">search_threads</span><span class="o">=</span><span class="n">search_threads</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-166"><a href="#DynamicMemoryIndex-166"><span class="linenos">166</span></a>            <span class="n">concurrent_consolidation</span><span class="o">=</span><span class="n">concurrent_consolidation</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-167"><a href="#DynamicMemoryIndex-167"><span class="linenos">167</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-168"><a href="#DynamicMemoryIndex-168"><span class="linenos">168</span></a>        <span class="n">index</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">index_prefix_path</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-169"><a href="#DynamicMemoryIndex-169"><span class="linenos">169</span></a>        <span class="n">index</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">=</span> <span class="n">num_vectors</span>  <span class="c1"># current number of vectors loaded</span>
</span><span id="DynamicMemoryIndex-170"><a href="#DynamicMemoryIndex-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="n">index</span>
</span><span id="DynamicMemoryIndex-171"><a href="#DynamicMemoryIndex-171"><span class="linenos">171</span></a>
</span><span id="DynamicMemoryIndex-172"><a href="#DynamicMemoryIndex-172"><span class="linenos">172</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-173"><a href="#DynamicMemoryIndex-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-174"><a href="#DynamicMemoryIndex-174"><span class="linenos">174</span></a>        <span class="n">distance_metric</span><span class="p">:</span> <span class="n">DistanceMetric</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-175"><a href="#DynamicMemoryIndex-175"><span class="linenos">175</span></a>        <span class="n">vector_dtype</span><span class="p">:</span> <span class="n">VectorDType</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-176"><a href="#DynamicMemoryIndex-176"><span class="linenos">176</span></a>        <span class="n">dimensions</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-177"><a href="#DynamicMemoryIndex-177"><span class="linenos">177</span></a>        <span class="n">max_vectors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-178"><a href="#DynamicMemoryIndex-178"><span class="linenos">178</span></a>        <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-179"><a href="#DynamicMemoryIndex-179"><span class="linenos">179</span></a>        <span class="n">graph_degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-180"><a href="#DynamicMemoryIndex-180"><span class="linenos">180</span></a>        <span class="n">saturate_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">SATURATE_GRAPH</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-181"><a href="#DynamicMemoryIndex-181"><span class="linenos">181</span></a>        <span class="n">max_occlusion_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">MAX_OCCLUSION_SIZE</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-182"><a href="#DynamicMemoryIndex-182"><span class="linenos">182</span></a>        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">ALPHA</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-183"><a href="#DynamicMemoryIndex-183"><span class="linenos">183</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">NUM_THREADS</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-184"><a href="#DynamicMemoryIndex-184"><span class="linenos">184</span></a>        <span class="n">filter_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">FILTER_COMPLEXITY</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-185"><a href="#DynamicMemoryIndex-185"><span class="linenos">185</span></a>        <span class="n">num_frozen_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">NUM_FROZEN_POINTS_DYNAMIC</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-186"><a href="#DynamicMemoryIndex-186"><span class="linenos">186</span></a>        <span class="n">initial_search_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-187"><a href="#DynamicMemoryIndex-187"><span class="linenos">187</span></a>        <span class="n">search_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-188"><a href="#DynamicMemoryIndex-188"><span class="linenos">188</span></a>        <span class="n">concurrent_consolidation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-189"><a href="#DynamicMemoryIndex-189"><span class="linenos">189</span></a>    <span class="p">):</span>
</span><span id="DynamicMemoryIndex-190"><a href="#DynamicMemoryIndex-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-191"><a href="#DynamicMemoryIndex-191"><span class="linenos">191</span></a><span class="sd">        The `diskannpy.DynamicMemoryIndex` represents our python API into a mutable DiskANN memory index.</span>
</span><span id="DynamicMemoryIndex-192"><a href="#DynamicMemoryIndex-192"><span class="linenos">192</span></a>
</span><span id="DynamicMemoryIndex-193"><a href="#DynamicMemoryIndex-193"><span class="linenos">193</span></a><span class="sd">        This constructor is used to create a new, empty index. If you wish to load a previously saved index from disk,</span>
</span><span id="DynamicMemoryIndex-194"><a href="#DynamicMemoryIndex-194"><span class="linenos">194</span></a><span class="sd">        please use the `diskannpy.DynamicMemoryIndex.from_file` classmethod instead.</span>
</span><span id="DynamicMemoryIndex-195"><a href="#DynamicMemoryIndex-195"><span class="linenos">195</span></a>
</span><span id="DynamicMemoryIndex-196"><a href="#DynamicMemoryIndex-196"><span class="linenos">196</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex-197"><a href="#DynamicMemoryIndex-197"><span class="linenos">197</span></a><span class="sd">        - **distance_metric**: A `str`, strictly one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;}. `l2` and `cosine` are supported for all 3</span>
</span><span id="DynamicMemoryIndex-198"><a href="#DynamicMemoryIndex-198"><span class="linenos">198</span></a><span class="sd">          vector dtypes, but `mips` is only available for single precision floats.</span>
</span><span id="DynamicMemoryIndex-199"><a href="#DynamicMemoryIndex-199"><span class="linenos">199</span></a><span class="sd">        - **vector_dtype**: One of {`np.float32`, `np.int8`, `np.uint8`}. The dtype of the vectors this index will</span>
</span><span id="DynamicMemoryIndex-200"><a href="#DynamicMemoryIndex-200"><span class="linenos">200</span></a><span class="sd">          be storing.</span>
</span><span id="DynamicMemoryIndex-201"><a href="#DynamicMemoryIndex-201"><span class="linenos">201</span></a><span class="sd">        - **dimensions**: The vector dimensionality of this index. All new vectors inserted must be the same</span>
</span><span id="DynamicMemoryIndex-202"><a href="#DynamicMemoryIndex-202"><span class="linenos">202</span></a><span class="sd">          dimensionality.</span>
</span><span id="DynamicMemoryIndex-203"><a href="#DynamicMemoryIndex-203"><span class="linenos">203</span></a><span class="sd">        - **max_vectors**: Capacity of the data store including space for future insertions</span>
</span><span id="DynamicMemoryIndex-204"><a href="#DynamicMemoryIndex-204"><span class="linenos">204</span></a><span class="sd">        - **graph_degree**: Graph degree (a.k.a. `R`) is the maximum degree allowed for a node in the index&#39;s graph</span>
</span><span id="DynamicMemoryIndex-205"><a href="#DynamicMemoryIndex-205"><span class="linenos">205</span></a><span class="sd">          structure. This degree will be pruned throughout the course of the index build, but it will never grow beyond</span>
</span><span id="DynamicMemoryIndex-206"><a href="#DynamicMemoryIndex-206"><span class="linenos">206</span></a><span class="sd">          this value. Higher `graph_degree` values require longer index build times, but may result in an index showing</span>
</span><span id="DynamicMemoryIndex-207"><a href="#DynamicMemoryIndex-207"><span class="linenos">207</span></a><span class="sd">          excellent recall and latency characteristics.</span>
</span><span id="DynamicMemoryIndex-208"><a href="#DynamicMemoryIndex-208"><span class="linenos">208</span></a><span class="sd">        - **saturate_graph**: If True, the adjacency list of each node will be saturated with neighbors to have exactly</span>
</span><span id="DynamicMemoryIndex-209"><a href="#DynamicMemoryIndex-209"><span class="linenos">209</span></a><span class="sd">          `graph_degree` neighbors. If False, each node will have between 1 and `graph_degree` neighbors.</span>
</span><span id="DynamicMemoryIndex-210"><a href="#DynamicMemoryIndex-210"><span class="linenos">210</span></a><span class="sd">        - **max_occlusion_size**: The maximum number of points that can be considered by occlude_list function.</span>
</span><span id="DynamicMemoryIndex-211"><a href="#DynamicMemoryIndex-211"><span class="linenos">211</span></a><span class="sd">        - **alpha**: The alpha parameter (&gt;=1) is used to control the nature and number of points that are added to the</span>
</span><span id="DynamicMemoryIndex-212"><a href="#DynamicMemoryIndex-212"><span class="linenos">212</span></a><span class="sd">          graph. A higher alpha value (e.g., 1.4) will result in fewer hops (and IOs) to convergence, but probably</span>
</span><span id="DynamicMemoryIndex-213"><a href="#DynamicMemoryIndex-213"><span class="linenos">213</span></a><span class="sd">          more distance comparisons compared to a lower alpha value.</span>
</span><span id="DynamicMemoryIndex-214"><a href="#DynamicMemoryIndex-214"><span class="linenos">214</span></a><span class="sd">        - **num_threads**: Number of threads to use when creating this index. `0` indicates we should use all available</span>
</span><span id="DynamicMemoryIndex-215"><a href="#DynamicMemoryIndex-215"><span class="linenos">215</span></a><span class="sd">          logical processors.</span>
</span><span id="DynamicMemoryIndex-216"><a href="#DynamicMemoryIndex-216"><span class="linenos">216</span></a><span class="sd">        - **filter_complexity**: Complexity to use when using filters. Default is 0.</span>
</span><span id="DynamicMemoryIndex-217"><a href="#DynamicMemoryIndex-217"><span class="linenos">217</span></a><span class="sd">        - **num_frozen_points**: Number of points to freeze. Default is 1.</span>
</span><span id="DynamicMemoryIndex-218"><a href="#DynamicMemoryIndex-218"><span class="linenos">218</span></a><span class="sd">        - **initial_search_complexity**: Should be set to the most common `complexity` expected to be used during the</span>
</span><span id="DynamicMemoryIndex-219"><a href="#DynamicMemoryIndex-219"><span class="linenos">219</span></a><span class="sd">          life of this `diskannpy.DynamicMemoryIndex` object. The working scratch memory allocated is based off of</span>
</span><span id="DynamicMemoryIndex-220"><a href="#DynamicMemoryIndex-220"><span class="linenos">220</span></a><span class="sd">          `initial_search_complexity` * `search_threads`. Note that it may be resized if a `search` or `batch_search`</span>
</span><span id="DynamicMemoryIndex-221"><a href="#DynamicMemoryIndex-221"><span class="linenos">221</span></a><span class="sd">          operation requests a space larger than can be accommodated by these values.</span>
</span><span id="DynamicMemoryIndex-222"><a href="#DynamicMemoryIndex-222"><span class="linenos">222</span></a><span class="sd">        - **search_threads**: Should be set to the most common `num_threads` expected to be used during the</span>
</span><span id="DynamicMemoryIndex-223"><a href="#DynamicMemoryIndex-223"><span class="linenos">223</span></a><span class="sd">          life of this `diskannpy.DynamicMemoryIndex` object. The working scratch memory allocated is based off of</span>
</span><span id="DynamicMemoryIndex-224"><a href="#DynamicMemoryIndex-224"><span class="linenos">224</span></a><span class="sd">          `initial_search_complexity` * `search_threads`. Note that it may be resized if a `batch_search`</span>
</span><span id="DynamicMemoryIndex-225"><a href="#DynamicMemoryIndex-225"><span class="linenos">225</span></a><span class="sd">          operation requests a space larger than can be accommodated by these values.</span>
</span><span id="DynamicMemoryIndex-226"><a href="#DynamicMemoryIndex-226"><span class="linenos">226</span></a><span class="sd">        - **concurrent_consolidation**: This flag dictates whether consolidation can be run alongside inserts and</span>
</span><span id="DynamicMemoryIndex-227"><a href="#DynamicMemoryIndex-227"><span class="linenos">227</span></a><span class="sd">          deletes, or whether the index is locked down to changes while consolidation is ongoing.</span>
</span><span id="DynamicMemoryIndex-228"><a href="#DynamicMemoryIndex-228"><span class="linenos">228</span></a>
</span><span id="DynamicMemoryIndex-229"><a href="#DynamicMemoryIndex-229"><span class="linenos">229</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-230"><a href="#DynamicMemoryIndex-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DynamicMemoryIndex-231"><a href="#DynamicMemoryIndex-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DynamicMemoryIndex-232"><a href="#DynamicMemoryIndex-232"><span class="linenos">232</span></a>        <span class="n">dap_metric</span> <span class="o">=</span> <span class="n">_valid_metric</span><span class="p">(</span><span class="n">distance_metric</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-233"><a href="#DynamicMemoryIndex-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dap_metric</span> <span class="o">=</span> <span class="n">dap_metric</span>
</span><span id="DynamicMemoryIndex-234"><a href="#DynamicMemoryIndex-234"><span class="linenos">234</span></a>        <span class="n">_assert_dtype</span><span class="p">(</span><span class="n">vector_dtype</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-235"><a href="#DynamicMemoryIndex-235"><span class="linenos">235</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-236"><a href="#DynamicMemoryIndex-236"><span class="linenos">236</span></a>
</span><span id="DynamicMemoryIndex-237"><a href="#DynamicMemoryIndex-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span> <span class="o">=</span> <span class="n">vector_dtype</span>
</span><span id="DynamicMemoryIndex-238"><a href="#DynamicMemoryIndex-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="n">dimensions</span>
</span><span id="DynamicMemoryIndex-239"><a href="#DynamicMemoryIndex-239"><span class="linenos">239</span></a>
</span><span id="DynamicMemoryIndex-240"><a href="#DynamicMemoryIndex-240"><span class="linenos">240</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">max_vectors</span><span class="p">,</span> <span class="s2">&quot;max_vectors&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-241"><a href="#DynamicMemoryIndex-241"><span class="linenos">241</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-242"><a href="#DynamicMemoryIndex-242"><span class="linenos">242</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">graph_degree</span><span class="p">,</span> <span class="s2">&quot;graph_degree&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-243"><a href="#DynamicMemoryIndex-243"><span class="linenos">243</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-244"><a href="#DynamicMemoryIndex-244"><span class="linenos">244</span></a>            <span class="n">alpha</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-245"><a href="#DynamicMemoryIndex-245"><span class="linenos">245</span></a>            <span class="s2">&quot;alpha must be &gt;= 1, and realistically should be kept between [1.0, 2.0)&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-246"><a href="#DynamicMemoryIndex-246"><span class="linenos">246</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-247"><a href="#DynamicMemoryIndex-247"><span class="linenos">247</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">max_occlusion_size</span><span class="p">,</span> <span class="s2">&quot;max_occlusion_size&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-248"><a href="#DynamicMemoryIndex-248"><span class="linenos">248</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-249"><a href="#DynamicMemoryIndex-249"><span class="linenos">249</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">filter_complexity</span><span class="p">,</span> <span class="s2">&quot;filter_complexity&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-250"><a href="#DynamicMemoryIndex-250"><span class="linenos">250</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_frozen_points</span><span class="p">,</span> <span class="s2">&quot;num_frozen_points&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-251"><a href="#DynamicMemoryIndex-251"><span class="linenos">251</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-252"><a href="#DynamicMemoryIndex-252"><span class="linenos">252</span></a>            <span class="n">initial_search_complexity</span><span class="p">,</span> <span class="s2">&quot;initial_search_complexity&quot;</span>
</span><span id="DynamicMemoryIndex-253"><a href="#DynamicMemoryIndex-253"><span class="linenos">253</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-254"><a href="#DynamicMemoryIndex-254"><span class="linenos">254</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">search_threads</span><span class="p">,</span> <span class="s2">&quot;search_threads&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-255"><a href="#DynamicMemoryIndex-255"><span class="linenos">255</span></a>
</span><span id="DynamicMemoryIndex-256"><a href="#DynamicMemoryIndex-256"><span class="linenos">256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span> <span class="o">=</span> <span class="n">max_vectors</span>
</span><span id="DynamicMemoryIndex-257"><a href="#DynamicMemoryIndex-257"><span class="linenos">257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_complexity</span> <span class="o">=</span> <span class="n">complexity</span>
</span><span id="DynamicMemoryIndex-258"><a href="#DynamicMemoryIndex-258"><span class="linenos">258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_degree</span> <span class="o">=</span> <span class="n">graph_degree</span>
</span><span id="DynamicMemoryIndex-259"><a href="#DynamicMemoryIndex-259"><span class="linenos">259</span></a>
</span><span id="DynamicMemoryIndex-260"><a href="#DynamicMemoryIndex-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-261"><a href="#DynamicMemoryIndex-261"><span class="linenos">261</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">DynamicMemoryUInt8Index</span>
</span><span id="DynamicMemoryIndex-262"><a href="#DynamicMemoryIndex-262"><span class="linenos">262</span></a>        <span class="k">elif</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-263"><a href="#DynamicMemoryIndex-263"><span class="linenos">263</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">DynamicMemoryInt8Index</span>
</span><span id="DynamicMemoryIndex-264"><a href="#DynamicMemoryIndex-264"><span class="linenos">264</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-265"><a href="#DynamicMemoryIndex-265"><span class="linenos">265</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">DynamicMemoryFloatIndex</span>
</span><span id="DynamicMemoryIndex-266"><a href="#DynamicMemoryIndex-266"><span class="linenos">266</span></a>
</span><span id="DynamicMemoryIndex-267"><a href="#DynamicMemoryIndex-267"><span class="linenos">267</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">_index</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-268"><a href="#DynamicMemoryIndex-268"><span class="linenos">268</span></a>            <span class="n">distance_metric</span><span class="o">=</span><span class="n">dap_metric</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-269"><a href="#DynamicMemoryIndex-269"><span class="linenos">269</span></a>            <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-270"><a href="#DynamicMemoryIndex-270"><span class="linenos">270</span></a>            <span class="n">max_vectors</span><span class="o">=</span><span class="n">max_vectors</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-271"><a href="#DynamicMemoryIndex-271"><span class="linenos">271</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-272"><a href="#DynamicMemoryIndex-272"><span class="linenos">272</span></a>            <span class="n">graph_degree</span><span class="o">=</span><span class="n">graph_degree</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-273"><a href="#DynamicMemoryIndex-273"><span class="linenos">273</span></a>            <span class="n">saturate_graph</span><span class="o">=</span><span class="n">saturate_graph</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-274"><a href="#DynamicMemoryIndex-274"><span class="linenos">274</span></a>            <span class="n">max_occlusion_size</span><span class="o">=</span><span class="n">max_occlusion_size</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-275"><a href="#DynamicMemoryIndex-275"><span class="linenos">275</span></a>            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-276"><a href="#DynamicMemoryIndex-276"><span class="linenos">276</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-277"><a href="#DynamicMemoryIndex-277"><span class="linenos">277</span></a>            <span class="n">filter_complexity</span><span class="o">=</span><span class="n">filter_complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-278"><a href="#DynamicMemoryIndex-278"><span class="linenos">278</span></a>            <span class="n">num_frozen_points</span><span class="o">=</span><span class="n">num_frozen_points</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-279"><a href="#DynamicMemoryIndex-279"><span class="linenos">279</span></a>            <span class="n">initial_search_complexity</span><span class="o">=</span><span class="n">initial_search_complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-280"><a href="#DynamicMemoryIndex-280"><span class="linenos">280</span></a>            <span class="n">search_threads</span><span class="o">=</span><span class="n">search_threads</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-281"><a href="#DynamicMemoryIndex-281"><span class="linenos">281</span></a>            <span class="n">concurrent_consolidation</span><span class="o">=</span><span class="n">concurrent_consolidation</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-282"><a href="#DynamicMemoryIndex-282"><span class="linenos">282</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-283"><a href="#DynamicMemoryIndex-283"><span class="linenos">283</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_points_deleted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamicMemoryIndex-284"><a href="#DynamicMemoryIndex-284"><span class="linenos">284</span></a>
</span><span id="DynamicMemoryIndex-285"><a href="#DynamicMemoryIndex-285"><span class="linenos">285</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-286"><a href="#DynamicMemoryIndex-286"><span class="linenos">286</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">VectorLike</span><span class="p">,</span> <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="DynamicMemoryIndex-287"><a href="#DynamicMemoryIndex-287"><span class="linenos">287</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponse</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-288"><a href="#DynamicMemoryIndex-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-289"><a href="#DynamicMemoryIndex-289"><span class="linenos">289</span></a><span class="sd">        Searches the index by a single query vector.</span>
</span><span id="DynamicMemoryIndex-290"><a href="#DynamicMemoryIndex-290"><span class="linenos">290</span></a>
</span><span id="DynamicMemoryIndex-291"><a href="#DynamicMemoryIndex-291"><span class="linenos">291</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex-292"><a href="#DynamicMemoryIndex-292"><span class="linenos">292</span></a><span class="sd">        - **query**: 1d numpy array of the same dimensionality and dtype of the index.</span>
</span><span id="DynamicMemoryIndex-293"><a href="#DynamicMemoryIndex-293"><span class="linenos">293</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="DynamicMemoryIndex-294"><a href="#DynamicMemoryIndex-294"><span class="linenos">294</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="DynamicMemoryIndex-295"><a href="#DynamicMemoryIndex-295"><span class="linenos">295</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="DynamicMemoryIndex-296"><a href="#DynamicMemoryIndex-296"><span class="linenos">296</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="DynamicMemoryIndex-297"><a href="#DynamicMemoryIndex-297"><span class="linenos">297</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-298"><a href="#DynamicMemoryIndex-298"><span class="linenos">298</span></a>        <span class="n">_query</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-299"><a href="#DynamicMemoryIndex-299"><span class="linenos">299</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;query vector must be 1-d&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-300"><a href="#DynamicMemoryIndex-300"><span class="linenos">300</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-301"><a href="#DynamicMemoryIndex-301"><span class="linenos">301</span></a>            <span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-302"><a href="#DynamicMemoryIndex-302"><span class="linenos">302</span></a>            <span class="sa">f</span><span class="s2">&quot;query vector must have the same dimensionality as the index; index dimensionality: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="DynamicMemoryIndex-303"><a href="#DynamicMemoryIndex-303"><span class="linenos">303</span></a>            <span class="sa">f</span><span class="s2">&quot;query dimensionality: </span><span class="si">{</span><span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-304"><a href="#DynamicMemoryIndex-304"><span class="linenos">304</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-305"><a href="#DynamicMemoryIndex-305"><span class="linenos">305</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-306"><a href="#DynamicMemoryIndex-306"><span class="linenos">306</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-307"><a href="#DynamicMemoryIndex-307"><span class="linenos">307</span></a>
</span><span id="DynamicMemoryIndex-308"><a href="#DynamicMemoryIndex-308"><span class="linenos">308</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-309"><a href="#DynamicMemoryIndex-309"><span class="linenos">309</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-310"><a href="#DynamicMemoryIndex-310"><span class="linenos">310</span></a>                <span class="sa">f</span><span class="s2">&quot;k_neighbors=</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2"> asked for, but list_size=</span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DynamicMemoryIndex-311"><a href="#DynamicMemoryIndex-311"><span class="linenos">311</span></a>            <span class="p">)</span>
</span><span id="DynamicMemoryIndex-312"><a href="#DynamicMemoryIndex-312"><span class="linenos">312</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="DynamicMemoryIndex-313"><a href="#DynamicMemoryIndex-313"><span class="linenos">313</span></a>        <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">_query</span><span class="p">,</span> <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-314"><a href="#DynamicMemoryIndex-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="n">QueryResponse</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-315"><a href="#DynamicMemoryIndex-315"><span class="linenos">315</span></a>
</span><span id="DynamicMemoryIndex-316"><a href="#DynamicMemoryIndex-316"><span class="linenos">316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_search</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-317"><a href="#DynamicMemoryIndex-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-318"><a href="#DynamicMemoryIndex-318"><span class="linenos">318</span></a>        <span class="n">queries</span><span class="p">:</span> <span class="n">VectorLikeBatch</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-319"><a href="#DynamicMemoryIndex-319"><span class="linenos">319</span></a>        <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-320"><a href="#DynamicMemoryIndex-320"><span class="linenos">320</span></a>        <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-321"><a href="#DynamicMemoryIndex-321"><span class="linenos">321</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-322"><a href="#DynamicMemoryIndex-322"><span class="linenos">322</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponseBatch</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-323"><a href="#DynamicMemoryIndex-323"><span class="linenos">323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-324"><a href="#DynamicMemoryIndex-324"><span class="linenos">324</span></a><span class="sd">        Searches the index by a batch of query vectors.</span>
</span><span id="DynamicMemoryIndex-325"><a href="#DynamicMemoryIndex-325"><span class="linenos">325</span></a>
</span><span id="DynamicMemoryIndex-326"><a href="#DynamicMemoryIndex-326"><span class="linenos">326</span></a><span class="sd">        This search is parallelized and far more efficient than searching for each vector individually.</span>
</span><span id="DynamicMemoryIndex-327"><a href="#DynamicMemoryIndex-327"><span class="linenos">327</span></a>
</span><span id="DynamicMemoryIndex-328"><a href="#DynamicMemoryIndex-328"><span class="linenos">328</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex-329"><a href="#DynamicMemoryIndex-329"><span class="linenos">329</span></a><span class="sd">        - **queries**: 2d numpy array, with column dimensionality matching the index and row dimensionality being the</span>
</span><span id="DynamicMemoryIndex-330"><a href="#DynamicMemoryIndex-330"><span class="linenos">330</span></a><span class="sd">          number of queries intended to search for in parallel. Dtype must match dtype of the index.</span>
</span><span id="DynamicMemoryIndex-331"><a href="#DynamicMemoryIndex-331"><span class="linenos">331</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="DynamicMemoryIndex-332"><a href="#DynamicMemoryIndex-332"><span class="linenos">332</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="DynamicMemoryIndex-333"><a href="#DynamicMemoryIndex-333"><span class="linenos">333</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="DynamicMemoryIndex-334"><a href="#DynamicMemoryIndex-334"><span class="linenos">334</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="DynamicMemoryIndex-335"><a href="#DynamicMemoryIndex-335"><span class="linenos">335</span></a><span class="sd">        - **num_threads**: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="DynamicMemoryIndex-336"><a href="#DynamicMemoryIndex-336"><span class="linenos">336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-337"><a href="#DynamicMemoryIndex-337"><span class="linenos">337</span></a>        <span class="n">_queries</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-338"><a href="#DynamicMemoryIndex-338"><span class="linenos">338</span></a>        <span class="n">_assert_2d</span><span class="p">(</span><span class="n">_queries</span><span class="p">,</span> <span class="s2">&quot;queries&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-339"><a href="#DynamicMemoryIndex-339"><span class="linenos">339</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-340"><a href="#DynamicMemoryIndex-340"><span class="linenos">340</span></a>            <span class="n">_queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-341"><a href="#DynamicMemoryIndex-341"><span class="linenos">341</span></a>            <span class="sa">f</span><span class="s2">&quot;query vectors must have the same dimensionality as the index; index dimensionality: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="DynamicMemoryIndex-342"><a href="#DynamicMemoryIndex-342"><span class="linenos">342</span></a>            <span class="sa">f</span><span class="s2">&quot;query dimensionality: </span><span class="si">{</span><span class="n">_queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-343"><a href="#DynamicMemoryIndex-343"><span class="linenos">343</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-344"><a href="#DynamicMemoryIndex-344"><span class="linenos">344</span></a>
</span><span id="DynamicMemoryIndex-345"><a href="#DynamicMemoryIndex-345"><span class="linenos">345</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-346"><a href="#DynamicMemoryIndex-346"><span class="linenos">346</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-347"><a href="#DynamicMemoryIndex-347"><span class="linenos">347</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-348"><a href="#DynamicMemoryIndex-348"><span class="linenos">348</span></a>
</span><span id="DynamicMemoryIndex-349"><a href="#DynamicMemoryIndex-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-350"><a href="#DynamicMemoryIndex-350"><span class="linenos">350</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-351"><a href="#DynamicMemoryIndex-351"><span class="linenos">351</span></a>                <span class="sa">f</span><span class="s2">&quot;k_neighbors=</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2"> asked for, but list_size=</span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DynamicMemoryIndex-352"><a href="#DynamicMemoryIndex-352"><span class="linenos">352</span></a>            <span class="p">)</span>
</span><span id="DynamicMemoryIndex-353"><a href="#DynamicMemoryIndex-353"><span class="linenos">353</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="DynamicMemoryIndex-354"><a href="#DynamicMemoryIndex-354"><span class="linenos">354</span></a>
</span><span id="DynamicMemoryIndex-355"><a href="#DynamicMemoryIndex-355"><span class="linenos">355</span></a>        <span class="n">num_queries</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">queries</span><span class="o">.</span><span class="n">shape</span>
</span><span id="DynamicMemoryIndex-356"><a href="#DynamicMemoryIndex-356"><span class="linenos">356</span></a>        <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">batch_search</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-357"><a href="#DynamicMemoryIndex-357"><span class="linenos">357</span></a>            <span class="n">queries</span><span class="o">=</span><span class="n">_queries</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-358"><a href="#DynamicMemoryIndex-358"><span class="linenos">358</span></a>            <span class="n">num_queries</span><span class="o">=</span><span class="n">num_queries</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-359"><a href="#DynamicMemoryIndex-359"><span class="linenos">359</span></a>            <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-360"><a href="#DynamicMemoryIndex-360"><span class="linenos">360</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-361"><a href="#DynamicMemoryIndex-361"><span class="linenos">361</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-362"><a href="#DynamicMemoryIndex-362"><span class="linenos">362</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-363"><a href="#DynamicMemoryIndex-363"><span class="linenos">363</span></a>        <span class="k">return</span> <span class="n">QueryResponseBatch</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-364"><a href="#DynamicMemoryIndex-364"><span class="linenos">364</span></a>
</span><span id="DynamicMemoryIndex-365"><a href="#DynamicMemoryIndex-365"><span class="linenos">365</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ann&quot;</span><span class="p">):</span>
</span><span id="DynamicMemoryIndex-366"><a href="#DynamicMemoryIndex-366"><span class="linenos">366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-367"><a href="#DynamicMemoryIndex-367"><span class="linenos">367</span></a><span class="sd">        Saves this index to file.</span>
</span><span id="DynamicMemoryIndex-368"><a href="#DynamicMemoryIndex-368"><span class="linenos">368</span></a>
</span><span id="DynamicMemoryIndex-369"><a href="#DynamicMemoryIndex-369"><span class="linenos">369</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex-370"><a href="#DynamicMemoryIndex-370"><span class="linenos">370</span></a><span class="sd">        - **save_path**: The path to save these index files to.</span>
</span><span id="DynamicMemoryIndex-371"><a href="#DynamicMemoryIndex-371"><span class="linenos">371</span></a><span class="sd">        - **index_prefix**: The prefix of the index files. Defaults to &quot;ann&quot;.</span>
</span><span id="DynamicMemoryIndex-372"><a href="#DynamicMemoryIndex-372"><span class="linenos">372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-373"><a href="#DynamicMemoryIndex-373"><span class="linenos">373</span></a>        <span class="k">if</span> <span class="n">save_path</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-374"><a href="#DynamicMemoryIndex-374"><span class="linenos">374</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;save_path cannot be empty&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-375"><a href="#DynamicMemoryIndex-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="n">index_prefix</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-376"><a href="#DynamicMemoryIndex-376"><span class="linenos">376</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;index_prefix cannot be empty&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-377"><a href="#DynamicMemoryIndex-377"><span class="linenos">377</span></a>
</span><span id="DynamicMemoryIndex-378"><a href="#DynamicMemoryIndex-378"><span class="linenos">378</span></a>        <span class="n">index_prefix</span> <span class="o">=</span> <span class="n">index_prefix</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">complexity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_complexity</span><span class="p">,</span> <span class="n">graph_degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_degree</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-379"><a href="#DynamicMemoryIndex-379"><span class="linenos">379</span></a>        <span class="n">_assert_existing_directory</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;save_path&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-380"><a href="#DynamicMemoryIndex-380"><span class="linenos">380</span></a>        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-381"><a href="#DynamicMemoryIndex-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points_deleted</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-382"><a href="#DynamicMemoryIndex-382"><span class="linenos">382</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-383"><a href="#DynamicMemoryIndex-383"><span class="linenos">383</span></a>                <span class="s2">&quot;DynamicMemoryIndex.save() currently requires DynamicMemoryIndex.consolidate_delete() to be called &quot;</span>
</span><span id="DynamicMemoryIndex-384"><a href="#DynamicMemoryIndex-384"><span class="linenos">384</span></a>                <span class="s2">&quot;prior to save when items have been marked for deletion. This is being done automatically now, though&quot;</span>
</span><span id="DynamicMemoryIndex-385"><a href="#DynamicMemoryIndex-385"><span class="linenos">385</span></a>                <span class="s2">&quot;it will increase the time it takes to save; on large sets of data it can take a substantial amount of &quot;</span>
</span><span id="DynamicMemoryIndex-386"><a href="#DynamicMemoryIndex-386"><span class="linenos">386</span></a>                <span class="s2">&quot;time. In the future, we will implement a faster save with unconsolidated deletes, but for now this is &quot;</span>
</span><span id="DynamicMemoryIndex-387"><a href="#DynamicMemoryIndex-387"><span class="linenos">387</span></a>                <span class="s2">&quot;required.&quot;</span>
</span><span id="DynamicMemoryIndex-388"><a href="#DynamicMemoryIndex-388"><span class="linenos">388</span></a>            <span class="p">)</span>
</span><span id="DynamicMemoryIndex-389"><a href="#DynamicMemoryIndex-389"><span class="linenos">389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">consolidate_delete</span><span class="p">()</span>
</span><span id="DynamicMemoryIndex-390"><a href="#DynamicMemoryIndex-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-391"><a href="#DynamicMemoryIndex-391"><span class="linenos">391</span></a>            <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">compact_before_save</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamicMemoryIndex-392"><a href="#DynamicMemoryIndex-392"><span class="linenos">392</span></a>        <span class="p">)</span>  <span class="c1"># we do not yet support uncompacted saves</span>
</span><span id="DynamicMemoryIndex-393"><a href="#DynamicMemoryIndex-393"><span class="linenos">393</span></a>        <span class="n">_write_index_metadata</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-394"><a href="#DynamicMemoryIndex-394"><span class="linenos">394</span></a>            <span class="n">save_path</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-395"><a href="#DynamicMemoryIndex-395"><span class="linenos">395</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-396"><a href="#DynamicMemoryIndex-396"><span class="linenos">396</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dap_metric</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-397"><a href="#DynamicMemoryIndex-397"><span class="linenos">397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">num_points</span><span class="p">(),</span>
</span><span id="DynamicMemoryIndex-398"><a href="#DynamicMemoryIndex-398"><span class="linenos">398</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-399"><a href="#DynamicMemoryIndex-399"><span class="linenos">399</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-400"><a href="#DynamicMemoryIndex-400"><span class="linenos">400</span></a>
</span><span id="DynamicMemoryIndex-401"><a href="#DynamicMemoryIndex-401"><span class="linenos">401</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">VectorLike</span><span class="p">,</span> <span class="n">vector_id</span><span class="p">:</span> <span class="n">VectorIdentifier</span><span class="p">):</span>
</span><span id="DynamicMemoryIndex-402"><a href="#DynamicMemoryIndex-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-403"><a href="#DynamicMemoryIndex-403"><span class="linenos">403</span></a><span class="sd">        Inserts a single vector into the index with the provided vector_id.</span>
</span><span id="DynamicMemoryIndex-404"><a href="#DynamicMemoryIndex-404"><span class="linenos">404</span></a>
</span><span id="DynamicMemoryIndex-405"><a href="#DynamicMemoryIndex-405"><span class="linenos">405</span></a><span class="sd">        If this insertion will overrun the `max_vectors` count boundaries of this index, `consolidate_delete()` will</span>
</span><span id="DynamicMemoryIndex-406"><a href="#DynamicMemoryIndex-406"><span class="linenos">406</span></a><span class="sd">        be executed automatically.</span>
</span><span id="DynamicMemoryIndex-407"><a href="#DynamicMemoryIndex-407"><span class="linenos">407</span></a>
</span><span id="DynamicMemoryIndex-408"><a href="#DynamicMemoryIndex-408"><span class="linenos">408</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex-409"><a href="#DynamicMemoryIndex-409"><span class="linenos">409</span></a><span class="sd">        - **vector**: The vector to insert. Note that dtype must match.</span>
</span><span id="DynamicMemoryIndex-410"><a href="#DynamicMemoryIndex-410"><span class="linenos">410</span></a><span class="sd">        - **vector_id**: The vector_id to use for this vector.</span>
</span><span id="DynamicMemoryIndex-411"><a href="#DynamicMemoryIndex-411"><span class="linenos">411</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-412"><a href="#DynamicMemoryIndex-412"><span class="linenos">412</span></a>        <span class="n">_vector</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-413"><a href="#DynamicMemoryIndex-413"><span class="linenos">413</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;insert vector must be 1-d&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-414"><a href="#DynamicMemoryIndex-414"><span class="linenos">414</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">vector_id</span><span class="p">,</span> <span class="s2">&quot;vector_id&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-415"><a href="#DynamicMemoryIndex-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-416"><a href="#DynamicMemoryIndex-416"><span class="linenos">416</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-417"><a href="#DynamicMemoryIndex-417"><span class="linenos">417</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserting this vector would overrun the max_vectors=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="si">}</span><span class="s2"> specified at index &quot;</span>
</span><span id="DynamicMemoryIndex-418"><a href="#DynamicMemoryIndex-418"><span class="linenos">418</span></a>                              <span class="sa">f</span><span class="s2">&quot;construction. We are attempting to consolidate_delete() to make space.&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-419"><a href="#DynamicMemoryIndex-419"><span class="linenos">419</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">consolidate_delete</span><span class="p">()</span>
</span><span id="DynamicMemoryIndex-420"><a href="#DynamicMemoryIndex-420"><span class="linenos">420</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-421"><a href="#DynamicMemoryIndex-421"><span class="linenos">421</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserting this vector would overrun the max_vectors=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="si">}</span><span class="s2"> specified &quot;</span>
</span><span id="DynamicMemoryIndex-422"><a href="#DynamicMemoryIndex-422"><span class="linenos">422</span></a>                                   <span class="sa">f</span><span class="s2">&quot;at index construction. Unable to make space by consolidating deletions. The insert&quot;</span>
</span><span id="DynamicMemoryIndex-423"><a href="#DynamicMemoryIndex-423"><span class="linenos">423</span></a>                                   <span class="sa">f</span><span class="s2">&quot;operation has failed.&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-424"><a href="#DynamicMemoryIndex-424"><span class="linenos">424</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">_vector</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="n">vector_id</span><span class="p">))</span>
</span><span id="DynamicMemoryIndex-425"><a href="#DynamicMemoryIndex-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-426"><a href="#DynamicMemoryIndex-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DynamicMemoryIndex-427"><a href="#DynamicMemoryIndex-427"><span class="linenos">427</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-428"><a href="#DynamicMemoryIndex-428"><span class="linenos">428</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-429"><a href="#DynamicMemoryIndex-429"><span class="linenos">429</span></a>                <span class="sa">f</span><span class="s2">&quot;Insert was unable to complete successfully; error code returned from diskann C++ lib: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DynamicMemoryIndex-430"><a href="#DynamicMemoryIndex-430"><span class="linenos">430</span></a>            <span class="p">)</span>
</span><span id="DynamicMemoryIndex-431"><a href="#DynamicMemoryIndex-431"><span class="linenos">431</span></a>
</span><span id="DynamicMemoryIndex-432"><a href="#DynamicMemoryIndex-432"><span class="linenos">432</span></a>
</span><span id="DynamicMemoryIndex-433"><a href="#DynamicMemoryIndex-433"><span class="linenos">433</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_insert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-434"><a href="#DynamicMemoryIndex-434"><span class="linenos">434</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-435"><a href="#DynamicMemoryIndex-435"><span class="linenos">435</span></a>        <span class="n">vectors</span><span class="p">:</span> <span class="n">VectorLikeBatch</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-436"><a href="#DynamicMemoryIndex-436"><span class="linenos">436</span></a>        <span class="n">vector_ids</span><span class="p">:</span> <span class="n">VectorIdentifierBatch</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-437"><a href="#DynamicMemoryIndex-437"><span class="linenos">437</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-438"><a href="#DynamicMemoryIndex-438"><span class="linenos">438</span></a>    <span class="p">):</span>
</span><span id="DynamicMemoryIndex-439"><a href="#DynamicMemoryIndex-439"><span class="linenos">439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-440"><a href="#DynamicMemoryIndex-440"><span class="linenos">440</span></a><span class="sd">        Inserts a batch of vectors into the index with the provided vector_ids.</span>
</span><span id="DynamicMemoryIndex-441"><a href="#DynamicMemoryIndex-441"><span class="linenos">441</span></a>
</span><span id="DynamicMemoryIndex-442"><a href="#DynamicMemoryIndex-442"><span class="linenos">442</span></a><span class="sd">        If this batch insertion will overrun the `max_vectors` count boundaries of this index, `consolidate_delete()`</span>
</span><span id="DynamicMemoryIndex-443"><a href="#DynamicMemoryIndex-443"><span class="linenos">443</span></a><span class="sd">        will be executed automatically.</span>
</span><span id="DynamicMemoryIndex-444"><a href="#DynamicMemoryIndex-444"><span class="linenos">444</span></a>
</span><span id="DynamicMemoryIndex-445"><a href="#DynamicMemoryIndex-445"><span class="linenos">445</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex-446"><a href="#DynamicMemoryIndex-446"><span class="linenos">446</span></a><span class="sd">        - **vectors**: The 2d numpy array of vectors to insert.</span>
</span><span id="DynamicMemoryIndex-447"><a href="#DynamicMemoryIndex-447"><span class="linenos">447</span></a><span class="sd">        - **vector_ids**: The 1d array of vector ids to use. This array must have the same number of elements as</span>
</span><span id="DynamicMemoryIndex-448"><a href="#DynamicMemoryIndex-448"><span class="linenos">448</span></a><span class="sd">            the vectors array has rows. The dtype of vector_ids must be `np.uint32`</span>
</span><span id="DynamicMemoryIndex-449"><a href="#DynamicMemoryIndex-449"><span class="linenos">449</span></a><span class="sd">        - **num_threads**: Number of threads to use when inserting into this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="DynamicMemoryIndex-450"><a href="#DynamicMemoryIndex-450"><span class="linenos">450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-451"><a href="#DynamicMemoryIndex-451"><span class="linenos">451</span></a>        <span class="n">_query</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-452"><a href="#DynamicMemoryIndex-452"><span class="linenos">452</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;vectors must be a 2-d array&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-453"><a href="#DynamicMemoryIndex-453"><span class="linenos">453</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-454"><a href="#DynamicMemoryIndex-454"><span class="linenos">454</span></a>            <span class="n">vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="DynamicMemoryIndex-455"><a href="#DynamicMemoryIndex-455"><span class="linenos">455</span></a>            <span class="s2">&quot;Number of vectors must be equal to number of ids&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex-456"><a href="#DynamicMemoryIndex-456"><span class="linenos">456</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-457"><a href="#DynamicMemoryIndex-457"><span class="linenos">457</span></a>        <span class="n">_vectors</span> <span class="o">=</span> <span class="n">vectors</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">,</span> <span class="n">casting</span><span class="o">=</span><span class="s2">&quot;safe&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-458"><a href="#DynamicMemoryIndex-458"><span class="linenos">458</span></a>        <span class="n">_vector_ids</span> <span class="o">=</span> <span class="n">vector_ids</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">,</span> <span class="n">casting</span><span class="o">=</span><span class="s2">&quot;safe&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-459"><a href="#DynamicMemoryIndex-459"><span class="linenos">459</span></a>
</span><span id="DynamicMemoryIndex-460"><a href="#DynamicMemoryIndex-460"><span class="linenos">460</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">+</span> <span class="n">_vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-461"><a href="#DynamicMemoryIndex-461"><span class="linenos">461</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span> <span class="o">&gt;=</span> <span class="n">_vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DynamicMemoryIndex-462"><a href="#DynamicMemoryIndex-462"><span class="linenos">462</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserting these vectors, count=</span><span class="si">{</span><span class="n">_vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> would overrun the &quot;</span>
</span><span id="DynamicMemoryIndex-463"><a href="#DynamicMemoryIndex-463"><span class="linenos">463</span></a>                              <span class="sa">f</span><span class="s2">&quot;max_vectors=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="si">}</span><span class="s2"> specified at index construction. We are attempting to &quot;</span>
</span><span id="DynamicMemoryIndex-464"><a href="#DynamicMemoryIndex-464"><span class="linenos">464</span></a>                              <span class="sa">f</span><span class="s2">&quot;consolidate_delete() to make space.&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-465"><a href="#DynamicMemoryIndex-465"><span class="linenos">465</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">consolidate_delete</span><span class="p">()</span>
</span><span id="DynamicMemoryIndex-466"><a href="#DynamicMemoryIndex-466"><span class="linenos">466</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-467"><a href="#DynamicMemoryIndex-467"><span class="linenos">467</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserting these vectors count=</span><span class="si">{</span><span class="n">_vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> would overrun the &quot;</span>
</span><span id="DynamicMemoryIndex-468"><a href="#DynamicMemoryIndex-468"><span class="linenos">468</span></a>                                   <span class="sa">f</span><span class="s2">&quot;max_vectors=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="si">}</span><span class="s2"> specified at index construction. Unable to make &quot;</span>
</span><span id="DynamicMemoryIndex-469"><a href="#DynamicMemoryIndex-469"><span class="linenos">469</span></a>                                   <span class="sa">f</span><span class="s2">&quot;space by consolidating deletions. The batch insert operation has failed.&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-470"><a href="#DynamicMemoryIndex-470"><span class="linenos">470</span></a>
</span><span id="DynamicMemoryIndex-471"><a href="#DynamicMemoryIndex-471"><span class="linenos">471</span></a>        <span class="n">statuses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">batch_insert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-472"><a href="#DynamicMemoryIndex-472"><span class="linenos">472</span></a>            <span class="n">_vectors</span><span class="p">,</span> <span class="n">_vector_ids</span><span class="p">,</span> <span class="n">_vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num_threads</span>
</span><span id="DynamicMemoryIndex-473"><a href="#DynamicMemoryIndex-473"><span class="linenos">473</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-474"><a href="#DynamicMemoryIndex-474"><span class="linenos">474</span></a>        <span class="n">successes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DynamicMemoryIndex-475"><a href="#DynamicMemoryIndex-475"><span class="linenos">475</span></a>        <span class="n">failures</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DynamicMemoryIndex-476"><a href="#DynamicMemoryIndex-476"><span class="linenos">476</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">statuses</span><span class="p">)):</span>
</span><span id="DynamicMemoryIndex-477"><a href="#DynamicMemoryIndex-477"><span class="linenos">477</span></a>            <span class="k">if</span> <span class="n">statuses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-478"><a href="#DynamicMemoryIndex-478"><span class="linenos">478</span></a>                <span class="n">successes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-479"><a href="#DynamicMemoryIndex-479"><span class="linenos">479</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-480"><a href="#DynamicMemoryIndex-480"><span class="linenos">480</span></a>                <span class="n">failures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-481"><a href="#DynamicMemoryIndex-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">successes</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-482"><a href="#DynamicMemoryIndex-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex-483"><a href="#DynamicMemoryIndex-483"><span class="linenos">483</span></a>            <span class="k">return</span>
</span><span id="DynamicMemoryIndex-484"><a href="#DynamicMemoryIndex-484"><span class="linenos">484</span></a>        <span class="n">failed_ids</span> <span class="o">=</span> <span class="n">vector_ids</span><span class="p">[</span><span class="n">failures</span><span class="p">]</span>
</span><span id="DynamicMemoryIndex-485"><a href="#DynamicMemoryIndex-485"><span class="linenos">485</span></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex-486"><a href="#DynamicMemoryIndex-486"><span class="linenos">486</span></a>            <span class="sa">f</span><span class="s2">&quot;During batch insert, the following vector_ids were unable to be inserted into the index: </span><span class="si">{</span><span class="n">failed_ids</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="DynamicMemoryIndex-487"><a href="#DynamicMemoryIndex-487"><span class="linenos">487</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">successes</span><span class="p">)</span><span class="si">}</span><span class="s2"> were successfully inserted&quot;</span>
</span><span id="DynamicMemoryIndex-488"><a href="#DynamicMemoryIndex-488"><span class="linenos">488</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex-489"><a href="#DynamicMemoryIndex-489"><span class="linenos">489</span></a>
</span><span id="DynamicMemoryIndex-490"><a href="#DynamicMemoryIndex-490"><span class="linenos">490</span></a>
</span><span id="DynamicMemoryIndex-491"><a href="#DynamicMemoryIndex-491"><span class="linenos">491</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mark_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_id</span><span class="p">:</span> <span class="n">VectorIdentifier</span><span class="p">):</span>
</span><span id="DynamicMemoryIndex-492"><a href="#DynamicMemoryIndex-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-493"><a href="#DynamicMemoryIndex-493"><span class="linenos">493</span></a><span class="sd">        Mark vector for deletion. This is a soft delete that won&#39;t return the vector id in any results, but does not</span>
</span><span id="DynamicMemoryIndex-494"><a href="#DynamicMemoryIndex-494"><span class="linenos">494</span></a><span class="sd">        remove it from the underlying index files or memory structure. To execute a hard delete, call this method and</span>
</span><span id="DynamicMemoryIndex-495"><a href="#DynamicMemoryIndex-495"><span class="linenos">495</span></a><span class="sd">        then call the much more expensive `consolidate_delete` method on this index.</span>
</span><span id="DynamicMemoryIndex-496"><a href="#DynamicMemoryIndex-496"><span class="linenos">496</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex-497"><a href="#DynamicMemoryIndex-497"><span class="linenos">497</span></a><span class="sd">        - **vector_id**: The vector id to delete. Must be a uint32.</span>
</span><span id="DynamicMemoryIndex-498"><a href="#DynamicMemoryIndex-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-499"><a href="#DynamicMemoryIndex-499"><span class="linenos">499</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">vector_id</span><span class="p">,</span> <span class="s2">&quot;vector_id&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex-500"><a href="#DynamicMemoryIndex-500"><span class="linenos">500</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_points_deleted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamicMemoryIndex-501"><a href="#DynamicMemoryIndex-501"><span class="linenos">501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DynamicMemoryIndex-502"><a href="#DynamicMemoryIndex-502"><span class="linenos">502</span></a>        <span class="c1"># we do not decrement self._num_vectors until consolidate_delete</span>
</span><span id="DynamicMemoryIndex-503"><a href="#DynamicMemoryIndex-503"><span class="linenos">503</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">mark_deleted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="n">vector_id</span><span class="p">))</span>
</span><span id="DynamicMemoryIndex-504"><a href="#DynamicMemoryIndex-504"><span class="linenos">504</span></a>
</span><span id="DynamicMemoryIndex-505"><a href="#DynamicMemoryIndex-505"><span class="linenos">505</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">consolidate_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamicMemoryIndex-506"><a href="#DynamicMemoryIndex-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-507"><a href="#DynamicMemoryIndex-507"><span class="linenos">507</span></a><span class="sd">        This method actually restructures the DiskANN index to remove the items that have been marked for deletion.</span>
</span><span id="DynamicMemoryIndex-508"><a href="#DynamicMemoryIndex-508"><span class="linenos">508</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex-509"><a href="#DynamicMemoryIndex-509"><span class="linenos">509</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">consolidate_delete</span><span class="p">()</span>
</span><span id="DynamicMemoryIndex-510"><a href="#DynamicMemoryIndex-510"><span class="linenos">510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_points_deleted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamicMemoryIndex-511"><a href="#DynamicMemoryIndex-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span>
</span><span id="DynamicMemoryIndex-512"><a href="#DynamicMemoryIndex-512"><span class="linenos">512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>A DynamicMemoryIndex instance is used to both search and mutate a <code><a href="">diskannpy</a></code> memory index. This index is unlike
either <code><a href="#StaticMemoryIndex">diskannpy.StaticMemoryIndex</a></code> or <code><a href="#StaticDiskIndex">diskannpy.StaticDiskIndex</a></code> in the following ways:</p>

<ul>
<li>It requires an explicit vector identifier for each vector added to it.</li>
<li>Insert and (lazy) deletion operations are provided for a flexible, living index</li>
</ul>

<p>The mutable aspect of this index will absolutely impact search time performance as new vectors are added and
old deleted. <code>DynamicMemoryIndex.consolidate_deletes()</code> should be called periodically to restructure the index
to remove deleted vectors and improve per-search performance, at the cost of an expensive index consolidation to
occur.</p>
</div>


                            <div id="DynamicMemoryIndex.__init__" class="classattr">
                                        <input id="DynamicMemoryIndex.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DynamicMemoryIndex</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">distance_metric</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;mips&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]</span>,</span><span class="param">	<span class="n">dimensions</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">max_vectors</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">graph_degree</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">saturate_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">max_occlusion_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span>,</span><span class="param">	<span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.2000000476837158</span>,</span><span class="param">	<span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">filter_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">num_frozen_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">initial_search_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">search_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">concurrent_consolidation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="DynamicMemoryIndex.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamicMemoryIndex.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamicMemoryIndex.__init__-172"><a href="#DynamicMemoryIndex.__init__-172"><span class="linenos">172</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.__init__-173"><a href="#DynamicMemoryIndex.__init__-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-174"><a href="#DynamicMemoryIndex.__init__-174"><span class="linenos">174</span></a>        <span class="n">distance_metric</span><span class="p">:</span> <span class="n">DistanceMetric</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-175"><a href="#DynamicMemoryIndex.__init__-175"><span class="linenos">175</span></a>        <span class="n">vector_dtype</span><span class="p">:</span> <span class="n">VectorDType</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-176"><a href="#DynamicMemoryIndex.__init__-176"><span class="linenos">176</span></a>        <span class="n">dimensions</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-177"><a href="#DynamicMemoryIndex.__init__-177"><span class="linenos">177</span></a>        <span class="n">max_vectors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-178"><a href="#DynamicMemoryIndex.__init__-178"><span class="linenos">178</span></a>        <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-179"><a href="#DynamicMemoryIndex.__init__-179"><span class="linenos">179</span></a>        <span class="n">graph_degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-180"><a href="#DynamicMemoryIndex.__init__-180"><span class="linenos">180</span></a>        <span class="n">saturate_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">SATURATE_GRAPH</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-181"><a href="#DynamicMemoryIndex.__init__-181"><span class="linenos">181</span></a>        <span class="n">max_occlusion_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">MAX_OCCLUSION_SIZE</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-182"><a href="#DynamicMemoryIndex.__init__-182"><span class="linenos">182</span></a>        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">ALPHA</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-183"><a href="#DynamicMemoryIndex.__init__-183"><span class="linenos">183</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">NUM_THREADS</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-184"><a href="#DynamicMemoryIndex.__init__-184"><span class="linenos">184</span></a>        <span class="n">filter_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">FILTER_COMPLEXITY</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-185"><a href="#DynamicMemoryIndex.__init__-185"><span class="linenos">185</span></a>        <span class="n">num_frozen_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">NUM_FROZEN_POINTS_DYNAMIC</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-186"><a href="#DynamicMemoryIndex.__init__-186"><span class="linenos">186</span></a>        <span class="n">initial_search_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-187"><a href="#DynamicMemoryIndex.__init__-187"><span class="linenos">187</span></a>        <span class="n">search_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-188"><a href="#DynamicMemoryIndex.__init__-188"><span class="linenos">188</span></a>        <span class="n">concurrent_consolidation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-189"><a href="#DynamicMemoryIndex.__init__-189"><span class="linenos">189</span></a>    <span class="p">):</span>
</span><span id="DynamicMemoryIndex.__init__-190"><a href="#DynamicMemoryIndex.__init__-190"><span class="linenos">190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.__init__-191"><a href="#DynamicMemoryIndex.__init__-191"><span class="linenos">191</span></a><span class="sd">        The `diskannpy.DynamicMemoryIndex` represents our python API into a mutable DiskANN memory index.</span>
</span><span id="DynamicMemoryIndex.__init__-192"><a href="#DynamicMemoryIndex.__init__-192"><span class="linenos">192</span></a>
</span><span id="DynamicMemoryIndex.__init__-193"><a href="#DynamicMemoryIndex.__init__-193"><span class="linenos">193</span></a><span class="sd">        This constructor is used to create a new, empty index. If you wish to load a previously saved index from disk,</span>
</span><span id="DynamicMemoryIndex.__init__-194"><a href="#DynamicMemoryIndex.__init__-194"><span class="linenos">194</span></a><span class="sd">        please use the `diskannpy.DynamicMemoryIndex.from_file` classmethod instead.</span>
</span><span id="DynamicMemoryIndex.__init__-195"><a href="#DynamicMemoryIndex.__init__-195"><span class="linenos">195</span></a>
</span><span id="DynamicMemoryIndex.__init__-196"><a href="#DynamicMemoryIndex.__init__-196"><span class="linenos">196</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex.__init__-197"><a href="#DynamicMemoryIndex.__init__-197"><span class="linenos">197</span></a><span class="sd">        - **distance_metric**: A `str`, strictly one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;}. `l2` and `cosine` are supported for all 3</span>
</span><span id="DynamicMemoryIndex.__init__-198"><a href="#DynamicMemoryIndex.__init__-198"><span class="linenos">198</span></a><span class="sd">          vector dtypes, but `mips` is only available for single precision floats.</span>
</span><span id="DynamicMemoryIndex.__init__-199"><a href="#DynamicMemoryIndex.__init__-199"><span class="linenos">199</span></a><span class="sd">        - **vector_dtype**: One of {`np.float32`, `np.int8`, `np.uint8`}. The dtype of the vectors this index will</span>
</span><span id="DynamicMemoryIndex.__init__-200"><a href="#DynamicMemoryIndex.__init__-200"><span class="linenos">200</span></a><span class="sd">          be storing.</span>
</span><span id="DynamicMemoryIndex.__init__-201"><a href="#DynamicMemoryIndex.__init__-201"><span class="linenos">201</span></a><span class="sd">        - **dimensions**: The vector dimensionality of this index. All new vectors inserted must be the same</span>
</span><span id="DynamicMemoryIndex.__init__-202"><a href="#DynamicMemoryIndex.__init__-202"><span class="linenos">202</span></a><span class="sd">          dimensionality.</span>
</span><span id="DynamicMemoryIndex.__init__-203"><a href="#DynamicMemoryIndex.__init__-203"><span class="linenos">203</span></a><span class="sd">        - **max_vectors**: Capacity of the data store including space for future insertions</span>
</span><span id="DynamicMemoryIndex.__init__-204"><a href="#DynamicMemoryIndex.__init__-204"><span class="linenos">204</span></a><span class="sd">        - **graph_degree**: Graph degree (a.k.a. `R`) is the maximum degree allowed for a node in the index&#39;s graph</span>
</span><span id="DynamicMemoryIndex.__init__-205"><a href="#DynamicMemoryIndex.__init__-205"><span class="linenos">205</span></a><span class="sd">          structure. This degree will be pruned throughout the course of the index build, but it will never grow beyond</span>
</span><span id="DynamicMemoryIndex.__init__-206"><a href="#DynamicMemoryIndex.__init__-206"><span class="linenos">206</span></a><span class="sd">          this value. Higher `graph_degree` values require longer index build times, but may result in an index showing</span>
</span><span id="DynamicMemoryIndex.__init__-207"><a href="#DynamicMemoryIndex.__init__-207"><span class="linenos">207</span></a><span class="sd">          excellent recall and latency characteristics.</span>
</span><span id="DynamicMemoryIndex.__init__-208"><a href="#DynamicMemoryIndex.__init__-208"><span class="linenos">208</span></a><span class="sd">        - **saturate_graph**: If True, the adjacency list of each node will be saturated with neighbors to have exactly</span>
</span><span id="DynamicMemoryIndex.__init__-209"><a href="#DynamicMemoryIndex.__init__-209"><span class="linenos">209</span></a><span class="sd">          `graph_degree` neighbors. If False, each node will have between 1 and `graph_degree` neighbors.</span>
</span><span id="DynamicMemoryIndex.__init__-210"><a href="#DynamicMemoryIndex.__init__-210"><span class="linenos">210</span></a><span class="sd">        - **max_occlusion_size**: The maximum number of points that can be considered by occlude_list function.</span>
</span><span id="DynamicMemoryIndex.__init__-211"><a href="#DynamicMemoryIndex.__init__-211"><span class="linenos">211</span></a><span class="sd">        - **alpha**: The alpha parameter (&gt;=1) is used to control the nature and number of points that are added to the</span>
</span><span id="DynamicMemoryIndex.__init__-212"><a href="#DynamicMemoryIndex.__init__-212"><span class="linenos">212</span></a><span class="sd">          graph. A higher alpha value (e.g., 1.4) will result in fewer hops (and IOs) to convergence, but probably</span>
</span><span id="DynamicMemoryIndex.__init__-213"><a href="#DynamicMemoryIndex.__init__-213"><span class="linenos">213</span></a><span class="sd">          more distance comparisons compared to a lower alpha value.</span>
</span><span id="DynamicMemoryIndex.__init__-214"><a href="#DynamicMemoryIndex.__init__-214"><span class="linenos">214</span></a><span class="sd">        - **num_threads**: Number of threads to use when creating this index. `0` indicates we should use all available</span>
</span><span id="DynamicMemoryIndex.__init__-215"><a href="#DynamicMemoryIndex.__init__-215"><span class="linenos">215</span></a><span class="sd">          logical processors.</span>
</span><span id="DynamicMemoryIndex.__init__-216"><a href="#DynamicMemoryIndex.__init__-216"><span class="linenos">216</span></a><span class="sd">        - **filter_complexity**: Complexity to use when using filters. Default is 0.</span>
</span><span id="DynamicMemoryIndex.__init__-217"><a href="#DynamicMemoryIndex.__init__-217"><span class="linenos">217</span></a><span class="sd">        - **num_frozen_points**: Number of points to freeze. Default is 1.</span>
</span><span id="DynamicMemoryIndex.__init__-218"><a href="#DynamicMemoryIndex.__init__-218"><span class="linenos">218</span></a><span class="sd">        - **initial_search_complexity**: Should be set to the most common `complexity` expected to be used during the</span>
</span><span id="DynamicMemoryIndex.__init__-219"><a href="#DynamicMemoryIndex.__init__-219"><span class="linenos">219</span></a><span class="sd">          life of this `diskannpy.DynamicMemoryIndex` object. The working scratch memory allocated is based off of</span>
</span><span id="DynamicMemoryIndex.__init__-220"><a href="#DynamicMemoryIndex.__init__-220"><span class="linenos">220</span></a><span class="sd">          `initial_search_complexity` * `search_threads`. Note that it may be resized if a `search` or `batch_search`</span>
</span><span id="DynamicMemoryIndex.__init__-221"><a href="#DynamicMemoryIndex.__init__-221"><span class="linenos">221</span></a><span class="sd">          operation requests a space larger than can be accommodated by these values.</span>
</span><span id="DynamicMemoryIndex.__init__-222"><a href="#DynamicMemoryIndex.__init__-222"><span class="linenos">222</span></a><span class="sd">        - **search_threads**: Should be set to the most common `num_threads` expected to be used during the</span>
</span><span id="DynamicMemoryIndex.__init__-223"><a href="#DynamicMemoryIndex.__init__-223"><span class="linenos">223</span></a><span class="sd">          life of this `diskannpy.DynamicMemoryIndex` object. The working scratch memory allocated is based off of</span>
</span><span id="DynamicMemoryIndex.__init__-224"><a href="#DynamicMemoryIndex.__init__-224"><span class="linenos">224</span></a><span class="sd">          `initial_search_complexity` * `search_threads`. Note that it may be resized if a `batch_search`</span>
</span><span id="DynamicMemoryIndex.__init__-225"><a href="#DynamicMemoryIndex.__init__-225"><span class="linenos">225</span></a><span class="sd">          operation requests a space larger than can be accommodated by these values.</span>
</span><span id="DynamicMemoryIndex.__init__-226"><a href="#DynamicMemoryIndex.__init__-226"><span class="linenos">226</span></a><span class="sd">        - **concurrent_consolidation**: This flag dictates whether consolidation can be run alongside inserts and</span>
</span><span id="DynamicMemoryIndex.__init__-227"><a href="#DynamicMemoryIndex.__init__-227"><span class="linenos">227</span></a><span class="sd">          deletes, or whether the index is locked down to changes while consolidation is ongoing.</span>
</span><span id="DynamicMemoryIndex.__init__-228"><a href="#DynamicMemoryIndex.__init__-228"><span class="linenos">228</span></a>
</span><span id="DynamicMemoryIndex.__init__-229"><a href="#DynamicMemoryIndex.__init__-229"><span class="linenos">229</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.__init__-230"><a href="#DynamicMemoryIndex.__init__-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DynamicMemoryIndex.__init__-231"><a href="#DynamicMemoryIndex.__init__-231"><span class="linenos">231</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="DynamicMemoryIndex.__init__-232"><a href="#DynamicMemoryIndex.__init__-232"><span class="linenos">232</span></a>        <span class="n">dap_metric</span> <span class="o">=</span> <span class="n">_valid_metric</span><span class="p">(</span><span class="n">distance_metric</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-233"><a href="#DynamicMemoryIndex.__init__-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dap_metric</span> <span class="o">=</span> <span class="n">dap_metric</span>
</span><span id="DynamicMemoryIndex.__init__-234"><a href="#DynamicMemoryIndex.__init__-234"><span class="linenos">234</span></a>        <span class="n">_assert_dtype</span><span class="p">(</span><span class="n">vector_dtype</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-235"><a href="#DynamicMemoryIndex.__init__-235"><span class="linenos">235</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">dimensions</span><span class="p">,</span> <span class="s2">&quot;dimensions&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-236"><a href="#DynamicMemoryIndex.__init__-236"><span class="linenos">236</span></a>
</span><span id="DynamicMemoryIndex.__init__-237"><a href="#DynamicMemoryIndex.__init__-237"><span class="linenos">237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span> <span class="o">=</span> <span class="n">vector_dtype</span>
</span><span id="DynamicMemoryIndex.__init__-238"><a href="#DynamicMemoryIndex.__init__-238"><span class="linenos">238</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span> <span class="o">=</span> <span class="n">dimensions</span>
</span><span id="DynamicMemoryIndex.__init__-239"><a href="#DynamicMemoryIndex.__init__-239"><span class="linenos">239</span></a>
</span><span id="DynamicMemoryIndex.__init__-240"><a href="#DynamicMemoryIndex.__init__-240"><span class="linenos">240</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">max_vectors</span><span class="p">,</span> <span class="s2">&quot;max_vectors&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-241"><a href="#DynamicMemoryIndex.__init__-241"><span class="linenos">241</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-242"><a href="#DynamicMemoryIndex.__init__-242"><span class="linenos">242</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">graph_degree</span><span class="p">,</span> <span class="s2">&quot;graph_degree&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-243"><a href="#DynamicMemoryIndex.__init__-243"><span class="linenos">243</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.__init__-244"><a href="#DynamicMemoryIndex.__init__-244"><span class="linenos">244</span></a>            <span class="n">alpha</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-245"><a href="#DynamicMemoryIndex.__init__-245"><span class="linenos">245</span></a>            <span class="s2">&quot;alpha must be &gt;= 1, and realistically should be kept between [1.0, 2.0)&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-246"><a href="#DynamicMemoryIndex.__init__-246"><span class="linenos">246</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-247"><a href="#DynamicMemoryIndex.__init__-247"><span class="linenos">247</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">max_occlusion_size</span><span class="p">,</span> <span class="s2">&quot;max_occlusion_size&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-248"><a href="#DynamicMemoryIndex.__init__-248"><span class="linenos">248</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-249"><a href="#DynamicMemoryIndex.__init__-249"><span class="linenos">249</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">filter_complexity</span><span class="p">,</span> <span class="s2">&quot;filter_complexity&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-250"><a href="#DynamicMemoryIndex.__init__-250"><span class="linenos">250</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_frozen_points</span><span class="p">,</span> <span class="s2">&quot;num_frozen_points&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-251"><a href="#DynamicMemoryIndex.__init__-251"><span class="linenos">251</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.__init__-252"><a href="#DynamicMemoryIndex.__init__-252"><span class="linenos">252</span></a>            <span class="n">initial_search_complexity</span><span class="p">,</span> <span class="s2">&quot;initial_search_complexity&quot;</span>
</span><span id="DynamicMemoryIndex.__init__-253"><a href="#DynamicMemoryIndex.__init__-253"><span class="linenos">253</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-254"><a href="#DynamicMemoryIndex.__init__-254"><span class="linenos">254</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">search_threads</span><span class="p">,</span> <span class="s2">&quot;search_threads&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-255"><a href="#DynamicMemoryIndex.__init__-255"><span class="linenos">255</span></a>
</span><span id="DynamicMemoryIndex.__init__-256"><a href="#DynamicMemoryIndex.__init__-256"><span class="linenos">256</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span> <span class="o">=</span> <span class="n">max_vectors</span>
</span><span id="DynamicMemoryIndex.__init__-257"><a href="#DynamicMemoryIndex.__init__-257"><span class="linenos">257</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_complexity</span> <span class="o">=</span> <span class="n">complexity</span>
</span><span id="DynamicMemoryIndex.__init__-258"><a href="#DynamicMemoryIndex.__init__-258"><span class="linenos">258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_graph_degree</span> <span class="o">=</span> <span class="n">graph_degree</span>
</span><span id="DynamicMemoryIndex.__init__-259"><a href="#DynamicMemoryIndex.__init__-259"><span class="linenos">259</span></a>
</span><span id="DynamicMemoryIndex.__init__-260"><a href="#DynamicMemoryIndex.__init__-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.__init__-261"><a href="#DynamicMemoryIndex.__init__-261"><span class="linenos">261</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">DynamicMemoryUInt8Index</span>
</span><span id="DynamicMemoryIndex.__init__-262"><a href="#DynamicMemoryIndex.__init__-262"><span class="linenos">262</span></a>        <span class="k">elif</span> <span class="n">vector_dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.__init__-263"><a href="#DynamicMemoryIndex.__init__-263"><span class="linenos">263</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">DynamicMemoryInt8Index</span>
</span><span id="DynamicMemoryIndex.__init__-264"><a href="#DynamicMemoryIndex.__init__-264"><span class="linenos">264</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.__init__-265"><a href="#DynamicMemoryIndex.__init__-265"><span class="linenos">265</span></a>            <span class="n">_index</span> <span class="o">=</span> <span class="n">_native_dap</span><span class="o">.</span><span class="n">DynamicMemoryFloatIndex</span>
</span><span id="DynamicMemoryIndex.__init__-266"><a href="#DynamicMemoryIndex.__init__-266"><span class="linenos">266</span></a>
</span><span id="DynamicMemoryIndex.__init__-267"><a href="#DynamicMemoryIndex.__init__-267"><span class="linenos">267</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">_index</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.__init__-268"><a href="#DynamicMemoryIndex.__init__-268"><span class="linenos">268</span></a>            <span class="n">distance_metric</span><span class="o">=</span><span class="n">dap_metric</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-269"><a href="#DynamicMemoryIndex.__init__-269"><span class="linenos">269</span></a>            <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-270"><a href="#DynamicMemoryIndex.__init__-270"><span class="linenos">270</span></a>            <span class="n">max_vectors</span><span class="o">=</span><span class="n">max_vectors</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-271"><a href="#DynamicMemoryIndex.__init__-271"><span class="linenos">271</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-272"><a href="#DynamicMemoryIndex.__init__-272"><span class="linenos">272</span></a>            <span class="n">graph_degree</span><span class="o">=</span><span class="n">graph_degree</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-273"><a href="#DynamicMemoryIndex.__init__-273"><span class="linenos">273</span></a>            <span class="n">saturate_graph</span><span class="o">=</span><span class="n">saturate_graph</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-274"><a href="#DynamicMemoryIndex.__init__-274"><span class="linenos">274</span></a>            <span class="n">max_occlusion_size</span><span class="o">=</span><span class="n">max_occlusion_size</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-275"><a href="#DynamicMemoryIndex.__init__-275"><span class="linenos">275</span></a>            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-276"><a href="#DynamicMemoryIndex.__init__-276"><span class="linenos">276</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-277"><a href="#DynamicMemoryIndex.__init__-277"><span class="linenos">277</span></a>            <span class="n">filter_complexity</span><span class="o">=</span><span class="n">filter_complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-278"><a href="#DynamicMemoryIndex.__init__-278"><span class="linenos">278</span></a>            <span class="n">num_frozen_points</span><span class="o">=</span><span class="n">num_frozen_points</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-279"><a href="#DynamicMemoryIndex.__init__-279"><span class="linenos">279</span></a>            <span class="n">initial_search_complexity</span><span class="o">=</span><span class="n">initial_search_complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-280"><a href="#DynamicMemoryIndex.__init__-280"><span class="linenos">280</span></a>            <span class="n">search_threads</span><span class="o">=</span><span class="n">search_threads</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-281"><a href="#DynamicMemoryIndex.__init__-281"><span class="linenos">281</span></a>            <span class="n">concurrent_consolidation</span><span class="o">=</span><span class="n">concurrent_consolidation</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.__init__-282"><a href="#DynamicMemoryIndex.__init__-282"><span class="linenos">282</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.__init__-283"><a href="#DynamicMemoryIndex.__init__-283"><span class="linenos">283</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_points_deleted</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#DynamicMemoryIndex">diskannpy.DynamicMemoryIndex</a></code> represents our python API into a mutable DiskANN memory index.</p>

<p>This constructor is used to create a new, empty index. If you wish to load a previously saved index from disk,
please use the <code><a href="#DynamicMemoryIndex.from_file">diskannpy.DynamicMemoryIndex.from_file</a></code> classmethod instead.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>distance_metric</strong>: A <code>str</code>, strictly one of {"l2", "mips", "cosine"}. <code>l2</code> and <code>cosine</code> are supported for all 3
vector dtypes, but <code>mips</code> is only available for single precision floats.</li>
<li><strong>vector_dtype</strong>: One of {<code>np.float32</code>, <code>np.int8</code>, <code>np.uint8</code>}. The dtype of the vectors this index will
be storing.</li>
<li><strong>dimensions</strong>: The vector dimensionality of this index. All new vectors inserted must be the same
dimensionality.</li>
<li><strong>max_vectors</strong>: Capacity of the data store including space for future insertions</li>
<li><strong>graph_degree</strong>: Graph degree (a.k.a. <code>R</code>) is the maximum degree allowed for a node in the index's graph
structure. This degree will be pruned throughout the course of the index build, but it will never grow beyond
this value. Higher <code>graph_degree</code> values require longer index build times, but may result in an index showing
excellent recall and latency characteristics.</li>
<li><strong>saturate_graph</strong>: If True, the adjacency list of each node will be saturated with neighbors to have exactly
<code>graph_degree</code> neighbors. If False, each node will have between 1 and <code>graph_degree</code> neighbors.</li>
<li><strong>max_occlusion_size</strong>: The maximum number of points that can be considered by occlude_list function.</li>
<li><strong>alpha</strong>: The alpha parameter (&gt;=1) is used to control the nature and number of points that are added to the
graph. A higher alpha value (e.g., 1.4) will result in fewer hops (and IOs) to convergence, but probably
more distance comparisons compared to a lower alpha value.</li>
<li><strong>num_threads</strong>: Number of threads to use when creating this index. <code>0</code> indicates we should use all available
logical processors.</li>
<li><strong>filter_complexity</strong>: Complexity to use when using filters. Default is 0.</li>
<li><strong>num_frozen_points</strong>: Number of points to freeze. Default is 1.</li>
<li><strong>initial_search_complexity</strong>: Should be set to the most common <code>complexity</code> expected to be used during the
life of this <code><a href="#DynamicMemoryIndex">diskannpy.DynamicMemoryIndex</a></code> object. The working scratch memory allocated is based off of
<code>initial_search_complexity</code> * <code>search_threads</code>. Note that it may be resized if a <code><a href="#DynamicMemoryIndex.search">search</a></code> or <code><a href="#DynamicMemoryIndex.batch_search">batch_search</a></code>
operation requests a space larger than can be accommodated by these values.</li>
<li><strong>search_threads</strong>: Should be set to the most common <code>num_threads</code> expected to be used during the
life of this <code><a href="#DynamicMemoryIndex">diskannpy.DynamicMemoryIndex</a></code> object. The working scratch memory allocated is based off of
<code>initial_search_complexity</code> * <code>search_threads</code>. Note that it may be resized if a <code><a href="#DynamicMemoryIndex.batch_search">batch_search</a></code>
operation requests a space larger than can be accommodated by these values.</li>
<li><strong>concurrent_consolidation</strong>: This flag dictates whether consolidation can be run alongside inserts and
deletes, or whether the index is locked down to changes while consolidation is ongoing.</li>
</ul>
</div>


                            </div>
                            <div id="DynamicMemoryIndex.from_file" class="classattr">
                                        <input id="DynamicMemoryIndex.from_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">max_vectors</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">graph_degree</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">saturate_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">max_occlusion_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">750</span>,</span><span class="param">	<span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.2000000476837158</span>,</span><span class="param">	<span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">filter_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">num_frozen_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">initial_search_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">search_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">concurrent_consolidation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ann&#39;</span>,</span><span class="param">	<span class="n">distance_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;mips&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dimensions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#DynamicMemoryIndex">DynamicMemoryIndex</a></span>:</span></span>

                <label class="view-source-button" for="DynamicMemoryIndex.from_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamicMemoryIndex.from_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamicMemoryIndex.from_file-55"><a href="#DynamicMemoryIndex.from_file-55"><span class="linenos"> 55</span></a>    <span class="nd">@classmethod</span>
</span><span id="DynamicMemoryIndex.from_file-56"><a href="#DynamicMemoryIndex.from_file-56"><span class="linenos"> 56</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_file</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.from_file-57"><a href="#DynamicMemoryIndex.from_file-57"><span class="linenos"> 57</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-58"><a href="#DynamicMemoryIndex.from_file-58"><span class="linenos"> 58</span></a>        <span class="n">index_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-59"><a href="#DynamicMemoryIndex.from_file-59"><span class="linenos"> 59</span></a>        <span class="n">max_vectors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-60"><a href="#DynamicMemoryIndex.from_file-60"><span class="linenos"> 60</span></a>        <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-61"><a href="#DynamicMemoryIndex.from_file-61"><span class="linenos"> 61</span></a>        <span class="n">graph_degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-62"><a href="#DynamicMemoryIndex.from_file-62"><span class="linenos"> 62</span></a>        <span class="n">saturate_graph</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">SATURATE_GRAPH</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-63"><a href="#DynamicMemoryIndex.from_file-63"><span class="linenos"> 63</span></a>        <span class="n">max_occlusion_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">MAX_OCCLUSION_SIZE</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-64"><a href="#DynamicMemoryIndex.from_file-64"><span class="linenos"> 64</span></a>        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">ALPHA</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-65"><a href="#DynamicMemoryIndex.from_file-65"><span class="linenos"> 65</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">NUM_THREADS</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-66"><a href="#DynamicMemoryIndex.from_file-66"><span class="linenos"> 66</span></a>        <span class="n">filter_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">FILTER_COMPLEXITY</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-67"><a href="#DynamicMemoryIndex.from_file-67"><span class="linenos"> 67</span></a>        <span class="n">num_frozen_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">NUM_FROZEN_POINTS_DYNAMIC</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-68"><a href="#DynamicMemoryIndex.from_file-68"><span class="linenos"> 68</span></a>        <span class="n">initial_search_complexity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-69"><a href="#DynamicMemoryIndex.from_file-69"><span class="linenos"> 69</span></a>        <span class="n">search_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-70"><a href="#DynamicMemoryIndex.from_file-70"><span class="linenos"> 70</span></a>        <span class="n">concurrent_consolidation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-71"><a href="#DynamicMemoryIndex.from_file-71"><span class="linenos"> 71</span></a>        <span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ann&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-72"><a href="#DynamicMemoryIndex.from_file-72"><span class="linenos"> 72</span></a>        <span class="n">distance_metric</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DistanceMetric</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-73"><a href="#DynamicMemoryIndex.from_file-73"><span class="linenos"> 73</span></a>        <span class="n">vector_dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-74"><a href="#DynamicMemoryIndex.from_file-74"><span class="linenos"> 74</span></a>        <span class="n">dimensions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-75"><a href="#DynamicMemoryIndex.from_file-75"><span class="linenos"> 75</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DynamicMemoryIndex&quot;</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.from_file-76"><a href="#DynamicMemoryIndex.from_file-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.from_file-77"><a href="#DynamicMemoryIndex.from_file-77"><span class="linenos"> 77</span></a><span class="sd">        The `from_file` classmethod is used to load a previously saved index from disk. This index *must* have been</span>
</span><span id="DynamicMemoryIndex.from_file-78"><a href="#DynamicMemoryIndex.from_file-78"><span class="linenos"> 78</span></a><span class="sd">        created with a valid `tags` file or `tags` np.ndarray of `diskannpy.VectorIdentifier`s. It is *strongly*</span>
</span><span id="DynamicMemoryIndex.from_file-79"><a href="#DynamicMemoryIndex.from_file-79"><span class="linenos"> 79</span></a><span class="sd">        recommended that you use the same parameters as the `diskannpy.build_memory_index()` function that created</span>
</span><span id="DynamicMemoryIndex.from_file-80"><a href="#DynamicMemoryIndex.from_file-80"><span class="linenos"> 80</span></a><span class="sd">        the index.</span>
</span><span id="DynamicMemoryIndex.from_file-81"><a href="#DynamicMemoryIndex.from_file-81"><span class="linenos"> 81</span></a>
</span><span id="DynamicMemoryIndex.from_file-82"><a href="#DynamicMemoryIndex.from_file-82"><span class="linenos"> 82</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex.from_file-83"><a href="#DynamicMemoryIndex.from_file-83"><span class="linenos"> 83</span></a><span class="sd">        - **index_directory**: The directory containing the index files. This directory must contain the following</span>
</span><span id="DynamicMemoryIndex.from_file-84"><a href="#DynamicMemoryIndex.from_file-84"><span class="linenos"> 84</span></a><span class="sd">            files:</span>
</span><span id="DynamicMemoryIndex.from_file-85"><a href="#DynamicMemoryIndex.from_file-85"><span class="linenos"> 85</span></a><span class="sd">            - `{index_prefix}.data`</span>
</span><span id="DynamicMemoryIndex.from_file-86"><a href="#DynamicMemoryIndex.from_file-86"><span class="linenos"> 86</span></a><span class="sd">            - `{index_prefix}.tags`</span>
</span><span id="DynamicMemoryIndex.from_file-87"><a href="#DynamicMemoryIndex.from_file-87"><span class="linenos"> 87</span></a><span class="sd">            - `{index_prefix}`</span>
</span><span id="DynamicMemoryIndex.from_file-88"><a href="#DynamicMemoryIndex.from_file-88"><span class="linenos"> 88</span></a>
</span><span id="DynamicMemoryIndex.from_file-89"><a href="#DynamicMemoryIndex.from_file-89"><span class="linenos"> 89</span></a><span class="sd">          It may also include the following optional files:</span>
</span><span id="DynamicMemoryIndex.from_file-90"><a href="#DynamicMemoryIndex.from_file-90"><span class="linenos"> 90</span></a><span class="sd">            - `{index_prefix}_vectors.bin`: Optional. `diskannpy` builder functions may create this file in the</span>
</span><span id="DynamicMemoryIndex.from_file-91"><a href="#DynamicMemoryIndex.from_file-91"><span class="linenos"> 91</span></a><span class="sd">              `index_directory` if the index was created from a numpy array</span>
</span><span id="DynamicMemoryIndex.from_file-92"><a href="#DynamicMemoryIndex.from_file-92"><span class="linenos"> 92</span></a><span class="sd">            - `{index_prefix}_metadata.bin`: Optional. `diskannpy` builder functions create this file to store metadata</span>
</span><span id="DynamicMemoryIndex.from_file-93"><a href="#DynamicMemoryIndex.from_file-93"><span class="linenos"> 93</span></a><span class="sd">            about the index, such as vector dtype, distance metric, number of vectors and vector dimensionality.</span>
</span><span id="DynamicMemoryIndex.from_file-94"><a href="#DynamicMemoryIndex.from_file-94"><span class="linenos"> 94</span></a><span class="sd">            If an index is built from the `diskann` cli tools, this file will not exist.</span>
</span><span id="DynamicMemoryIndex.from_file-95"><a href="#DynamicMemoryIndex.from_file-95"><span class="linenos"> 95</span></a><span class="sd">        - **max_vectors**: Capacity of the memory index including space for future insertions.</span>
</span><span id="DynamicMemoryIndex.from_file-96"><a href="#DynamicMemoryIndex.from_file-96"><span class="linenos"> 96</span></a><span class="sd">        - **complexity**: Complexity (a.k.a `L`) references the size of the list we store candidate approximate</span>
</span><span id="DynamicMemoryIndex.from_file-97"><a href="#DynamicMemoryIndex.from_file-97"><span class="linenos"> 97</span></a><span class="sd">          neighbors in. It&#39;s used during save (which is an index rebuild), and it&#39;s used as an initial search size to</span>
</span><span id="DynamicMemoryIndex.from_file-98"><a href="#DynamicMemoryIndex.from_file-98"><span class="linenos"> 98</span></a><span class="sd">          warm up our index and lower the latency for initial real searches.</span>
</span><span id="DynamicMemoryIndex.from_file-99"><a href="#DynamicMemoryIndex.from_file-99"><span class="linenos"> 99</span></a><span class="sd">        - **graph_degree**: Graph degree (a.k.a. `R`) is the maximum degree allowed for a node in the index&#39;s graph</span>
</span><span id="DynamicMemoryIndex.from_file-100"><a href="#DynamicMemoryIndex.from_file-100"><span class="linenos">100</span></a><span class="sd">          structure. This degree will be pruned throughout the course of the index build, but it will never grow beyond</span>
</span><span id="DynamicMemoryIndex.from_file-101"><a href="#DynamicMemoryIndex.from_file-101"><span class="linenos">101</span></a><span class="sd">          this value. Higher R values require longer index build times, but may result in an index showing excellent</span>
</span><span id="DynamicMemoryIndex.from_file-102"><a href="#DynamicMemoryIndex.from_file-102"><span class="linenos">102</span></a><span class="sd">          recall and latency characteristics.</span>
</span><span id="DynamicMemoryIndex.from_file-103"><a href="#DynamicMemoryIndex.from_file-103"><span class="linenos">103</span></a><span class="sd">        - **saturate_graph**: If True, the adjacency list of each node will be saturated with neighbors to have exactly</span>
</span><span id="DynamicMemoryIndex.from_file-104"><a href="#DynamicMemoryIndex.from_file-104"><span class="linenos">104</span></a><span class="sd">          `graph_degree` neighbors. If False, each node will have between 1 and `graph_degree` neighbors.</span>
</span><span id="DynamicMemoryIndex.from_file-105"><a href="#DynamicMemoryIndex.from_file-105"><span class="linenos">105</span></a><span class="sd">        - **max_occlusion_size**: The maximum number of points that can be considered by occlude_list function.</span>
</span><span id="DynamicMemoryIndex.from_file-106"><a href="#DynamicMemoryIndex.from_file-106"><span class="linenos">106</span></a><span class="sd">        - **alpha**: The alpha parameter (&gt;=1) is used to control the nature and number of points that are added to the</span>
</span><span id="DynamicMemoryIndex.from_file-107"><a href="#DynamicMemoryIndex.from_file-107"><span class="linenos">107</span></a><span class="sd">          graph. A higher alpha value (e.g., 1.4) will result in fewer hops (and IOs) to convergence, but probably</span>
</span><span id="DynamicMemoryIndex.from_file-108"><a href="#DynamicMemoryIndex.from_file-108"><span class="linenos">108</span></a><span class="sd">          more distance comparisons compared to a lower alpha value.</span>
</span><span id="DynamicMemoryIndex.from_file-109"><a href="#DynamicMemoryIndex.from_file-109"><span class="linenos">109</span></a><span class="sd">        - **num_threads**: Number of threads to use when creating this index. `0` indicates we should use all available</span>
</span><span id="DynamicMemoryIndex.from_file-110"><a href="#DynamicMemoryIndex.from_file-110"><span class="linenos">110</span></a><span class="sd">          logical processors.</span>
</span><span id="DynamicMemoryIndex.from_file-111"><a href="#DynamicMemoryIndex.from_file-111"><span class="linenos">111</span></a><span class="sd">        - **filter_complexity**: Complexity to use when using filters. Default is 0.</span>
</span><span id="DynamicMemoryIndex.from_file-112"><a href="#DynamicMemoryIndex.from_file-112"><span class="linenos">112</span></a><span class="sd">        - **num_frozen_points**: Number of points to freeze. Default is 1.</span>
</span><span id="DynamicMemoryIndex.from_file-113"><a href="#DynamicMemoryIndex.from_file-113"><span class="linenos">113</span></a><span class="sd">        - **initial_search_complexity**: Should be set to the most common `complexity` expected to be used during the</span>
</span><span id="DynamicMemoryIndex.from_file-114"><a href="#DynamicMemoryIndex.from_file-114"><span class="linenos">114</span></a><span class="sd">          life of this `diskannpy.DynamicMemoryIndex` object. The working scratch memory allocated is based off of</span>
</span><span id="DynamicMemoryIndex.from_file-115"><a href="#DynamicMemoryIndex.from_file-115"><span class="linenos">115</span></a><span class="sd">          `initial_search_complexity` * `search_threads`. Note that it may be resized if a `search` or `batch_search`</span>
</span><span id="DynamicMemoryIndex.from_file-116"><a href="#DynamicMemoryIndex.from_file-116"><span class="linenos">116</span></a><span class="sd">          operation requests a space larger than can be accommodated by these values.</span>
</span><span id="DynamicMemoryIndex.from_file-117"><a href="#DynamicMemoryIndex.from_file-117"><span class="linenos">117</span></a><span class="sd">        - **search_threads**: Should be set to the most common `num_threads` expected to be used during the</span>
</span><span id="DynamicMemoryIndex.from_file-118"><a href="#DynamicMemoryIndex.from_file-118"><span class="linenos">118</span></a><span class="sd">          life of this `diskannpy.DynamicMemoryIndex` object. The working scratch memory allocated is based off of</span>
</span><span id="DynamicMemoryIndex.from_file-119"><a href="#DynamicMemoryIndex.from_file-119"><span class="linenos">119</span></a><span class="sd">          `initial_search_complexity` * `search_threads`. Note that it may be resized if a `batch_search`</span>
</span><span id="DynamicMemoryIndex.from_file-120"><a href="#DynamicMemoryIndex.from_file-120"><span class="linenos">120</span></a><span class="sd">          operation requests a space larger than can be accommodated by these values.</span>
</span><span id="DynamicMemoryIndex.from_file-121"><a href="#DynamicMemoryIndex.from_file-121"><span class="linenos">121</span></a><span class="sd">        - **concurrent_consolidation**: This flag dictates whether consolidation can be run alongside inserts and</span>
</span><span id="DynamicMemoryIndex.from_file-122"><a href="#DynamicMemoryIndex.from_file-122"><span class="linenos">122</span></a><span class="sd">          deletes, or whether the index is locked down to changes while consolidation is ongoing.</span>
</span><span id="DynamicMemoryIndex.from_file-123"><a href="#DynamicMemoryIndex.from_file-123"><span class="linenos">123</span></a><span class="sd">        - **index_prefix**: The prefix of the index files. Defaults to &quot;ann&quot;.</span>
</span><span id="DynamicMemoryIndex.from_file-124"><a href="#DynamicMemoryIndex.from_file-124"><span class="linenos">124</span></a><span class="sd">        - **distance_metric**: A `str`, strictly one of {&quot;l2&quot;, &quot;mips&quot;, &quot;cosine&quot;}. `l2` and `cosine` are supported for all 3</span>
</span><span id="DynamicMemoryIndex.from_file-125"><a href="#DynamicMemoryIndex.from_file-125"><span class="linenos">125</span></a><span class="sd">          vector dtypes, but `mips` is only available for single precision floats. Default is `None`. **This</span>
</span><span id="DynamicMemoryIndex.from_file-126"><a href="#DynamicMemoryIndex.from_file-126"><span class="linenos">126</span></a><span class="sd">          value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it does not exist,</span>
</span><span id="DynamicMemoryIndex.from_file-127"><a href="#DynamicMemoryIndex.from_file-127"><span class="linenos">127</span></a><span class="sd">          you are required to provide it.</span>
</span><span id="DynamicMemoryIndex.from_file-128"><a href="#DynamicMemoryIndex.from_file-128"><span class="linenos">128</span></a><span class="sd">        - **vector_dtype**: The vector dtype this index has been built with. **This value is only used if a</span>
</span><span id="DynamicMemoryIndex.from_file-129"><a href="#DynamicMemoryIndex.from_file-129"><span class="linenos">129</span></a><span class="sd">          `{index_prefix}_metadata.bin` file does not exist.** If it does not exist, you are required to provide it.</span>
</span><span id="DynamicMemoryIndex.from_file-130"><a href="#DynamicMemoryIndex.from_file-130"><span class="linenos">130</span></a><span class="sd">        - **dimensions**: The vector dimensionality of this index. All new vectors inserted must be the same</span>
</span><span id="DynamicMemoryIndex.from_file-131"><a href="#DynamicMemoryIndex.from_file-131"><span class="linenos">131</span></a><span class="sd">          dimensionality. **This value is only used if a `{index_prefix}_metadata.bin` file does not exist.** If it</span>
</span><span id="DynamicMemoryIndex.from_file-132"><a href="#DynamicMemoryIndex.from_file-132"><span class="linenos">132</span></a><span class="sd">          does not exist, you are required to provide it.</span>
</span><span id="DynamicMemoryIndex.from_file-133"><a href="#DynamicMemoryIndex.from_file-133"><span class="linenos">133</span></a>
</span><span id="DynamicMemoryIndex.from_file-134"><a href="#DynamicMemoryIndex.from_file-134"><span class="linenos">134</span></a><span class="sd">        ### Returns</span>
</span><span id="DynamicMemoryIndex.from_file-135"><a href="#DynamicMemoryIndex.from_file-135"><span class="linenos">135</span></a><span class="sd">        A `diskannpy.DynamicMemoryIndex` object, with the index loaded from disk and ready to use for insertions,</span>
</span><span id="DynamicMemoryIndex.from_file-136"><a href="#DynamicMemoryIndex.from_file-136"><span class="linenos">136</span></a><span class="sd">        deletions, and searches.</span>
</span><span id="DynamicMemoryIndex.from_file-137"><a href="#DynamicMemoryIndex.from_file-137"><span class="linenos">137</span></a>
</span><span id="DynamicMemoryIndex.from_file-138"><a href="#DynamicMemoryIndex.from_file-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.from_file-139"><a href="#DynamicMemoryIndex.from_file-139"><span class="linenos">139</span></a>        <span class="n">index_prefix_path</span> <span class="o">=</span> <span class="n">_valid_index_prefix</span><span class="p">(</span><span class="n">index_directory</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.from_file-140"><a href="#DynamicMemoryIndex.from_file-140"><span class="linenos">140</span></a>
</span><span id="DynamicMemoryIndex.from_file-141"><a href="#DynamicMemoryIndex.from_file-141"><span class="linenos">141</span></a>        <span class="c1"># do tags exist?</span>
</span><span id="DynamicMemoryIndex.from_file-142"><a href="#DynamicMemoryIndex.from_file-142"><span class="linenos">142</span></a>        <span class="n">tags_file</span> <span class="o">=</span> <span class="n">index_prefix_path</span> <span class="o">+</span> <span class="s2">&quot;.tags&quot;</span>
</span><span id="DynamicMemoryIndex.from_file-143"><a href="#DynamicMemoryIndex.from_file-143"><span class="linenos">143</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.from_file-144"><a href="#DynamicMemoryIndex.from_file-144"><span class="linenos">144</span></a>            <span class="n">Path</span><span class="p">(</span><span class="n">tags_file</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">(),</span>
</span><span id="DynamicMemoryIndex.from_file-145"><a href="#DynamicMemoryIndex.from_file-145"><span class="linenos">145</span></a>            <span class="sa">f</span><span class="s2">&quot;The file </span><span class="si">{</span><span class="n">tags_file</span><span class="si">}</span><span class="s2"> does not exist in </span><span class="si">{</span><span class="n">index_directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-146"><a href="#DynamicMemoryIndex.from_file-146"><span class="linenos">146</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.from_file-147"><a href="#DynamicMemoryIndex.from_file-147"><span class="linenos">147</span></a>        <span class="n">vector_dtype</span><span class="p">,</span> <span class="n">dap_metric</span><span class="p">,</span> <span class="n">num_vectors</span><span class="p">,</span> <span class="n">dimensions</span> <span class="o">=</span> <span class="n">_ensure_index_metadata</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.from_file-148"><a href="#DynamicMemoryIndex.from_file-148"><span class="linenos">148</span></a>            <span class="n">index_prefix_path</span><span class="p">,</span> <span class="n">vector_dtype</span><span class="p">,</span> <span class="n">distance_metric</span><span class="p">,</span> <span class="n">max_vectors</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">warn_size_exceeded</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamicMemoryIndex.from_file-149"><a href="#DynamicMemoryIndex.from_file-149"><span class="linenos">149</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.from_file-150"><a href="#DynamicMemoryIndex.from_file-150"><span class="linenos">150</span></a>
</span><span id="DynamicMemoryIndex.from_file-151"><a href="#DynamicMemoryIndex.from_file-151"><span class="linenos">151</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.from_file-152"><a href="#DynamicMemoryIndex.from_file-152"><span class="linenos">152</span></a>            <span class="n">distance_metric</span><span class="o">=</span><span class="n">dap_metric</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
</span><span id="DynamicMemoryIndex.from_file-153"><a href="#DynamicMemoryIndex.from_file-153"><span class="linenos">153</span></a>            <span class="n">vector_dtype</span><span class="o">=</span><span class="n">vector_dtype</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-154"><a href="#DynamicMemoryIndex.from_file-154"><span class="linenos">154</span></a>            <span class="n">dimensions</span><span class="o">=</span><span class="n">dimensions</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-155"><a href="#DynamicMemoryIndex.from_file-155"><span class="linenos">155</span></a>            <span class="n">max_vectors</span><span class="o">=</span><span class="n">max_vectors</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-156"><a href="#DynamicMemoryIndex.from_file-156"><span class="linenos">156</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-157"><a href="#DynamicMemoryIndex.from_file-157"><span class="linenos">157</span></a>            <span class="n">graph_degree</span><span class="o">=</span><span class="n">graph_degree</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-158"><a href="#DynamicMemoryIndex.from_file-158"><span class="linenos">158</span></a>            <span class="n">saturate_graph</span><span class="o">=</span><span class="n">saturate_graph</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-159"><a href="#DynamicMemoryIndex.from_file-159"><span class="linenos">159</span></a>            <span class="n">max_occlusion_size</span><span class="o">=</span><span class="n">max_occlusion_size</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-160"><a href="#DynamicMemoryIndex.from_file-160"><span class="linenos">160</span></a>            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-161"><a href="#DynamicMemoryIndex.from_file-161"><span class="linenos">161</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-162"><a href="#DynamicMemoryIndex.from_file-162"><span class="linenos">162</span></a>            <span class="n">filter_complexity</span><span class="o">=</span><span class="n">filter_complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-163"><a href="#DynamicMemoryIndex.from_file-163"><span class="linenos">163</span></a>            <span class="n">num_frozen_points</span><span class="o">=</span><span class="n">num_frozen_points</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-164"><a href="#DynamicMemoryIndex.from_file-164"><span class="linenos">164</span></a>            <span class="n">initial_search_complexity</span><span class="o">=</span><span class="n">initial_search_complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-165"><a href="#DynamicMemoryIndex.from_file-165"><span class="linenos">165</span></a>            <span class="n">search_threads</span><span class="o">=</span><span class="n">search_threads</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-166"><a href="#DynamicMemoryIndex.from_file-166"><span class="linenos">166</span></a>            <span class="n">concurrent_consolidation</span><span class="o">=</span><span class="n">concurrent_consolidation</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.from_file-167"><a href="#DynamicMemoryIndex.from_file-167"><span class="linenos">167</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.from_file-168"><a href="#DynamicMemoryIndex.from_file-168"><span class="linenos">168</span></a>        <span class="n">index</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">index_prefix_path</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.from_file-169"><a href="#DynamicMemoryIndex.from_file-169"><span class="linenos">169</span></a>        <span class="n">index</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">=</span> <span class="n">num_vectors</span>  <span class="c1"># current number of vectors loaded</span>
</span><span id="DynamicMemoryIndex.from_file-170"><a href="#DynamicMemoryIndex.from_file-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="n">index</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#DynamicMemoryIndex.from_file">from_file</a></code> classmethod is used to load a previously saved index from disk. This index <em>must</em> have been
created with a valid <code>tags</code> file or <code>tags</code> np.ndarray of <code><a href="#VectorIdentifier">diskannpy.VectorIdentifier</a></code>s. It is <em>strongly</em>
recommended that you use the same parameters as the <code><a href="#build_memory_index">diskannpy.build_memory_index()</a></code> function that created
the index.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><p><strong>index_directory</strong>: The directory containing the index files. This directory must contain the following
  files:</p>

<ul>
<li><code>{index_prefix}.data</code></li>
<li><code>{index_prefix}.tags</code></li>
<li><code>{index_prefix}</code></li>
</ul>

<p>It may also include the following optional files:</p>

<ul>
<li><code>{index_prefix}_vectors.bin</code>: Optional. <code><a href="">diskannpy</a></code> builder functions may create this file in the
<code>index_directory</code> if the index was created from a numpy array</li>
<li><code>{index_prefix}_metadata.bin</code>: Optional. <code><a href="">diskannpy</a></code> builder functions create this file to store metadata
about the index, such as vector dtype, distance metric, number of vectors and vector dimensionality.
If an index is built from the <code>diskann</code> cli tools, this file will not exist.</li>
</ul></li>
<li><strong>max_vectors</strong>: Capacity of the memory index including space for future insertions.</li>
<li><strong>complexity</strong>: Complexity (a.k.a <code>L</code>) references the size of the list we store candidate approximate
neighbors in. It's used during save (which is an index rebuild), and it's used as an initial search size to
warm up our index and lower the latency for initial real searches.</li>
<li><strong>graph_degree</strong>: Graph degree (a.k.a. <code>R</code>) is the maximum degree allowed for a node in the index's graph
structure. This degree will be pruned throughout the course of the index build, but it will never grow beyond
this value. Higher R values require longer index build times, but may result in an index showing excellent
recall and latency characteristics.</li>
<li><strong>saturate_graph</strong>: If True, the adjacency list of each node will be saturated with neighbors to have exactly
<code>graph_degree</code> neighbors. If False, each node will have between 1 and <code>graph_degree</code> neighbors.</li>
<li><strong>max_occlusion_size</strong>: The maximum number of points that can be considered by occlude_list function.</li>
<li><strong>alpha</strong>: The alpha parameter (&gt;=1) is used to control the nature and number of points that are added to the
graph. A higher alpha value (e.g., 1.4) will result in fewer hops (and IOs) to convergence, but probably
more distance comparisons compared to a lower alpha value.</li>
<li><strong>num_threads</strong>: Number of threads to use when creating this index. <code>0</code> indicates we should use all available
logical processors.</li>
<li><strong>filter_complexity</strong>: Complexity to use when using filters. Default is 0.</li>
<li><strong>num_frozen_points</strong>: Number of points to freeze. Default is 1.</li>
<li><strong>initial_search_complexity</strong>: Should be set to the most common <code>complexity</code> expected to be used during the
life of this <code><a href="#DynamicMemoryIndex">diskannpy.DynamicMemoryIndex</a></code> object. The working scratch memory allocated is based off of
<code>initial_search_complexity</code> * <code>search_threads</code>. Note that it may be resized if a <code><a href="#DynamicMemoryIndex.search">search</a></code> or <code><a href="#DynamicMemoryIndex.batch_search">batch_search</a></code>
operation requests a space larger than can be accommodated by these values.</li>
<li><strong>search_threads</strong>: Should be set to the most common <code>num_threads</code> expected to be used during the
life of this <code><a href="#DynamicMemoryIndex">diskannpy.DynamicMemoryIndex</a></code> object. The working scratch memory allocated is based off of
<code>initial_search_complexity</code> * <code>search_threads</code>. Note that it may be resized if a <code><a href="#DynamicMemoryIndex.batch_search">batch_search</a></code>
operation requests a space larger than can be accommodated by these values.</li>
<li><strong>concurrent_consolidation</strong>: This flag dictates whether consolidation can be run alongside inserts and
deletes, or whether the index is locked down to changes while consolidation is ongoing.</li>
<li><strong>index_prefix</strong>: The prefix of the index files. Defaults to "ann".</li>
<li><strong>distance_metric</strong>: A <code>str</code>, strictly one of {"l2", "mips", "cosine"}. <code>l2</code> and <code>cosine</code> are supported for all 3
vector dtypes, but <code>mips</code> is only available for single precision floats. Default is <code>None</code>. <strong>This
value is only used if a <code>{index_prefix}_metadata.bin</code> file does not exist.</strong> If it does not exist,
you are required to provide it.</li>
<li><strong>vector_dtype</strong>: The vector dtype this index has been built with. <strong>This value is only used if a
<code>{index_prefix}_metadata.bin</code> file does not exist.</strong> If it does not exist, you are required to provide it.</li>
<li><strong>dimensions</strong>: The vector dimensionality of this index. All new vectors inserted must be the same
dimensionality. <strong>This value is only used if a <code>{index_prefix}_metadata.bin</code> file does not exist.</strong> If it
does not exist, you are required to provide it.</li>
</ul>

<h3 id="returns">Returns</h3>

<p>A <code><a href="#DynamicMemoryIndex">diskannpy.DynamicMemoryIndex</a></code> object, with the index loaded from disk and ready to use for insertions,
deletions, and searches.</p>
</div>


                            </div>
                            <div id="DynamicMemoryIndex.search" class="classattr">
                                        <input id="DynamicMemoryIndex.search-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">search</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">query</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]</span>,</span><span class="param">	<span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#QueryResponse">QueryResponse</a></span>:</span></span>

                <label class="view-source-button" for="DynamicMemoryIndex.search-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamicMemoryIndex.search"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamicMemoryIndex.search-285"><a href="#DynamicMemoryIndex.search-285"><span class="linenos">285</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.search-286"><a href="#DynamicMemoryIndex.search-286"><span class="linenos">286</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">VectorLike</span><span class="p">,</span> <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="DynamicMemoryIndex.search-287"><a href="#DynamicMemoryIndex.search-287"><span class="linenos">287</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponse</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.search-288"><a href="#DynamicMemoryIndex.search-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.search-289"><a href="#DynamicMemoryIndex.search-289"><span class="linenos">289</span></a><span class="sd">        Searches the index by a single query vector.</span>
</span><span id="DynamicMemoryIndex.search-290"><a href="#DynamicMemoryIndex.search-290"><span class="linenos">290</span></a>
</span><span id="DynamicMemoryIndex.search-291"><a href="#DynamicMemoryIndex.search-291"><span class="linenos">291</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex.search-292"><a href="#DynamicMemoryIndex.search-292"><span class="linenos">292</span></a><span class="sd">        - **query**: 1d numpy array of the same dimensionality and dtype of the index.</span>
</span><span id="DynamicMemoryIndex.search-293"><a href="#DynamicMemoryIndex.search-293"><span class="linenos">293</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="DynamicMemoryIndex.search-294"><a href="#DynamicMemoryIndex.search-294"><span class="linenos">294</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="DynamicMemoryIndex.search-295"><a href="#DynamicMemoryIndex.search-295"><span class="linenos">295</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="DynamicMemoryIndex.search-296"><a href="#DynamicMemoryIndex.search-296"><span class="linenos">296</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="DynamicMemoryIndex.search-297"><a href="#DynamicMemoryIndex.search-297"><span class="linenos">297</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.search-298"><a href="#DynamicMemoryIndex.search-298"><span class="linenos">298</span></a>        <span class="n">_query</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.search-299"><a href="#DynamicMemoryIndex.search-299"><span class="linenos">299</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;query vector must be 1-d&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.search-300"><a href="#DynamicMemoryIndex.search-300"><span class="linenos">300</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.search-301"><a href="#DynamicMemoryIndex.search-301"><span class="linenos">301</span></a>            <span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.search-302"><a href="#DynamicMemoryIndex.search-302"><span class="linenos">302</span></a>            <span class="sa">f</span><span class="s2">&quot;query vector must have the same dimensionality as the index; index dimensionality: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="DynamicMemoryIndex.search-303"><a href="#DynamicMemoryIndex.search-303"><span class="linenos">303</span></a>            <span class="sa">f</span><span class="s2">&quot;query dimensionality: </span><span class="si">{</span><span class="n">_query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.search-304"><a href="#DynamicMemoryIndex.search-304"><span class="linenos">304</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.search-305"><a href="#DynamicMemoryIndex.search-305"><span class="linenos">305</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.search-306"><a href="#DynamicMemoryIndex.search-306"><span class="linenos">306</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.search-307"><a href="#DynamicMemoryIndex.search-307"><span class="linenos">307</span></a>
</span><span id="DynamicMemoryIndex.search-308"><a href="#DynamicMemoryIndex.search-308"><span class="linenos">308</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.search-309"><a href="#DynamicMemoryIndex.search-309"><span class="linenos">309</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.search-310"><a href="#DynamicMemoryIndex.search-310"><span class="linenos">310</span></a>                <span class="sa">f</span><span class="s2">&quot;k_neighbors=</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2"> asked for, but list_size=</span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DynamicMemoryIndex.search-311"><a href="#DynamicMemoryIndex.search-311"><span class="linenos">311</span></a>            <span class="p">)</span>
</span><span id="DynamicMemoryIndex.search-312"><a href="#DynamicMemoryIndex.search-312"><span class="linenos">312</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="DynamicMemoryIndex.search-313"><a href="#DynamicMemoryIndex.search-313"><span class="linenos">313</span></a>        <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">_query</span><span class="p">,</span> <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.search-314"><a href="#DynamicMemoryIndex.search-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="n">QueryResponse</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Searches the index by a single query vector.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>query</strong>: 1d numpy array of the same dimensionality and dtype of the index.</li>
<li><strong>k_neighbors</strong>: Number of neighbors to be returned. If query vector exists in index, it almost definitely
will be returned as well, so adjust your <code>k_neighbors</code> as appropriate. Must be &gt; 0.</li>
<li><strong>complexity</strong>: Size of distance ordered list of candidate neighbors to use while searching. List size
increases accuracy at the cost of latency. Must be at least k_neighbors in size.</li>
</ul>
</div>


                            </div>
                            <div id="DynamicMemoryIndex.batch_search" class="classattr">
                                        <input id="DynamicMemoryIndex.batch_search-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">batch_search</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">queries</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]</span>,</span><span class="param">	<span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#QueryResponseBatch">QueryResponseBatch</a></span>:</span></span>

                <label class="view-source-button" for="DynamicMemoryIndex.batch_search-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamicMemoryIndex.batch_search"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamicMemoryIndex.batch_search-316"><a href="#DynamicMemoryIndex.batch_search-316"><span class="linenos">316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_search</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.batch_search-317"><a href="#DynamicMemoryIndex.batch_search-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-318"><a href="#DynamicMemoryIndex.batch_search-318"><span class="linenos">318</span></a>        <span class="n">queries</span><span class="p">:</span> <span class="n">VectorLikeBatch</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-319"><a href="#DynamicMemoryIndex.batch_search-319"><span class="linenos">319</span></a>        <span class="n">k_neighbors</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-320"><a href="#DynamicMemoryIndex.batch_search-320"><span class="linenos">320</span></a>        <span class="n">complexity</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-321"><a href="#DynamicMemoryIndex.batch_search-321"><span class="linenos">321</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-322"><a href="#DynamicMemoryIndex.batch_search-322"><span class="linenos">322</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryResponseBatch</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.batch_search-323"><a href="#DynamicMemoryIndex.batch_search-323"><span class="linenos">323</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.batch_search-324"><a href="#DynamicMemoryIndex.batch_search-324"><span class="linenos">324</span></a><span class="sd">        Searches the index by a batch of query vectors.</span>
</span><span id="DynamicMemoryIndex.batch_search-325"><a href="#DynamicMemoryIndex.batch_search-325"><span class="linenos">325</span></a>
</span><span id="DynamicMemoryIndex.batch_search-326"><a href="#DynamicMemoryIndex.batch_search-326"><span class="linenos">326</span></a><span class="sd">        This search is parallelized and far more efficient than searching for each vector individually.</span>
</span><span id="DynamicMemoryIndex.batch_search-327"><a href="#DynamicMemoryIndex.batch_search-327"><span class="linenos">327</span></a>
</span><span id="DynamicMemoryIndex.batch_search-328"><a href="#DynamicMemoryIndex.batch_search-328"><span class="linenos">328</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex.batch_search-329"><a href="#DynamicMemoryIndex.batch_search-329"><span class="linenos">329</span></a><span class="sd">        - **queries**: 2d numpy array, with column dimensionality matching the index and row dimensionality being the</span>
</span><span id="DynamicMemoryIndex.batch_search-330"><a href="#DynamicMemoryIndex.batch_search-330"><span class="linenos">330</span></a><span class="sd">          number of queries intended to search for in parallel. Dtype must match dtype of the index.</span>
</span><span id="DynamicMemoryIndex.batch_search-331"><a href="#DynamicMemoryIndex.batch_search-331"><span class="linenos">331</span></a><span class="sd">        - **k_neighbors**: Number of neighbors to be returned. If query vector exists in index, it almost definitely</span>
</span><span id="DynamicMemoryIndex.batch_search-332"><a href="#DynamicMemoryIndex.batch_search-332"><span class="linenos">332</span></a><span class="sd">          will be returned as well, so adjust your ``k_neighbors`` as appropriate. Must be &gt; 0.</span>
</span><span id="DynamicMemoryIndex.batch_search-333"><a href="#DynamicMemoryIndex.batch_search-333"><span class="linenos">333</span></a><span class="sd">        - **complexity**: Size of distance ordered list of candidate neighbors to use while searching. List size</span>
</span><span id="DynamicMemoryIndex.batch_search-334"><a href="#DynamicMemoryIndex.batch_search-334"><span class="linenos">334</span></a><span class="sd">          increases accuracy at the cost of latency. Must be at least k_neighbors in size.</span>
</span><span id="DynamicMemoryIndex.batch_search-335"><a href="#DynamicMemoryIndex.batch_search-335"><span class="linenos">335</span></a><span class="sd">        - **num_threads**: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="DynamicMemoryIndex.batch_search-336"><a href="#DynamicMemoryIndex.batch_search-336"><span class="linenos">336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.batch_search-337"><a href="#DynamicMemoryIndex.batch_search-337"><span class="linenos">337</span></a>        <span class="n">_queries</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_search-338"><a href="#DynamicMemoryIndex.batch_search-338"><span class="linenos">338</span></a>        <span class="n">_assert_2d</span><span class="p">(</span><span class="n">_queries</span><span class="p">,</span> <span class="s2">&quot;queries&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_search-339"><a href="#DynamicMemoryIndex.batch_search-339"><span class="linenos">339</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.batch_search-340"><a href="#DynamicMemoryIndex.batch_search-340"><span class="linenos">340</span></a>            <span class="n">_queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-341"><a href="#DynamicMemoryIndex.batch_search-341"><span class="linenos">341</span></a>            <span class="sa">f</span><span class="s2">&quot;query vectors must have the same dimensionality as the index; index dimensionality: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="si">}</span><span class="s2">, &quot;</span>
</span><span id="DynamicMemoryIndex.batch_search-342"><a href="#DynamicMemoryIndex.batch_search-342"><span class="linenos">342</span></a>            <span class="sa">f</span><span class="s2">&quot;query dimensionality: </span><span class="si">{</span><span class="n">_queries</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-343"><a href="#DynamicMemoryIndex.batch_search-343"><span class="linenos">343</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_search-344"><a href="#DynamicMemoryIndex.batch_search-344"><span class="linenos">344</span></a>
</span><span id="DynamicMemoryIndex.batch_search-345"><a href="#DynamicMemoryIndex.batch_search-345"><span class="linenos">345</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">k_neighbors</span><span class="p">,</span> <span class="s2">&quot;k_neighbors&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_search-346"><a href="#DynamicMemoryIndex.batch_search-346"><span class="linenos">346</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">complexity</span><span class="p">,</span> <span class="s2">&quot;complexity&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_search-347"><a href="#DynamicMemoryIndex.batch_search-347"><span class="linenos">347</span></a>        <span class="n">_assert_is_nonnegative_uint32</span><span class="p">(</span><span class="n">num_threads</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_search-348"><a href="#DynamicMemoryIndex.batch_search-348"><span class="linenos">348</span></a>
</span><span id="DynamicMemoryIndex.batch_search-349"><a href="#DynamicMemoryIndex.batch_search-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="n">k_neighbors</span> <span class="o">&gt;</span> <span class="n">complexity</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.batch_search-350"><a href="#DynamicMemoryIndex.batch_search-350"><span class="linenos">350</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.batch_search-351"><a href="#DynamicMemoryIndex.batch_search-351"><span class="linenos">351</span></a>                <span class="sa">f</span><span class="s2">&quot;k_neighbors=</span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2"> asked for, but list_size=</span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> was smaller. Increasing </span><span class="si">{</span><span class="n">complexity</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">k_neighbors</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DynamicMemoryIndex.batch_search-352"><a href="#DynamicMemoryIndex.batch_search-352"><span class="linenos">352</span></a>            <span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_search-353"><a href="#DynamicMemoryIndex.batch_search-353"><span class="linenos">353</span></a>            <span class="n">complexity</span> <span class="o">=</span> <span class="n">k_neighbors</span>
</span><span id="DynamicMemoryIndex.batch_search-354"><a href="#DynamicMemoryIndex.batch_search-354"><span class="linenos">354</span></a>
</span><span id="DynamicMemoryIndex.batch_search-355"><a href="#DynamicMemoryIndex.batch_search-355"><span class="linenos">355</span></a>        <span class="n">num_queries</span><span class="p">,</span> <span class="n">dim</span> <span class="o">=</span> <span class="n">queries</span><span class="o">.</span><span class="n">shape</span>
</span><span id="DynamicMemoryIndex.batch_search-356"><a href="#DynamicMemoryIndex.batch_search-356"><span class="linenos">356</span></a>        <span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">batch_search</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.batch_search-357"><a href="#DynamicMemoryIndex.batch_search-357"><span class="linenos">357</span></a>            <span class="n">queries</span><span class="o">=</span><span class="n">_queries</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-358"><a href="#DynamicMemoryIndex.batch_search-358"><span class="linenos">358</span></a>            <span class="n">num_queries</span><span class="o">=</span><span class="n">num_queries</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-359"><a href="#DynamicMemoryIndex.batch_search-359"><span class="linenos">359</span></a>            <span class="n">knn</span><span class="o">=</span><span class="n">k_neighbors</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-360"><a href="#DynamicMemoryIndex.batch_search-360"><span class="linenos">360</span></a>            <span class="n">complexity</span><span class="o">=</span><span class="n">complexity</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-361"><a href="#DynamicMemoryIndex.batch_search-361"><span class="linenos">361</span></a>            <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_search-362"><a href="#DynamicMemoryIndex.batch_search-362"><span class="linenos">362</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_search-363"><a href="#DynamicMemoryIndex.batch_search-363"><span class="linenos">363</span></a>        <span class="k">return</span> <span class="n">QueryResponseBatch</span><span class="p">(</span><span class="n">identifiers</span><span class="o">=</span><span class="n">neighbors</span><span class="p">,</span> <span class="n">distances</span><span class="o">=</span><span class="n">distances</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Searches the index by a batch of query vectors.</p>

<p>This search is parallelized and far more efficient than searching for each vector individually.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>queries</strong>: 2d numpy array, with column dimensionality matching the index and row dimensionality being the
number of queries intended to search for in parallel. Dtype must match dtype of the index.</li>
<li><strong>k_neighbors</strong>: Number of neighbors to be returned. If query vector exists in index, it almost definitely
will be returned as well, so adjust your <code>k_neighbors</code> as appropriate. Must be &gt; 0.</li>
<li><strong>complexity</strong>: Size of distance ordered list of candidate neighbors to use while searching. List size
increases accuracy at the cost of latency. Must be at least k_neighbors in size.</li>
<li><strong>num_threads</strong>: Number of threads to use when searching this index. (&gt;= 0), 0 = num_threads in system</li>
</ul>
</div>


                            </div>
                            <div id="DynamicMemoryIndex.save" class="classattr">
                                        <input id="DynamicMemoryIndex.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ann&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamicMemoryIndex.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamicMemoryIndex.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamicMemoryIndex.save-365"><a href="#DynamicMemoryIndex.save-365"><span class="linenos">365</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ann&quot;</span><span class="p">):</span>
</span><span id="DynamicMemoryIndex.save-366"><a href="#DynamicMemoryIndex.save-366"><span class="linenos">366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.save-367"><a href="#DynamicMemoryIndex.save-367"><span class="linenos">367</span></a><span class="sd">        Saves this index to file.</span>
</span><span id="DynamicMemoryIndex.save-368"><a href="#DynamicMemoryIndex.save-368"><span class="linenos">368</span></a>
</span><span id="DynamicMemoryIndex.save-369"><a href="#DynamicMemoryIndex.save-369"><span class="linenos">369</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex.save-370"><a href="#DynamicMemoryIndex.save-370"><span class="linenos">370</span></a><span class="sd">        - **save_path**: The path to save these index files to.</span>
</span><span id="DynamicMemoryIndex.save-371"><a href="#DynamicMemoryIndex.save-371"><span class="linenos">371</span></a><span class="sd">        - **index_prefix**: The prefix of the index files. Defaults to &quot;ann&quot;.</span>
</span><span id="DynamicMemoryIndex.save-372"><a href="#DynamicMemoryIndex.save-372"><span class="linenos">372</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.save-373"><a href="#DynamicMemoryIndex.save-373"><span class="linenos">373</span></a>        <span class="k">if</span> <span class="n">save_path</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.save-374"><a href="#DynamicMemoryIndex.save-374"><span class="linenos">374</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;save_path cannot be empty&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.save-375"><a href="#DynamicMemoryIndex.save-375"><span class="linenos">375</span></a>        <span class="k">if</span> <span class="n">index_prefix</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.save-376"><a href="#DynamicMemoryIndex.save-376"><span class="linenos">376</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;index_prefix cannot be empty&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.save-377"><a href="#DynamicMemoryIndex.save-377"><span class="linenos">377</span></a>
</span><span id="DynamicMemoryIndex.save-378"><a href="#DynamicMemoryIndex.save-378"><span class="linenos">378</span></a>        <span class="n">index_prefix</span> <span class="o">=</span> <span class="n">index_prefix</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">complexity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_complexity</span><span class="p">,</span> <span class="n">graph_degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_graph_degree</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.save-379"><a href="#DynamicMemoryIndex.save-379"><span class="linenos">379</span></a>        <span class="n">_assert_existing_directory</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;save_path&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.save-380"><a href="#DynamicMemoryIndex.save-380"><span class="linenos">380</span></a>        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">index_prefix</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.save-381"><a href="#DynamicMemoryIndex.save-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_points_deleted</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.save-382"><a href="#DynamicMemoryIndex.save-382"><span class="linenos">382</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.save-383"><a href="#DynamicMemoryIndex.save-383"><span class="linenos">383</span></a>                <span class="s2">&quot;DynamicMemoryIndex.save() currently requires DynamicMemoryIndex.consolidate_delete() to be called &quot;</span>
</span><span id="DynamicMemoryIndex.save-384"><a href="#DynamicMemoryIndex.save-384"><span class="linenos">384</span></a>                <span class="s2">&quot;prior to save when items have been marked for deletion. This is being done automatically now, though&quot;</span>
</span><span id="DynamicMemoryIndex.save-385"><a href="#DynamicMemoryIndex.save-385"><span class="linenos">385</span></a>                <span class="s2">&quot;it will increase the time it takes to save; on large sets of data it can take a substantial amount of &quot;</span>
</span><span id="DynamicMemoryIndex.save-386"><a href="#DynamicMemoryIndex.save-386"><span class="linenos">386</span></a>                <span class="s2">&quot;time. In the future, we will implement a faster save with unconsolidated deletes, but for now this is &quot;</span>
</span><span id="DynamicMemoryIndex.save-387"><a href="#DynamicMemoryIndex.save-387"><span class="linenos">387</span></a>                <span class="s2">&quot;required.&quot;</span>
</span><span id="DynamicMemoryIndex.save-388"><a href="#DynamicMemoryIndex.save-388"><span class="linenos">388</span></a>            <span class="p">)</span>
</span><span id="DynamicMemoryIndex.save-389"><a href="#DynamicMemoryIndex.save-389"><span class="linenos">389</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">consolidate_delete</span><span class="p">()</span>
</span><span id="DynamicMemoryIndex.save-390"><a href="#DynamicMemoryIndex.save-390"><span class="linenos">390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.save-391"><a href="#DynamicMemoryIndex.save-391"><span class="linenos">391</span></a>            <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">compact_before_save</span><span class="o">=</span><span class="kc">True</span>
</span><span id="DynamicMemoryIndex.save-392"><a href="#DynamicMemoryIndex.save-392"><span class="linenos">392</span></a>        <span class="p">)</span>  <span class="c1"># we do not yet support uncompacted saves</span>
</span><span id="DynamicMemoryIndex.save-393"><a href="#DynamicMemoryIndex.save-393"><span class="linenos">393</span></a>        <span class="n">_write_index_metadata</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.save-394"><a href="#DynamicMemoryIndex.save-394"><span class="linenos">394</span></a>            <span class="n">save_path</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.save-395"><a href="#DynamicMemoryIndex.save-395"><span class="linenos">395</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.save-396"><a href="#DynamicMemoryIndex.save-396"><span class="linenos">396</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dap_metric</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.save-397"><a href="#DynamicMemoryIndex.save-397"><span class="linenos">397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">num_points</span><span class="p">(),</span>
</span><span id="DynamicMemoryIndex.save-398"><a href="#DynamicMemoryIndex.save-398"><span class="linenos">398</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_dimensions</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.save-399"><a href="#DynamicMemoryIndex.save-399"><span class="linenos">399</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Saves this index to file.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>save_path</strong>: The path to save these index files to.</li>
<li><strong>index_prefix</strong>: The prefix of the index files. Defaults to "ann".</li>
</ul>
</div>


                            </div>
                            <div id="DynamicMemoryIndex.insert" class="classattr">
                                        <input id="DynamicMemoryIndex.insert-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">insert</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vector</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]</span>,</span><span class="param">	<span class="n">vector_id</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamicMemoryIndex.insert-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamicMemoryIndex.insert"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamicMemoryIndex.insert-401"><a href="#DynamicMemoryIndex.insert-401"><span class="linenos">401</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">VectorLike</span><span class="p">,</span> <span class="n">vector_id</span><span class="p">:</span> <span class="n">VectorIdentifier</span><span class="p">):</span>
</span><span id="DynamicMemoryIndex.insert-402"><a href="#DynamicMemoryIndex.insert-402"><span class="linenos">402</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.insert-403"><a href="#DynamicMemoryIndex.insert-403"><span class="linenos">403</span></a><span class="sd">        Inserts a single vector into the index with the provided vector_id.</span>
</span><span id="DynamicMemoryIndex.insert-404"><a href="#DynamicMemoryIndex.insert-404"><span class="linenos">404</span></a>
</span><span id="DynamicMemoryIndex.insert-405"><a href="#DynamicMemoryIndex.insert-405"><span class="linenos">405</span></a><span class="sd">        If this insertion will overrun the `max_vectors` count boundaries of this index, `consolidate_delete()` will</span>
</span><span id="DynamicMemoryIndex.insert-406"><a href="#DynamicMemoryIndex.insert-406"><span class="linenos">406</span></a><span class="sd">        be executed automatically.</span>
</span><span id="DynamicMemoryIndex.insert-407"><a href="#DynamicMemoryIndex.insert-407"><span class="linenos">407</span></a>
</span><span id="DynamicMemoryIndex.insert-408"><a href="#DynamicMemoryIndex.insert-408"><span class="linenos">408</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex.insert-409"><a href="#DynamicMemoryIndex.insert-409"><span class="linenos">409</span></a><span class="sd">        - **vector**: The vector to insert. Note that dtype must match.</span>
</span><span id="DynamicMemoryIndex.insert-410"><a href="#DynamicMemoryIndex.insert-410"><span class="linenos">410</span></a><span class="sd">        - **vector_id**: The vector_id to use for this vector.</span>
</span><span id="DynamicMemoryIndex.insert-411"><a href="#DynamicMemoryIndex.insert-411"><span class="linenos">411</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.insert-412"><a href="#DynamicMemoryIndex.insert-412"><span class="linenos">412</span></a>        <span class="n">_vector</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.insert-413"><a href="#DynamicMemoryIndex.insert-413"><span class="linenos">413</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;insert vector must be 1-d&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.insert-414"><a href="#DynamicMemoryIndex.insert-414"><span class="linenos">414</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">vector_id</span><span class="p">,</span> <span class="s2">&quot;vector_id&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.insert-415"><a href="#DynamicMemoryIndex.insert-415"><span class="linenos">415</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.insert-416"><a href="#DynamicMemoryIndex.insert-416"><span class="linenos">416</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.insert-417"><a href="#DynamicMemoryIndex.insert-417"><span class="linenos">417</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserting this vector would overrun the max_vectors=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="si">}</span><span class="s2"> specified at index &quot;</span>
</span><span id="DynamicMemoryIndex.insert-418"><a href="#DynamicMemoryIndex.insert-418"><span class="linenos">418</span></a>                              <span class="sa">f</span><span class="s2">&quot;construction. We are attempting to consolidate_delete() to make space.&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.insert-419"><a href="#DynamicMemoryIndex.insert-419"><span class="linenos">419</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">consolidate_delete</span><span class="p">()</span>
</span><span id="DynamicMemoryIndex.insert-420"><a href="#DynamicMemoryIndex.insert-420"><span class="linenos">420</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.insert-421"><a href="#DynamicMemoryIndex.insert-421"><span class="linenos">421</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserting this vector would overrun the max_vectors=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="si">}</span><span class="s2"> specified &quot;</span>
</span><span id="DynamicMemoryIndex.insert-422"><a href="#DynamicMemoryIndex.insert-422"><span class="linenos">422</span></a>                                   <span class="sa">f</span><span class="s2">&quot;at index construction. Unable to make space by consolidating deletions. The insert&quot;</span>
</span><span id="DynamicMemoryIndex.insert-423"><a href="#DynamicMemoryIndex.insert-423"><span class="linenos">423</span></a>                                   <span class="sa">f</span><span class="s2">&quot;operation has failed.&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.insert-424"><a href="#DynamicMemoryIndex.insert-424"><span class="linenos">424</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">_vector</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="n">vector_id</span><span class="p">))</span>
</span><span id="DynamicMemoryIndex.insert-425"><a href="#DynamicMemoryIndex.insert-425"><span class="linenos">425</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.insert-426"><a href="#DynamicMemoryIndex.insert-426"><span class="linenos">426</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DynamicMemoryIndex.insert-427"><a href="#DynamicMemoryIndex.insert-427"><span class="linenos">427</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.insert-428"><a href="#DynamicMemoryIndex.insert-428"><span class="linenos">428</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.insert-429"><a href="#DynamicMemoryIndex.insert-429"><span class="linenos">429</span></a>                <span class="sa">f</span><span class="s2">&quot;Insert was unable to complete successfully; error code returned from diskann C++ lib: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="DynamicMemoryIndex.insert-430"><a href="#DynamicMemoryIndex.insert-430"><span class="linenos">430</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Inserts a single vector into the index with the provided vector_id.</p>

<p>If this insertion will overrun the <code>max_vectors</code> count boundaries of this index, <code><a href="#DynamicMemoryIndex.consolidate_delete">consolidate_delete()</a></code> will
be executed automatically.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>vector</strong>: The vector to insert. Note that dtype must match.</li>
<li><strong>vector_id</strong>: The vector_id to use for this vector.</li>
</ul>
</div>


                            </div>
                            <div id="DynamicMemoryIndex.batch_insert" class="classattr">
                                        <input id="DynamicMemoryIndex.batch_insert-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">batch_insert</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vectors</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]</span>,</span><span class="param">	<span class="n">vector_ids</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">]]</span>,</span><span class="param">	<span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamicMemoryIndex.batch_insert-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamicMemoryIndex.batch_insert"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamicMemoryIndex.batch_insert-433"><a href="#DynamicMemoryIndex.batch_insert-433"><span class="linenos">433</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">batch_insert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.batch_insert-434"><a href="#DynamicMemoryIndex.batch_insert-434"><span class="linenos">434</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_insert-435"><a href="#DynamicMemoryIndex.batch_insert-435"><span class="linenos">435</span></a>        <span class="n">vectors</span><span class="p">:</span> <span class="n">VectorLikeBatch</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_insert-436"><a href="#DynamicMemoryIndex.batch_insert-436"><span class="linenos">436</span></a>        <span class="n">vector_ids</span><span class="p">:</span> <span class="n">VectorIdentifierBatch</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_insert-437"><a href="#DynamicMemoryIndex.batch_insert-437"><span class="linenos">437</span></a>        <span class="n">num_threads</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_insert-438"><a href="#DynamicMemoryIndex.batch_insert-438"><span class="linenos">438</span></a>    <span class="p">):</span>
</span><span id="DynamicMemoryIndex.batch_insert-439"><a href="#DynamicMemoryIndex.batch_insert-439"><span class="linenos">439</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.batch_insert-440"><a href="#DynamicMemoryIndex.batch_insert-440"><span class="linenos">440</span></a><span class="sd">        Inserts a batch of vectors into the index with the provided vector_ids.</span>
</span><span id="DynamicMemoryIndex.batch_insert-441"><a href="#DynamicMemoryIndex.batch_insert-441"><span class="linenos">441</span></a>
</span><span id="DynamicMemoryIndex.batch_insert-442"><a href="#DynamicMemoryIndex.batch_insert-442"><span class="linenos">442</span></a><span class="sd">        If this batch insertion will overrun the `max_vectors` count boundaries of this index, `consolidate_delete()`</span>
</span><span id="DynamicMemoryIndex.batch_insert-443"><a href="#DynamicMemoryIndex.batch_insert-443"><span class="linenos">443</span></a><span class="sd">        will be executed automatically.</span>
</span><span id="DynamicMemoryIndex.batch_insert-444"><a href="#DynamicMemoryIndex.batch_insert-444"><span class="linenos">444</span></a>
</span><span id="DynamicMemoryIndex.batch_insert-445"><a href="#DynamicMemoryIndex.batch_insert-445"><span class="linenos">445</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex.batch_insert-446"><a href="#DynamicMemoryIndex.batch_insert-446"><span class="linenos">446</span></a><span class="sd">        - **vectors**: The 2d numpy array of vectors to insert.</span>
</span><span id="DynamicMemoryIndex.batch_insert-447"><a href="#DynamicMemoryIndex.batch_insert-447"><span class="linenos">447</span></a><span class="sd">        - **vector_ids**: The 1d array of vector ids to use. This array must have the same number of elements as</span>
</span><span id="DynamicMemoryIndex.batch_insert-448"><a href="#DynamicMemoryIndex.batch_insert-448"><span class="linenos">448</span></a><span class="sd">            the vectors array has rows. The dtype of vector_ids must be `np.uint32`</span>
</span><span id="DynamicMemoryIndex.batch_insert-449"><a href="#DynamicMemoryIndex.batch_insert-449"><span class="linenos">449</span></a><span class="sd">        - **num_threads**: Number of threads to use when inserting into this index. (&gt;= 0), 0 = num_threads in system</span>
</span><span id="DynamicMemoryIndex.batch_insert-450"><a href="#DynamicMemoryIndex.batch_insert-450"><span class="linenos">450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.batch_insert-451"><a href="#DynamicMemoryIndex.batch_insert-451"><span class="linenos">451</span></a>        <span class="n">_query</span> <span class="o">=</span> <span class="n">_castable_dtype_or_raise</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="n">expected</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-452"><a href="#DynamicMemoryIndex.batch_insert-452"><span class="linenos">452</span></a>        <span class="n">_assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;vectors must be a 2-d array&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-453"><a href="#DynamicMemoryIndex.batch_insert-453"><span class="linenos">453</span></a>        <span class="n">_assert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.batch_insert-454"><a href="#DynamicMemoryIndex.batch_insert-454"><span class="linenos">454</span></a>            <span class="n">vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="DynamicMemoryIndex.batch_insert-455"><a href="#DynamicMemoryIndex.batch_insert-455"><span class="linenos">455</span></a>            <span class="s2">&quot;Number of vectors must be equal to number of ids&quot;</span><span class="p">,</span>
</span><span id="DynamicMemoryIndex.batch_insert-456"><a href="#DynamicMemoryIndex.batch_insert-456"><span class="linenos">456</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-457"><a href="#DynamicMemoryIndex.batch_insert-457"><span class="linenos">457</span></a>        <span class="n">_vectors</span> <span class="o">=</span> <span class="n">vectors</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_dtype</span><span class="p">,</span> <span class="n">casting</span><span class="o">=</span><span class="s2">&quot;safe&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-458"><a href="#DynamicMemoryIndex.batch_insert-458"><span class="linenos">458</span></a>        <span class="n">_vector_ids</span> <span class="o">=</span> <span class="n">vector_ids</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">,</span> <span class="n">casting</span><span class="o">=</span><span class="s2">&quot;safe&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-459"><a href="#DynamicMemoryIndex.batch_insert-459"><span class="linenos">459</span></a>
</span><span id="DynamicMemoryIndex.batch_insert-460"><a href="#DynamicMemoryIndex.batch_insert-460"><span class="linenos">460</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">+</span> <span class="n">_vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.batch_insert-461"><a href="#DynamicMemoryIndex.batch_insert-461"><span class="linenos">461</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span> <span class="o">&gt;=</span> <span class="n">_vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="DynamicMemoryIndex.batch_insert-462"><a href="#DynamicMemoryIndex.batch_insert-462"><span class="linenos">462</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserting these vectors, count=</span><span class="si">{</span><span class="n">_vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> would overrun the &quot;</span>
</span><span id="DynamicMemoryIndex.batch_insert-463"><a href="#DynamicMemoryIndex.batch_insert-463"><span class="linenos">463</span></a>                              <span class="sa">f</span><span class="s2">&quot;max_vectors=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="si">}</span><span class="s2"> specified at index construction. We are attempting to &quot;</span>
</span><span id="DynamicMemoryIndex.batch_insert-464"><a href="#DynamicMemoryIndex.batch_insert-464"><span class="linenos">464</span></a>                              <span class="sa">f</span><span class="s2">&quot;consolidate_delete() to make space.&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-465"><a href="#DynamicMemoryIndex.batch_insert-465"><span class="linenos">465</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">consolidate_delete</span><span class="p">()</span>
</span><span id="DynamicMemoryIndex.batch_insert-466"><a href="#DynamicMemoryIndex.batch_insert-466"><span class="linenos">466</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.batch_insert-467"><a href="#DynamicMemoryIndex.batch_insert-467"><span class="linenos">467</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inserting these vectors count=</span><span class="si">{</span><span class="n">_vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> would overrun the &quot;</span>
</span><span id="DynamicMemoryIndex.batch_insert-468"><a href="#DynamicMemoryIndex.batch_insert-468"><span class="linenos">468</span></a>                                   <span class="sa">f</span><span class="s2">&quot;max_vectors=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_vectors</span><span class="si">}</span><span class="s2"> specified at index construction. Unable to make &quot;</span>
</span><span id="DynamicMemoryIndex.batch_insert-469"><a href="#DynamicMemoryIndex.batch_insert-469"><span class="linenos">469</span></a>                                   <span class="sa">f</span><span class="s2">&quot;space by consolidating deletions. The batch insert operation has failed.&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-470"><a href="#DynamicMemoryIndex.batch_insert-470"><span class="linenos">470</span></a>
</span><span id="DynamicMemoryIndex.batch_insert-471"><a href="#DynamicMemoryIndex.batch_insert-471"><span class="linenos">471</span></a>        <span class="n">statuses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">batch_insert</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.batch_insert-472"><a href="#DynamicMemoryIndex.batch_insert-472"><span class="linenos">472</span></a>            <span class="n">_vectors</span><span class="p">,</span> <span class="n">_vector_ids</span><span class="p">,</span> <span class="n">_vector_ids</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">num_threads</span>
</span><span id="DynamicMemoryIndex.batch_insert-473"><a href="#DynamicMemoryIndex.batch_insert-473"><span class="linenos">473</span></a>        <span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-474"><a href="#DynamicMemoryIndex.batch_insert-474"><span class="linenos">474</span></a>        <span class="n">successes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DynamicMemoryIndex.batch_insert-475"><a href="#DynamicMemoryIndex.batch_insert-475"><span class="linenos">475</span></a>        <span class="n">failures</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="DynamicMemoryIndex.batch_insert-476"><a href="#DynamicMemoryIndex.batch_insert-476"><span class="linenos">476</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">statuses</span><span class="p">)):</span>
</span><span id="DynamicMemoryIndex.batch_insert-477"><a href="#DynamicMemoryIndex.batch_insert-477"><span class="linenos">477</span></a>            <span class="k">if</span> <span class="n">statuses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.batch_insert-478"><a href="#DynamicMemoryIndex.batch_insert-478"><span class="linenos">478</span></a>                <span class="n">successes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-479"><a href="#DynamicMemoryIndex.batch_insert-479"><span class="linenos">479</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.batch_insert-480"><a href="#DynamicMemoryIndex.batch_insert-480"><span class="linenos">480</span></a>                <span class="n">failures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-481"><a href="#DynamicMemoryIndex.batch_insert-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">successes</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.batch_insert-482"><a href="#DynamicMemoryIndex.batch_insert-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failures</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="DynamicMemoryIndex.batch_insert-483"><a href="#DynamicMemoryIndex.batch_insert-483"><span class="linenos">483</span></a>            <span class="k">return</span>
</span><span id="DynamicMemoryIndex.batch_insert-484"><a href="#DynamicMemoryIndex.batch_insert-484"><span class="linenos">484</span></a>        <span class="n">failed_ids</span> <span class="o">=</span> <span class="n">vector_ids</span><span class="p">[</span><span class="n">failures</span><span class="p">]</span>
</span><span id="DynamicMemoryIndex.batch_insert-485"><a href="#DynamicMemoryIndex.batch_insert-485"><span class="linenos">485</span></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="DynamicMemoryIndex.batch_insert-486"><a href="#DynamicMemoryIndex.batch_insert-486"><span class="linenos">486</span></a>            <span class="sa">f</span><span class="s2">&quot;During batch insert, the following vector_ids were unable to be inserted into the index: </span><span class="si">{</span><span class="n">failed_ids</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="DynamicMemoryIndex.batch_insert-487"><a href="#DynamicMemoryIndex.batch_insert-487"><span class="linenos">487</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">successes</span><span class="p">)</span><span class="si">}</span><span class="s2"> were successfully inserted&quot;</span>
</span><span id="DynamicMemoryIndex.batch_insert-488"><a href="#DynamicMemoryIndex.batch_insert-488"><span class="linenos">488</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Inserts a batch of vectors into the index with the provided vector_ids.</p>

<p>If this batch insertion will overrun the <code>max_vectors</code> count boundaries of this index, <code><a href="#DynamicMemoryIndex.consolidate_delete">consolidate_delete()</a></code>
will be executed automatically.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>vectors</strong>: The 2d numpy array of vectors to insert.</li>
<li><strong>vector_ids</strong>: The 1d array of vector ids to use. This array must have the same number of elements as
the vectors array has rows. The dtype of vector_ids must be <code>np.uint32</code></li>
<li><strong>num_threads</strong>: Number of threads to use when inserting into this index. (&gt;= 0), 0 = num_threads in system</li>
</ul>
</div>


                            </div>
                            <div id="DynamicMemoryIndex.mark_deleted" class="classattr">
                                        <input id="DynamicMemoryIndex.mark_deleted-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mark_deleted</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vector_id</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamicMemoryIndex.mark_deleted-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamicMemoryIndex.mark_deleted"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamicMemoryIndex.mark_deleted-491"><a href="#DynamicMemoryIndex.mark_deleted-491"><span class="linenos">491</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mark_deleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_id</span><span class="p">:</span> <span class="n">VectorIdentifier</span><span class="p">):</span>
</span><span id="DynamicMemoryIndex.mark_deleted-492"><a href="#DynamicMemoryIndex.mark_deleted-492"><span class="linenos">492</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.mark_deleted-493"><a href="#DynamicMemoryIndex.mark_deleted-493"><span class="linenos">493</span></a><span class="sd">        Mark vector for deletion. This is a soft delete that won&#39;t return the vector id in any results, but does not</span>
</span><span id="DynamicMemoryIndex.mark_deleted-494"><a href="#DynamicMemoryIndex.mark_deleted-494"><span class="linenos">494</span></a><span class="sd">        remove it from the underlying index files or memory structure. To execute a hard delete, call this method and</span>
</span><span id="DynamicMemoryIndex.mark_deleted-495"><a href="#DynamicMemoryIndex.mark_deleted-495"><span class="linenos">495</span></a><span class="sd">        then call the much more expensive `consolidate_delete` method on this index.</span>
</span><span id="DynamicMemoryIndex.mark_deleted-496"><a href="#DynamicMemoryIndex.mark_deleted-496"><span class="linenos">496</span></a><span class="sd">        ### Parameters</span>
</span><span id="DynamicMemoryIndex.mark_deleted-497"><a href="#DynamicMemoryIndex.mark_deleted-497"><span class="linenos">497</span></a><span class="sd">        - **vector_id**: The vector id to delete. Must be a uint32.</span>
</span><span id="DynamicMemoryIndex.mark_deleted-498"><a href="#DynamicMemoryIndex.mark_deleted-498"><span class="linenos">498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.mark_deleted-499"><a href="#DynamicMemoryIndex.mark_deleted-499"><span class="linenos">499</span></a>        <span class="n">_assert_is_positive_uint32</span><span class="p">(</span><span class="n">vector_id</span><span class="p">,</span> <span class="s2">&quot;vector_id&quot;</span><span class="p">)</span>
</span><span id="DynamicMemoryIndex.mark_deleted-500"><a href="#DynamicMemoryIndex.mark_deleted-500"><span class="linenos">500</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_points_deleted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="DynamicMemoryIndex.mark_deleted-501"><a href="#DynamicMemoryIndex.mark_deleted-501"><span class="linenos">501</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="DynamicMemoryIndex.mark_deleted-502"><a href="#DynamicMemoryIndex.mark_deleted-502"><span class="linenos">502</span></a>        <span class="c1"># we do not decrement self._num_vectors until consolidate_delete</span>
</span><span id="DynamicMemoryIndex.mark_deleted-503"><a href="#DynamicMemoryIndex.mark_deleted-503"><span class="linenos">503</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">mark_deleted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">(</span><span class="n">vector_id</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Mark vector for deletion. This is a soft delete that won't return the vector id in any results, but does not
remove it from the underlying index files or memory structure. To execute a hard delete, call this method and
then call the much more expensive <code><a href="#DynamicMemoryIndex.consolidate_delete">consolidate_delete</a></code> method on this index.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>vector_id</strong>: The vector id to delete. Must be a uint32.</li>
</ul>
</div>


                            </div>
                            <div id="DynamicMemoryIndex.consolidate_delete" class="classattr">
                                        <input id="DynamicMemoryIndex.consolidate_delete-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">consolidate_delete</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="DynamicMemoryIndex.consolidate_delete-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DynamicMemoryIndex.consolidate_delete"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DynamicMemoryIndex.consolidate_delete-505"><a href="#DynamicMemoryIndex.consolidate_delete-505"><span class="linenos">505</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">consolidate_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DynamicMemoryIndex.consolidate_delete-506"><a href="#DynamicMemoryIndex.consolidate_delete-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.consolidate_delete-507"><a href="#DynamicMemoryIndex.consolidate_delete-507"><span class="linenos">507</span></a><span class="sd">        This method actually restructures the DiskANN index to remove the items that have been marked for deletion.</span>
</span><span id="DynamicMemoryIndex.consolidate_delete-508"><a href="#DynamicMemoryIndex.consolidate_delete-508"><span class="linenos">508</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DynamicMemoryIndex.consolidate_delete-509"><a href="#DynamicMemoryIndex.consolidate_delete-509"><span class="linenos">509</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="o">.</span><span class="n">consolidate_delete</span><span class="p">()</span>
</span><span id="DynamicMemoryIndex.consolidate_delete-510"><a href="#DynamicMemoryIndex.consolidate_delete-510"><span class="linenos">510</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_points_deleted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="DynamicMemoryIndex.consolidate_delete-511"><a href="#DynamicMemoryIndex.consolidate_delete-511"><span class="linenos">511</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_vectors</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span>
</span><span id="DynamicMemoryIndex.consolidate_delete-512"><a href="#DynamicMemoryIndex.consolidate_delete-512"><span class="linenos">512</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_removed_num_vectors</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>This method actually restructures the DiskANN index to remove the items that have been marked for deletion.</p>
</div>


                            </div>
                </section>
                <section id="DistanceMetric">
                    <div class="attr variable">
            <span class="name">DistanceMetric</span>        =
<span class="default_value">typing.Literal[&#39;l2&#39;, &#39;mips&#39;, &#39;cosine&#39;]</span>

        
    </div>
    <a class="headerlink" href="#DistanceMetric"></a>
    
            <div class="docstring"><p>Type alias for one of {"l2", "mips", "cosine"}</p>
</div>


                </section>
                <section id="VectorDType">
                    <div class="attr variable">
            <span class="name">VectorDType</span>        =
<span class="default_value">typing.Union[typing.Type[numpy.float32], typing.Type[numpy.int8], typing.Type[numpy.uint8]]</span>

        
    </div>
    <a class="headerlink" href="#VectorDType"></a>
    
            <div class="docstring"><p>Type alias for one of {<code>numpy.float32</code>, <code>numpy.int8</code>, <code>numpy.uint8</code>}</p>
</div>


                </section>
                <section id="QueryResponse">
                            <input id="QueryResponse-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">QueryResponse</span><wbr>(<span class="base">typing.NamedTuple</span>):

                <label class="view-source-button" for="QueryResponse-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#QueryResponse"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="QueryResponse-68"><a href="#QueryResponse-68"><span class="linenos">68</span></a><span class="k">class</span><span class="w"> </span><span class="nc">QueryResponse</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="QueryResponse-69"><a href="#QueryResponse-69"><span class="linenos">69</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QueryResponse-70"><a href="#QueryResponse-70"><span class="linenos">70</span></a><span class="sd">    Tuple with two values, identifiers and distances. Both are 1d arrays, positionally correspond, and will contain the</span>
</span><span id="QueryResponse-71"><a href="#QueryResponse-71"><span class="linenos">71</span></a><span class="sd">    nearest neighbors from [0..k_neighbors)</span>
</span><span id="QueryResponse-72"><a href="#QueryResponse-72"><span class="linenos">72</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="QueryResponse-73"><a href="#QueryResponse-73"><span class="linenos">73</span></a>
</span><span id="QueryResponse-74"><a href="#QueryResponse-74"><span class="linenos">74</span></a>    <span class="n">identifiers</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">VectorIdentifier</span><span class="p">]</span>
</span><span id="QueryResponse-75"><a href="#QueryResponse-75"><span class="linenos">75</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; A `numpy.typing.NDArray[VectorIdentifier]` array of vector identifiers, 1 dimensional &quot;&quot;&quot;</span>
</span><span id="QueryResponse-76"><a href="#QueryResponse-76"><span class="linenos">76</span></a>    <span class="n">distances</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
</span><span id="QueryResponse-77"><a href="#QueryResponse-77"><span class="linenos">77</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QueryResponse-78"><a href="#QueryResponse-78"><span class="linenos">78</span></a><span class="sd">    A `numpy.typing.NDAarray[numpy.float32]` of distances as calculated by the distance metric function,  1 dimensional</span>
</span><span id="QueryResponse-79"><a href="#QueryResponse-79"><span class="linenos">79</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Tuple with two values, identifiers and distances. Both are 1d arrays, positionally correspond, and will contain the
nearest neighbors from [0..k_neighbors)</p>
</div>


                            <div id="QueryResponse.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">QueryResponse</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">identifiers</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">]]</span>,</span><span class="param">	<span class="n">distances</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">]]</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#QueryResponse.__init__"></a>
    
            <div class="docstring"><p>Create new instance of QueryResponse(identifiers, distances)</p>
</div>


                            </div>
                            <div id="QueryResponse.identifiers" class="classattr">
                                <div class="attr variable">
            <span class="name">identifiers</span><span class="annotation">: numpy.ndarray[typing.Any, numpy.dtype[numpy.uint32]]</span>

        
    </div>
    <a class="headerlink" href="#QueryResponse.identifiers"></a>
    
            <div class="docstring"><p>A <code>numpy.typing.NDArray[VectorIdentifier]</code> array of vector identifiers, 1 dimensional</p>
</div>


                            </div>
                            <div id="QueryResponse.distances" class="classattr">
                                <div class="attr variable">
            <span class="name">distances</span><span class="annotation">: numpy.ndarray[typing.Any, numpy.dtype[numpy.float32]]</span>

        
    </div>
    <a class="headerlink" href="#QueryResponse.distances"></a>
    
            <div class="docstring"><p>A <code>numpy.typing.NDAarray[numpy.float32]</code> of distances as calculated by the distance metric function,  1 dimensional</p>
</div>


                            </div>
                </section>
                <section id="QueryResponseBatch">
                            <input id="QueryResponseBatch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">QueryResponseBatch</span><wbr>(<span class="base">typing.NamedTuple</span>):

                <label class="view-source-button" for="QueryResponseBatch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#QueryResponseBatch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="QueryResponseBatch-82"><a href="#QueryResponseBatch-82"><span class="linenos">82</span></a><span class="k">class</span><span class="w"> </span><span class="nc">QueryResponseBatch</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="QueryResponseBatch-83"><a href="#QueryResponseBatch-83"><span class="linenos">83</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="QueryResponseBatch-84"><a href="#QueryResponseBatch-84"><span class="linenos">84</span></a><span class="sd">    Tuple with two values, identifiers and distances. Both are 2d arrays, with dimensionality determined by the</span>
</span><span id="QueryResponseBatch-85"><a href="#QueryResponseBatch-85"><span class="linenos">85</span></a><span class="sd">    rows corresponding to the number of queries made, and the columns corresponding to the k neighbors</span>
</span><span id="QueryResponseBatch-86"><a href="#QueryResponseBatch-86"><span class="linenos">86</span></a><span class="sd">    requested. The two 2d arrays have an implicit, position-based relationship</span>
</span><span id="QueryResponseBatch-87"><a href="#QueryResponseBatch-87"><span class="linenos">87</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="QueryResponseBatch-88"><a href="#QueryResponseBatch-88"><span class="linenos">88</span></a>
</span><span id="QueryResponseBatch-89"><a href="#QueryResponseBatch-89"><span class="linenos">89</span></a>    <span class="n">identifiers</span><span class="p">:</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">VectorIdentifier</span><span class="p">]</span>
</span><span id="QueryResponseBatch-90"><a href="#QueryResponseBatch-90"><span class="linenos">90</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
</span><span id="QueryResponseBatch-91"><a href="#QueryResponseBatch-91"><span class="linenos">91</span></a><span class="sd">    A `numpy.typing.NDArray[VectorIdentifier]` array of vector identifiers, 2 dimensional. The row corresponds to index </span>
</span><span id="QueryResponseBatch-92"><a href="#QueryResponseBatch-92"><span class="linenos">92</span></a><span class="sd">    of the query, and the column corresponds to the k neighbors requested </span>
</span><span id="QueryResponseBatch-93"><a href="#QueryResponseBatch-93"><span class="linenos">93</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="QueryResponseBatch-94"><a href="#QueryResponseBatch-94"><span class="linenos">94</span></a>    <span class="n">distances</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span>
</span><span id="QueryResponseBatch-95"><a href="#QueryResponseBatch-95"><span class="linenos">95</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;  </span>
</span><span id="QueryResponseBatch-96"><a href="#QueryResponseBatch-96"><span class="linenos">96</span></a><span class="sd">    A `numpy.typing.NDAarray[numpy.float32]` of distances as calculated by the distance metric function, 2 dimensional. </span>
</span><span id="QueryResponseBatch-97"><a href="#QueryResponseBatch-97"><span class="linenos">97</span></a><span class="sd">    The row corresponds to the index of the query, and the column corresponds to the distance of the query to the </span>
</span><span id="QueryResponseBatch-98"><a href="#QueryResponseBatch-98"><span class="linenos">98</span></a><span class="sd">    *k-th* neighbor </span>
</span><span id="QueryResponseBatch-99"><a href="#QueryResponseBatch-99"><span class="linenos">99</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Tuple with two values, identifiers and distances. Both are 2d arrays, with dimensionality determined by the
rows corresponding to the number of queries made, and the columns corresponding to the k neighbors
requested. The two 2d arrays have an implicit, position-based relationship</p>
</div>


                            <div id="QueryResponseBatch.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">QueryResponseBatch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">identifiers</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">]]</span>,</span><span class="param">	<span class="n">distances</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">]</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#QueryResponseBatch.__init__"></a>
    
            <div class="docstring"><p>Create new instance of QueryResponseBatch(identifiers, distances)</p>
</div>


                            </div>
                            <div id="QueryResponseBatch.identifiers" class="classattr">
                                <div class="attr variable">
            <span class="name">identifiers</span><span class="annotation">: numpy.ndarray[typing.Any, numpy.dtype[numpy.uint32]]</span>

        
    </div>
    <a class="headerlink" href="#QueryResponseBatch.identifiers"></a>
    
            <div class="docstring"><p>A <code>numpy.typing.NDArray[VectorIdentifier]</code> array of vector identifiers, 2 dimensional. The row corresponds to index 
of the query, and the column corresponds to the k neighbors requested</p>
</div>


                            </div>
                            <div id="QueryResponseBatch.distances" class="classattr">
                                <div class="attr variable">
            <span class="name">distances</span><span class="annotation">: numpy.ndarray[numpy.float32]</span>

        
    </div>
    <a class="headerlink" href="#QueryResponseBatch.distances"></a>
    
            <div class="docstring"><p>A <code>numpy.typing.NDAarray[numpy.float32]</code> of distances as calculated by the distance metric function, 2 dimensional. 
The row corresponds to the index of the query, and the column corresponds to the distance of the query to the 
<em>k-th</em> neighbor</p>
</div>


                            </div>
                </section>
                <section id="VectorIdentifier">
                    <div class="attr variable">
            <span class="name">VectorIdentifier</span>        =
<span class="default_value">&lt;class &#39;numpy.uint32&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#VectorIdentifier"></a>
    
            <div class="docstring"><p>Type alias for a vector identifier, whether it be an implicit array index identifier from StaticMemoryIndex or 
StaticDiskIndex, or an explicit tag identifier from DynamicMemoryIndex</p>
</div>


                </section>
                <section id="VectorIdentifierBatch">
                    <div class="attr variable">
            <span class="name">VectorIdentifierBatch</span>        =
<span class="default_value">numpy.ndarray[typing.Any, numpy.dtype[numpy.uint32]]</span>

        
    </div>
    <a class="headerlink" href="#VectorIdentifierBatch"></a>
    
            <div class="docstring"><p>Type alias for a batch of VectorIdentifiers</p>
</div>


                </section>
                <section id="VectorLike">
                    <div class="attr variable">
            <span class="name">VectorLike</span>        =
<input id="VectorLike-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="VectorLike-view-value"></label><span class="default_value">numpy.ndarray[typing.Any, numpy.dtype[typing.Union[typing.Type[numpy.float32], typing.Type[numpy.int8], typing.Type[numpy.uint8]]]]</span>

        
    </div>
    <a class="headerlink" href="#VectorLike"></a>
    
            <div class="docstring"><p>Type alias for something that can be treated as a vector</p>
</div>


                </section>
                <section id="VectorLikeBatch">
                    <div class="attr variable">
            <span class="name">VectorLikeBatch</span>        =
<input id="VectorLikeBatch-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="VectorLikeBatch-view-value"></label><span class="default_value">numpy.ndarray[typing.Any, numpy.dtype[typing.Union[typing.Type[numpy.float32], typing.Type[numpy.int8], typing.Type[numpy.uint8]]]]</span>

        
    </div>
    <a class="headerlink" href="#VectorLikeBatch"></a>
    
            <div class="docstring"><p>Type alias for a batch of VectorLikes</p>
</div>


                </section>
                <section id="Metadata">
                            <input id="Metadata-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Metadata</span><wbr>(<span class="base">typing.NamedTuple</span>):

                <label class="view-source-button" for="Metadata-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Metadata"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Metadata-15"><a href="#Metadata-15"><span class="linenos">15</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Metadata</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="Metadata-16"><a href="#Metadata-16"><span class="linenos">16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;DiskANN binary vector files contain a small stanza containing some metadata about them.&quot;&quot;&quot;</span>
</span><span id="Metadata-17"><a href="#Metadata-17"><span class="linenos">17</span></a>
</span><span id="Metadata-18"><a href="#Metadata-18"><span class="linenos">18</span></a>    <span class="n">num_vectors</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Metadata-19"><a href="#Metadata-19"><span class="linenos">19</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; The number of vectors in the file. &quot;&quot;&quot;</span>
</span><span id="Metadata-20"><a href="#Metadata-20"><span class="linenos">20</span></a>    <span class="n">dimensions</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Metadata-21"><a href="#Metadata-21"><span class="linenos">21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; The dimensionality of the vectors in the file. &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>DiskANN binary vector files contain a small stanza containing some metadata about them.</p>
</div>


                            <div id="Metadata.__init__" class="classattr">
                                <div class="attr function">
            
        <span class="name">Metadata</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">num_vectors</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">dimensions</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

        
    </div>
    <a class="headerlink" href="#Metadata.__init__"></a>
    
            <div class="docstring"><p>Create new instance of Metadata(num_vectors, dimensions)</p>
</div>


                            </div>
                            <div id="Metadata.num_vectors" class="classattr">
                                <div class="attr variable">
            <span class="name">num_vectors</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Metadata.num_vectors"></a>
    
            <div class="docstring"><p>The number of vectors in the file.</p>
</div>


                            </div>
                            <div id="Metadata.dimensions" class="classattr">
                                <div class="attr variable">
            <span class="name">dimensions</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Metadata.dimensions"></a>
    
            <div class="docstring"><p>The dimensionality of the vectors in the file.</p>
</div>


                            </div>
                </section>
                <section id="vectors_metadata_from_file">
                            <input id="vectors_metadata_from_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">vectors_metadata_from_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">vector_file</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#Metadata">Metadata</a></span>:</span></span>

                <label class="view-source-button" for="vectors_metadata_from_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#vectors_metadata_from_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="vectors_metadata_from_file-24"><a href="#vectors_metadata_from_file-24"><span class="linenos">24</span></a><span class="k">def</span><span class="w"> </span><span class="nf">vectors_metadata_from_file</span><span class="p">(</span><span class="n">vector_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Metadata</span><span class="p">:</span>
</span><span id="vectors_metadata_from_file-25"><a href="#vectors_metadata_from_file-25"><span class="linenos">25</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="vectors_metadata_from_file-26"><a href="#vectors_metadata_from_file-26"><span class="linenos">26</span></a><span class="sd">    Read the metadata from a DiskANN binary vector file.</span>
</span><span id="vectors_metadata_from_file-27"><a href="#vectors_metadata_from_file-27"><span class="linenos">27</span></a><span class="sd">    ### Parameters</span>
</span><span id="vectors_metadata_from_file-28"><a href="#vectors_metadata_from_file-28"><span class="linenos">28</span></a><span class="sd">    - **vector_file**: The path to the vector file to read the metadata from.</span>
</span><span id="vectors_metadata_from_file-29"><a href="#vectors_metadata_from_file-29"><span class="linenos">29</span></a>
</span><span id="vectors_metadata_from_file-30"><a href="#vectors_metadata_from_file-30"><span class="linenos">30</span></a><span class="sd">    ### Returns</span>
</span><span id="vectors_metadata_from_file-31"><a href="#vectors_metadata_from_file-31"><span class="linenos">31</span></a><span class="sd">    `diskannpy.Metadata`</span>
</span><span id="vectors_metadata_from_file-32"><a href="#vectors_metadata_from_file-32"><span class="linenos">32</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="vectors_metadata_from_file-33"><a href="#vectors_metadata_from_file-33"><span class="linenos">33</span></a>    <span class="n">_assert_existing_file</span><span class="p">(</span><span class="n">vector_file</span><span class="p">,</span> <span class="s2">&quot;vector_file&quot;</span><span class="p">)</span>
</span><span id="vectors_metadata_from_file-34"><a href="#vectors_metadata_from_file-34"><span class="linenos">34</span></a>    <span class="n">points</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">vector_file</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="vectors_metadata_from_file-35"><a href="#vectors_metadata_from_file-35"><span class="linenos">35</span></a>    <span class="k">return</span> <span class="n">Metadata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read the metadata from a DiskANN binary vector file.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>vector_file</strong>: The path to the vector file to read the metadata from.</li>
</ul>

<h3 id="returns">Returns</h3>

<p><code><a href="#Metadata">diskannpy.Metadata</a></code></p>
</div>


                </section>
                <section id="vectors_to_file">
                            <input id="vectors_to_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">vectors_to_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">vector_file</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">vectors</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="vectors_to_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#vectors_to_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="vectors_to_file-46"><a href="#vectors_to_file-46"><span class="linenos">46</span></a><span class="k">def</span><span class="w"> </span><span class="nf">vectors_to_file</span><span class="p">(</span><span class="n">vector_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">vectors</span><span class="p">:</span> <span class="n">VectorLikeBatch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="vectors_to_file-47"><a href="#vectors_to_file-47"><span class="linenos">47</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="vectors_to_file-48"><a href="#vectors_to_file-48"><span class="linenos">48</span></a><span class="sd">    Utility function that writes a DiskANN binary vector formatted file to the location of your choosing.</span>
</span><span id="vectors_to_file-49"><a href="#vectors_to_file-49"><span class="linenos">49</span></a>
</span><span id="vectors_to_file-50"><a href="#vectors_to_file-50"><span class="linenos">50</span></a><span class="sd">    ### Parameters</span>
</span><span id="vectors_to_file-51"><a href="#vectors_to_file-51"><span class="linenos">51</span></a><span class="sd">    - **vector_file**: The path to the vector file to write the vectors to.</span>
</span><span id="vectors_to_file-52"><a href="#vectors_to_file-52"><span class="linenos">52</span></a><span class="sd">    - **vectors**: A 2d array of dtype `numpy.float32`, `numpy.uint8`, or `numpy.int8`</span>
</span><span id="vectors_to_file-53"><a href="#vectors_to_file-53"><span class="linenos">53</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="vectors_to_file-54"><a href="#vectors_to_file-54"><span class="linenos">54</span></a>    <span class="n">_assert_dtype</span><span class="p">(</span><span class="n">vectors</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="vectors_to_file-55"><a href="#vectors_to_file-55"><span class="linenos">55</span></a>    <span class="n">_assert_2d</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="s2">&quot;vectors&quot;</span><span class="p">)</span>
</span><span id="vectors_to_file-56"><a href="#vectors_to_file-56"><span class="linenos">56</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">vector_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
</span><span id="vectors_to_file-57"><a href="#vectors_to_file-57"><span class="linenos">57</span></a>        <span class="n">_write_bin</span><span class="p">(</span><span class="n">vectors</span><span class="p">,</span> <span class="n">fh</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Utility function that writes a DiskANN binary vector formatted file to the location of your choosing.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>vector_file</strong>: The path to the vector file to write the vectors to.</li>
<li><strong>vectors</strong>: A 2d array of dtype <code>numpy.float32</code>, <code>numpy.uint8</code>, or <code>numpy.int8</code></li>
</ul>
</div>


                </section>
                <section id="vectors_from_file">
                            <input id="vectors_from_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">vectors_from_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">vector_file</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]</span>,</span><span class="param">	<span class="n">use_memmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">typing</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]]]</span>:</span></span>

                <label class="view-source-button" for="vectors_from_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#vectors_from_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="vectors_from_file-60"><a href="#vectors_from_file-60"><span class="linenos">60</span></a><span class="k">def</span><span class="w"> </span><span class="nf">vectors_from_file</span><span class="p">(</span>
</span><span id="vectors_from_file-61"><a href="#vectors_from_file-61"><span class="linenos">61</span></a>    <span class="n">vector_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="vectors_from_file-62"><a href="#vectors_from_file-62"><span class="linenos">62</span></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">VectorDType</span><span class="p">,</span>
</span><span id="vectors_from_file-63"><a href="#vectors_from_file-63"><span class="linenos">63</span></a>    <span class="n">use_memmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="vectors_from_file-64"><a href="#vectors_from_file-64"><span class="linenos">64</span></a>    <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
</span><span id="vectors_from_file-65"><a href="#vectors_from_file-65"><span class="linenos">65</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">npt</span><span class="o">.</span><span class="n">NDArray</span><span class="p">[</span><span class="n">VectorDType</span><span class="p">]:</span>
</span><span id="vectors_from_file-66"><a href="#vectors_from_file-66"><span class="linenos">66</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="vectors_from_file-67"><a href="#vectors_from_file-67"><span class="linenos">67</span></a><span class="sd">    Read vectors from a DiskANN binary vector file.</span>
</span><span id="vectors_from_file-68"><a href="#vectors_from_file-68"><span class="linenos">68</span></a>
</span><span id="vectors_from_file-69"><a href="#vectors_from_file-69"><span class="linenos">69</span></a><span class="sd">    ### Parameters</span>
</span><span id="vectors_from_file-70"><a href="#vectors_from_file-70"><span class="linenos">70</span></a><span class="sd">    - **vector_file**: The path to the vector file to read the vectors from.</span>
</span><span id="vectors_from_file-71"><a href="#vectors_from_file-71"><span class="linenos">71</span></a><span class="sd">    - **dtype**: The data type of the vectors in the file. Ensure you match the data types exactly</span>
</span><span id="vectors_from_file-72"><a href="#vectors_from_file-72"><span class="linenos">72</span></a><span class="sd">    - **use_memmap**: If True, return a np.memmap, else a standard np.ndarray will be returned</span>
</span><span id="vectors_from_file-73"><a href="#vectors_from_file-73"><span class="linenos">73</span></a><span class="sd">    - **mode**: Read-only (r) or read-write (r+) (memmap only). Unlike np.memmap, default is read-only (r)</span>
</span><span id="vectors_from_file-74"><a href="#vectors_from_file-74"><span class="linenos">74</span></a>
</span><span id="vectors_from_file-75"><a href="#vectors_from_file-75"><span class="linenos">75</span></a><span class="sd">    ### Returns</span>
</span><span id="vectors_from_file-76"><a href="#vectors_from_file-76"><span class="linenos">76</span></a><span class="sd">    `numpy.typing.NDArray[dtype] | numpy.memmap`</span>
</span><span id="vectors_from_file-77"><a href="#vectors_from_file-77"><span class="linenos">77</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="vectors_from_file-78"><a href="#vectors_from_file-78"><span class="linenos">78</span></a>    <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">]</span>
</span><span id="vectors_from_file-79"><a href="#vectors_from_file-79"><span class="linenos">79</span></a>    <span class="n">points</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="n">vectors_metadata_from_file</span><span class="p">(</span><span class="n">vector_file</span><span class="p">)</span>
</span><span id="vectors_from_file-80"><a href="#vectors_from_file-80"><span class="linenos">80</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_memmap</span><span class="p">:</span>
</span><span id="vectors_from_file-81"><a href="#vectors_from_file-81"><span class="linenos">81</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">vector_file</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
</span><span id="vectors_from_file-82"><a href="#vectors_from_file-82"><span class="linenos">82</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="vectors_from_file-83"><a href="#vectors_from_file-83"><span class="linenos">83</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">memmap</span><span class="p">(</span><span class="n">vector_file</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">dims</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read vectors from a DiskANN binary vector file.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>vector_file</strong>: The path to the vector file to read the vectors from.</li>
<li><strong>dtype</strong>: The data type of the vectors in the file. Ensure you match the data types exactly</li>
<li><strong>use_memmap</strong>: If True, return a np.memmap, else a standard np.ndarray will be returned</li>
<li><strong>mode</strong>: Read-only (r) or read-write (r+) (memmap only). Unlike np.memmap, default is read-only (r)</li>
</ul>

<h3 id="returns">Returns</h3>

<p><code>numpy.typing.NDArray[dtype] | numpy.memmap</code></p>
</div>


                </section>
                <section id="tags_to_file">
                            <input id="tags_to_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tags_to_file</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">tags_file</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">tags</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="tags_to_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tags_to_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tags_to_file-86"><a href="#tags_to_file-86"><span class="linenos"> 86</span></a><span class="k">def</span><span class="w"> </span><span class="nf">tags_to_file</span><span class="p">(</span><span class="n">tags_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">VectorIdentifierBatch</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tags_to_file-87"><a href="#tags_to_file-87"><span class="linenos"> 87</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tags_to_file-88"><a href="#tags_to_file-88"><span class="linenos"> 88</span></a><span class="sd">    Write tags to a DiskANN binary tag file.</span>
</span><span id="tags_to_file-89"><a href="#tags_to_file-89"><span class="linenos"> 89</span></a>
</span><span id="tags_to_file-90"><a href="#tags_to_file-90"><span class="linenos"> 90</span></a><span class="sd">    ### Parameters</span>
</span><span id="tags_to_file-91"><a href="#tags_to_file-91"><span class="linenos"> 91</span></a><span class="sd">    - **tags_file**: The path to the tag file to write the tags to.</span>
</span><span id="tags_to_file-92"><a href="#tags_to_file-92"><span class="linenos"> 92</span></a><span class="sd">    - **tags**: A 1d array of dtype `numpy.uint32` containing the tags to write. If you have a 2d array of tags with</span>
</span><span id="tags_to_file-93"><a href="#tags_to_file-93"><span class="linenos"> 93</span></a><span class="sd">      one column, you can pass it here and it will be reshaped and copied to a new array. It is more efficient for you</span>
</span><span id="tags_to_file-94"><a href="#tags_to_file-94"><span class="linenos"> 94</span></a><span class="sd">      to reshape on your own without copying it first, as it should be a constant time operation vs. linear time</span>
</span><span id="tags_to_file-95"><a href="#tags_to_file-95"><span class="linenos"> 95</span></a>
</span><span id="tags_to_file-96"><a href="#tags_to_file-96"><span class="linenos"> 96</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="tags_to_file-97"><a href="#tags_to_file-97"><span class="linenos"> 97</span></a>    <span class="n">_assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">can_cast</span><span class="p">(</span><span class="n">tags</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span> <span class="s2">&quot;valid tags must be uint32&quot;</span><span class="p">)</span>
</span><span id="tags_to_file-98"><a href="#tags_to_file-98"><span class="linenos"> 98</span></a>    <span class="n">_assert</span><span class="p">(</span>
</span><span id="tags_to_file-99"><a href="#tags_to_file-99"><span class="linenos"> 99</span></a>        <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">tags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="tags_to_file-100"><a href="#tags_to_file-100"><span class="linenos">100</span></a>        <span class="s2">&quot;tags must be 1d or 2d with 1 column&quot;</span><span class="p">,</span>
</span><span id="tags_to_file-101"><a href="#tags_to_file-101"><span class="linenos">101</span></a>    <span class="p">)</span>
</span><span id="tags_to_file-102"><a href="#tags_to_file-102"><span class="linenos">102</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tags</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="tags_to_file-103"><a href="#tags_to_file-103"><span class="linenos">103</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="tags_to_file-104"><a href="#tags_to_file-104"><span class="linenos">104</span></a>            <span class="s2">&quot;Tags in 2d with one column will be reshaped and copied to a new array. &quot;</span>
</span><span id="tags_to_file-105"><a href="#tags_to_file-105"><span class="linenos">105</span></a>            <span class="s2">&quot;It is more efficient for you to reshape without copying first.&quot;</span>
</span><span id="tags_to_file-106"><a href="#tags_to_file-106"><span class="linenos">106</span></a>        <span class="p">)</span>
</span><span id="tags_to_file-107"><a href="#tags_to_file-107"><span class="linenos">107</span></a>        <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">tags</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="tags_to_file-108"><a href="#tags_to_file-108"><span class="linenos">108</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tags_file</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fh</span><span class="p">:</span>
</span><span id="tags_to_file-109"><a href="#tags_to_file-109"><span class="linenos">109</span></a>        <span class="n">_write_bin</span><span class="p">(</span><span class="n">tags</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">),</span> <span class="n">fh</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write tags to a DiskANN binary tag file.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>tags_file</strong>: The path to the tag file to write the tags to.</li>
<li><strong>tags</strong>: A 1d array of dtype <code>numpy.uint32</code> containing the tags to write. If you have a 2d array of tags with
one column, you can pass it here and it will be reshaped and copied to a new array. It is more efficient for you
to reshape on your own without copying it first, as it should be a constant time operation vs. linear time</li>
</ul>
</div>


                </section>
                <section id="tags_from_file">
                            <input id="tags_from_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tags_from_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">tags_file</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="tags_from_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tags_from_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tags_from_file-112"><a href="#tags_from_file-112"><span class="linenos">112</span></a><span class="k">def</span><span class="w"> </span><span class="nf">tags_from_file</span><span class="p">(</span><span class="n">tags_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VectorIdentifierBatch</span><span class="p">:</span>
</span><span id="tags_from_file-113"><a href="#tags_from_file-113"><span class="linenos">113</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tags_from_file-114"><a href="#tags_from_file-114"><span class="linenos">114</span></a><span class="sd">    Read tags from a DiskANN binary tag file and return them as a 1d array of dtype `numpy.uint32`.</span>
</span><span id="tags_from_file-115"><a href="#tags_from_file-115"><span class="linenos">115</span></a>
</span><span id="tags_from_file-116"><a href="#tags_from_file-116"><span class="linenos">116</span></a><span class="sd">    ### Parameters</span>
</span><span id="tags_from_file-117"><a href="#tags_from_file-117"><span class="linenos">117</span></a><span class="sd">    - **tags_file**: The path to the tag file to read the tags from.</span>
</span><span id="tags_from_file-118"><a href="#tags_from_file-118"><span class="linenos">118</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="tags_from_file-119"><a href="#tags_from_file-119"><span class="linenos">119</span></a>    <span class="n">_assert_existing_file</span><span class="p">(</span><span class="n">tags_file</span><span class="p">,</span> <span class="s2">&quot;tags_file&quot;</span><span class="p">)</span>
</span><span id="tags_from_file-120"><a href="#tags_from_file-120"><span class="linenos">120</span></a>    <span class="n">points</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="n">vectors_metadata_from_file</span><span class="p">(</span>
</span><span id="tags_from_file-121"><a href="#tags_from_file-121"><span class="linenos">121</span></a>        <span class="n">tags_file</span>
</span><span id="tags_from_file-122"><a href="#tags_from_file-122"><span class="linenos">122</span></a>    <span class="p">)</span>  <span class="c1"># tag files contain the same metadata stanza</span>
</span><span id="tags_from_file-123"><a href="#tags_from_file-123"><span class="linenos">123</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">tags_file</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read tags from a DiskANN binary tag file and return them as a 1d array of dtype <code>numpy.uint32</code>.</p>

<h3 id="parameters">Parameters</h3>

<ul>
<li><strong>tags_file</strong>: The path to the tag file to read the tags from.</li>
</ul>
</div>


                </section>
                <section id="valid_dtype">
                            <input id="valid_dtype-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">valid_dtype</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Type</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="valid_dtype-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#valid_dtype"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="valid_dtype-27"><a href="#valid_dtype-27"><span class="linenos">27</span></a><span class="k">def</span><span class="w"> </span><span class="nf">valid_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">:</span> <span class="n">Type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VectorDType</span><span class="p">:</span>
</span><span id="valid_dtype-28"><a href="#valid_dtype-28"><span class="linenos">28</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="valid_dtype-29"><a href="#valid_dtype-29"><span class="linenos">29</span></a><span class="sd">    Utility method to determine whether the provided dtype is supported by `diskannpy`, and if so, the canonical</span>
</span><span id="valid_dtype-30"><a href="#valid_dtype-30"><span class="linenos">30</span></a><span class="sd">    dtype we will use internally (e.g. np.single -&gt; np.float32)</span>
</span><span id="valid_dtype-31"><a href="#valid_dtype-31"><span class="linenos">31</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="valid_dtype-32"><a href="#valid_dtype-32"><span class="linenos">32</span></a>    <span class="n">_assert_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="valid_dtype-33"><a href="#valid_dtype-33"><span class="linenos">33</span></a>    <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="valid_dtype-34"><a href="#valid_dtype-34"><span class="linenos">34</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
</span><span id="valid_dtype-35"><a href="#valid_dtype-35"><span class="linenos">35</span></a>    <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span>
</span><span id="valid_dtype-36"><a href="#valid_dtype-36"><span class="linenos">36</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span>
</span><span id="valid_dtype-37"><a href="#valid_dtype-37"><span class="linenos">37</span></a>    <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
</span><span id="valid_dtype-38"><a href="#valid_dtype-38"><span class="linenos">38</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span></pre></div>


            <div class="docstring"><p>Utility method to determine whether the provided dtype is supported by <code><a href="">diskannpy</a></code>, and if so, the canonical
dtype we will use internally (e.g. np.single -> np.float32)</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>